import{e as L,I as ar}from"./index-DHqL_ZfZ.js";function Ip({title:n,content:t,footer:e,onClose:r}){const s=L("div",{className:"modal-overlay"}),o=L("div",{className:"modal-container"}),a=L("div",{className:"modal-header"}),l=L("h2",{className:"modal-title"},n||""),h=L("button",{className:"modal-close-btn",type:"button"},ar("x"));a.append(l,h);const f=L("div",{className:"modal-body"});typeof t=="string"?f.innerHTML=t:t instanceof HTMLElement&&f.appendChild(t);const m=L("div",{className:"modal-footer"});e&&e instanceof HTMLElement&&m.appendChild(e),o.append(a,f),e&&o.appendChild(m),s.appendChild(o);const E=()=>{s.parentNode&&s.parentNode.removeChild(s),r&&r()},w=()=>{document.body.appendChild(s),setTimeout(()=>{s.classList.add("open"),o.classList.add("open")},10)};return h.onclick=E,s.onclick=C=>{C.target===s&&E()},{open:w,close:E,element:s}}function vp({text:n,onClick:t,variant:e="primary",type:r="button",fullWidth:s=!1,className:o="",title:a=""}){const l=document.createElement("button");l.type=r,n&&typeof n=="string"&&n.includes("<")?l.innerHTML=n:l.textContent=n;const h=["btn",`btn-${e}`];return s&&h.push("w-full"),o&&h.push(o),l.className=h.join(" "),a&&(l.title=a),t&&l.addEventListener("click",t),l}const El=()=>{};var zo={};const ic=function(n){const t=[];let e=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},Tl=function(n){const t=[];let e=0,r=0;for(;e<n.length;){const s=n[e++];if(s<128)t[r++]=String.fromCharCode(s);else if(s>191&&s<224){const o=n[e++];t[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=n[e++],a=n[e++],l=n[e++],h=((s&7)<<18|(o&63)<<12|(a&63)<<6|l&63)-65536;t[r++]=String.fromCharCode(55296+(h>>10)),t[r++]=String.fromCharCode(56320+(h&1023))}else{const o=n[e++],a=n[e++];t[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|a&63)}}return t.join("")},oc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const o=n[s],a=s+1<n.length,l=a?n[s+1]:0,h=s+2<n.length,f=h?n[s+2]:0,m=o>>2,E=(o&3)<<4|l>>4;let w=(l&15)<<2|f>>6,C=f&63;h||(C=64,a||(w=64)),r.push(e[m],e[E],e[w],e[C])}return r.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(ic(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):Tl(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const o=e[n.charAt(s++)],l=s<n.length?e[n.charAt(s)]:0;++s;const f=s<n.length?e[n.charAt(s)]:64;++s;const E=s<n.length?e[n.charAt(s)]:64;if(++s,o==null||l==null||f==null||E==null)throw new Il;const w=o<<2|l>>4;if(r.push(w),f!==64){const C=l<<4&240|f>>2;if(r.push(C),E!==64){const k=f<<6&192|E;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Il extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const vl=function(n){const t=ic(n);return oc.encodeByteArray(t,!0)},mr=function(n){return vl(n).replace(/\./g,"")},wl=function(n){try{return oc.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function Al(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Rl=()=>Al().__FIREBASE_DEFAULTS__,Sl=()=>{if(typeof process>"u"||typeof zo>"u")return;const n=zo.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},bl=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=n&&wl(n[1]);return t&&JSON.parse(t)},ti=()=>{try{return El()||Rl()||Sl()||bl()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Cl=n=>ti()?.emulatorHosts?.[n],Pl=n=>{const t=Cl(n);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),r]:[t.substring(0,e),r]},ac=()=>ti()?.config;class Vl{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,r)=>{e?this.reject(e):this.resolve(r),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,r))}}}function ei(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Dl(n){return(await fetch(n,{credentials:"include"})).ok}function Nl(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},r=t||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...n};return[mr(JSON.stringify(e)),mr(JSON.stringify(a)),""].join(".")}const Tn={};function kl(){const n={prod:[],emulator:[]};for(const t of Object.keys(Tn))Tn[t]?n.emulator.push(t):n.prod.push(t);return n}function Ml(n){let t=document.getElementById(n),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",n),e=!0),{created:e,element:t}}let Go=!1;function Ol(n,t){if(typeof window>"u"||typeof document>"u"||!ei(window.location.host)||Tn[n]===t||Tn[n]||Go)return;Tn[n]=t;function e(w){return`__firebase__banner__${w}`}const r="__firebase__banner",o=kl().prod.length>0;function a(){const w=document.getElementById(r);w&&w.remove()}function l(w){w.style.display="flex",w.style.background="#7faaf0",w.style.position="fixed",w.style.bottom="5px",w.style.left="5px",w.style.padding=".5em",w.style.borderRadius="5px",w.style.alignItems="center"}function h(w,C){w.setAttribute("width","24"),w.setAttribute("id",C),w.setAttribute("height","24"),w.setAttribute("viewBox","0 0 24 24"),w.setAttribute("fill","none"),w.style.marginLeft="-6px"}function f(){const w=document.createElement("span");return w.style.cursor="pointer",w.style.marginLeft="16px",w.style.fontSize="24px",w.innerHTML=" &times;",w.onclick=()=>{Go=!0,a()},w}function m(w,C){w.setAttribute("id",C),w.innerText="Learn more",w.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",w.setAttribute("target","__blank"),w.style.paddingLeft="5px",w.style.textDecoration="underline"}function E(){const w=Ml(r),C=e("text"),k=document.getElementById(C)||document.createElement("span"),M=e("learnmore"),V=document.getElementById(M)||document.createElement("a"),z=e("preprendIcon"),q=document.getElementById(z)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(w.created){const K=w.element;l(K),m(V,M);const lt=f();h(q,z),K.append(q,k,V,lt),document.body.appendChild(K)}o?(k.innerText="Preview backend disconnected.",q.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(q.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,k.innerText="Preview backend running in this workspace."),k.setAttribute("id",C)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",E):E()}function xl(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Ll(){const n=ti()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Fl(){return!Ll()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Ul(){try{return typeof indexedDB=="object"}catch{return!1}}function Bl(){return new Promise((n,t)=>{try{let e=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{t(s.error?.message||"")}}catch(e){t(e)}})}const ql="FirebaseError";class ze extends Error{constructor(t,e,r){super(e),this.code=t,this.customData=r,this.name=ql,Object.setPrototypeOf(this,ze.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,cc.prototype.create)}}class cc{constructor(t,e,r){this.service=t,this.serviceName=e,this.errors=r}create(t,...e){const r=e[0]||{},s=`${this.service}/${t}`,o=this.errors[t],a=o?jl(o,r):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new ze(s,l,r)}}function jl(n,t){return n.replace($l,(e,r)=>{const s=t[r];return s!=null?String(s):`<${r}?>`})}const $l=/\{\$([^}]+)}/g;function pr(n,t){if(n===t)return!0;const e=Object.keys(n),r=Object.keys(t);for(const s of e){if(!r.includes(s))return!1;const o=n[s],a=t[s];if(Ho(o)&&Ho(a)){if(!pr(o,a))return!1}else if(o!==a)return!1}for(const s of r)if(!e.includes(s))return!1;return!0}function Ho(n){return n!==null&&typeof n=="object"}function Bt(n){return n&&n._delegate?n._delegate:n}class Rn{constructor(t,e,r){this.name=t,this.instanceFactory=e,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const Ee="[DEFAULT]";class zl{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const r=new Vl;if(this.instancesDeferred.set(e,r),this.isInitialized(e)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:e});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t?.identifier),r=t?.optional??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Hl(t))try{this.getOrInitializeService({instanceIdentifier:Ee})}catch{}for(const[e,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(e);try{const o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(t=Ee){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Ee){return this.instances.has(t)}getOptions(t=Ee){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,r=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:e});for(const[o,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(o);r===l&&a.resolve(s)}return s}onInit(t,e){const r=this.normalizeInstanceIdentifier(e),s=this.onInitCallbacks.get(r)??new Set;s.add(t),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&t(o,r),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const r=this.onInitCallbacks.get(e);if(r)for(const s of r)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Gl(t),options:e}),this.instances.set(t,r),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch{}return r||null}normalizeInstanceIdentifier(t=Ee){return this.component?this.component.multipleInstances?t:Ee:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Gl(n){return n===Ee?void 0:n}function Hl(n){return n.instantiationMode==="EAGER"}class Kl{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new zl(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}var H;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(H||(H={}));const Ql={debug:H.DEBUG,verbose:H.VERBOSE,info:H.INFO,warn:H.WARN,error:H.ERROR,silent:H.SILENT},Wl=H.INFO,Xl={[H.DEBUG]:"log",[H.VERBOSE]:"log",[H.INFO]:"info",[H.WARN]:"warn",[H.ERROR]:"error"},Yl=(n,t,...e)=>{if(t<n.logLevel)return;const r=new Date().toISOString(),s=Xl[t];if(s)console[s](`[${r}]  ${n.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class uc{constructor(t){this.name=t,this._logLevel=Wl,this._logHandler=Yl,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in H))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Ql[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,H.DEBUG,...t),this._logHandler(this,H.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,H.VERBOSE,...t),this._logHandler(this,H.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,H.INFO,...t),this._logHandler(this,H.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,H.WARN,...t),this._logHandler(this,H.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,H.ERROR,...t),this._logHandler(this,H.ERROR,...t)}}const Jl=(n,t)=>t.some(e=>n instanceof e);let Ko,Qo;function Zl(){return Ko||(Ko=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function th(){return Qo||(Qo=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const lc=new WeakMap,Ds=new WeakMap,hc=new WeakMap,Ts=new WeakMap,ni=new WeakMap;function eh(n){const t=new Promise((e,r)=>{const s=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{e(Zt(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",o),n.addEventListener("error",a)});return t.then(e=>{e instanceof IDBCursor&&lc.set(e,n)}).catch(()=>{}),ni.set(t,n),t}function nh(n){if(Ds.has(n))return;const t=new Promise((e,r)=>{const s=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{e(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});Ds.set(n,t)}let Ns={get(n,t,e){if(n instanceof IDBTransaction){if(t==="done")return Ds.get(n);if(t==="objectStoreNames")return n.objectStoreNames||hc.get(n);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return Zt(n[t])},set(n,t,e){return n[t]=e,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function rh(n){Ns=n(Ns)}function sh(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const r=n.call(Is(this),t,...e);return hc.set(r,t.sort?t.sort():[t]),Zt(r)}:th().includes(n)?function(...t){return n.apply(Is(this),t),Zt(lc.get(this))}:function(...t){return Zt(n.apply(Is(this),t))}}function ih(n){return typeof n=="function"?sh(n):(n instanceof IDBTransaction&&nh(n),Jl(n,Zl())?new Proxy(n,Ns):n)}function Zt(n){if(n instanceof IDBRequest)return eh(n);if(Ts.has(n))return Ts.get(n);const t=ih(n);return t!==n&&(Ts.set(n,t),ni.set(t,n)),t}const Is=n=>ni.get(n);function oh(n,t,{blocked:e,upgrade:r,blocking:s,terminated:o}={}){const a=indexedDB.open(n,t),l=Zt(a);return r&&a.addEventListener("upgradeneeded",h=>{r(Zt(a.result),h.oldVersion,h.newVersion,Zt(a.transaction),h)}),e&&a.addEventListener("blocked",h=>e(h.oldVersion,h.newVersion,h)),l.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",f=>s(f.oldVersion,f.newVersion,f))}).catch(()=>{}),l}const ah=["get","getKey","getAll","getAllKeys","count"],ch=["put","add","delete","clear"],vs=new Map;function Wo(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(vs.get(t))return vs.get(t);const e=t.replace(/FromIndex$/,""),r=t!==e,s=ch.includes(e);if(!(e in(r?IDBIndex:IDBObjectStore).prototype)||!(s||ah.includes(e)))return;const o=async function(a,...l){const h=this.transaction(a,s?"readwrite":"readonly");let f=h.store;return r&&(f=f.index(l.shift())),(await Promise.all([f[e](...l),s&&h.done]))[0]};return vs.set(t,o),o}rh(n=>({...n,get:(t,e,r)=>Wo(t,e)||n.get(t,e,r),has:(t,e)=>!!Wo(t,e)||n.has(t,e)}));class uh{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(lh(e)){const r=e.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(e=>e).join(" ")}}function lh(n){return n.getComponent()?.type==="VERSION"}const ks="@firebase/app",Xo="0.14.6";const $t=new uc("@firebase/app"),hh="@firebase/app-compat",fh="@firebase/analytics-compat",dh="@firebase/analytics",mh="@firebase/app-check-compat",ph="@firebase/app-check",gh="@firebase/auth",_h="@firebase/auth-compat",yh="@firebase/database",Eh="@firebase/data-connect",Th="@firebase/database-compat",Ih="@firebase/functions",vh="@firebase/functions-compat",wh="@firebase/installations",Ah="@firebase/installations-compat",Rh="@firebase/messaging",Sh="@firebase/messaging-compat",bh="@firebase/performance",Ch="@firebase/performance-compat",Ph="@firebase/remote-config",Vh="@firebase/remote-config-compat",Dh="@firebase/storage",Nh="@firebase/storage-compat",kh="@firebase/firestore",Mh="@firebase/ai",Oh="@firebase/firestore-compat",xh="firebase",Lh="12.6.0";const Ms="[DEFAULT]",Fh={[ks]:"fire-core",[hh]:"fire-core-compat",[dh]:"fire-analytics",[fh]:"fire-analytics-compat",[ph]:"fire-app-check",[mh]:"fire-app-check-compat",[gh]:"fire-auth",[_h]:"fire-auth-compat",[yh]:"fire-rtdb",[Eh]:"fire-data-connect",[Th]:"fire-rtdb-compat",[Ih]:"fire-fn",[vh]:"fire-fn-compat",[wh]:"fire-iid",[Ah]:"fire-iid-compat",[Rh]:"fire-fcm",[Sh]:"fire-fcm-compat",[bh]:"fire-perf",[Ch]:"fire-perf-compat",[Ph]:"fire-rc",[Vh]:"fire-rc-compat",[Dh]:"fire-gcs",[Nh]:"fire-gcs-compat",[kh]:"fire-fst",[Oh]:"fire-fst-compat",[Mh]:"fire-vertex","fire-js":"fire-js",[xh]:"fire-js-all"};const gr=new Map,Uh=new Map,Os=new Map;function Yo(n,t){try{n.container.addComponent(t)}catch(e){$t.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,e)}}function _r(n){const t=n.name;if(Os.has(t))return $t.debug(`There were multiple attempts to register component ${t}.`),!1;Os.set(t,n);for(const e of gr.values())Yo(e,n);for(const e of Uh.values())Yo(e,n);return!0}function Bh(n,t){const e=n.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),n.container.getProvider(t)}function qh(n){return n==null?!1:n.settings!==void 0}const jh={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},te=new cc("app","Firebase",jh);class $h{constructor(t,e,r){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Rn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw te.create("app-deleted",{appName:this._name})}}const zh=Lh;function fc(n,t={}){let e=n;typeof t!="object"&&(t={name:t});const r={name:Ms,automaticDataCollectionEnabled:!0,...t},s=r.name;if(typeof s!="string"||!s)throw te.create("bad-app-name",{appName:String(s)});if(e||(e=ac()),!e)throw te.create("no-options");const o=gr.get(s);if(o){if(pr(e,o.options)&&pr(r,o.config))return o;throw te.create("duplicate-app",{appName:s})}const a=new Kl(s);for(const h of Os.values())a.addComponent(h);const l=new $h(e,r,a);return gr.set(s,l),l}function Gh(n=Ms){const t=gr.get(n);if(!t&&n===Ms&&ac())return fc();if(!t)throw te.create("no-app",{appName:n});return t}function xe(n,t,e){let r=Fh[n]??n;e&&(r+=`-${e}`);const s=r.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const a=[`Unable to register library "${r}" with version "${t}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),$t.warn(a.join(" "));return}_r(new Rn(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}const Hh="firebase-heartbeat-database",Kh=1,Sn="firebase-heartbeat-store";let ws=null;function dc(){return ws||(ws=oh(Hh,Kh,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(Sn)}catch(e){console.warn(e)}}}}).catch(n=>{throw te.create("idb-open",{originalErrorMessage:n.message})})),ws}async function Qh(n){try{const e=(await dc()).transaction(Sn),r=await e.objectStore(Sn).get(mc(n));return await e.done,r}catch(t){if(t instanceof ze)$t.warn(t.message);else{const e=te.create("idb-get",{originalErrorMessage:t?.message});$t.warn(e.message)}}}async function Jo(n,t){try{const r=(await dc()).transaction(Sn,"readwrite");await r.objectStore(Sn).put(t,mc(n)),await r.done}catch(e){if(e instanceof ze)$t.warn(e.message);else{const r=te.create("idb-set",{originalErrorMessage:e?.message});$t.warn(r.message)}}}function mc(n){return`${n.name}!${n.options.appId}`}const Wh=1024,Xh=30;class Yh{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Zh(e),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Zo();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:e}),this._heartbeatsCache.heartbeats.length>Xh){const s=tf(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){$t.warn(t)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Zo(),{heartbeatsToSend:e,unsentEntries:r}=Jh(this._heartbeatsCache.heartbeats),s=mr(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return $t.warn(t),""}}}function Zo(){return new Date().toISOString().substring(0,10)}function Jh(n,t=Wh){const e=[];let r=n.slice();for(const s of n){const o=e.find(a=>a.agent===s.agent);if(o){if(o.dates.push(s.date),ta(e)>t){o.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),ta(e)>t){e.pop();break}r=r.slice(1)}return{heartbeatsToSend:e,unsentEntries:r}}class Zh{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Ul()?Bl().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await Qh(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const r=await this.read();return Jo(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const r=await this.read();return Jo(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...t.heartbeats]})}else return}}function ta(n){return mr(JSON.stringify({version:2,heartbeats:n})).length}function tf(n){if(n.length===0)return-1;let t=0,e=n[0].date;for(let r=1;r<n.length;r++)n[r].date<e&&(e=n[r].date,t=r);return t}function ef(n){_r(new Rn("platform-logger",t=>new uh(t),"PRIVATE")),_r(new Rn("heartbeat",t=>new Yh(t),"PRIVATE")),xe(ks,Xo,n),xe(ks,Xo,"esm2020"),xe("fire-js","")}ef("");var nf="firebase",rf="12.7.0";xe(nf,rf,"app");var ea=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var ee,pc;(function(){var n;function t(T,g){function _(){}_.prototype=g.prototype,T.F=g.prototype,T.prototype=new _,T.prototype.constructor=T,T.D=function(v,y,I){for(var p=Array(arguments.length-2),st=2;st<arguments.length;st++)p[st-2]=arguments[st];return g.prototype[y].apply(v,p)}}function e(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}t(r,e),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(T,g,_){_||(_=0);const v=Array(16);if(typeof g=="string")for(var y=0;y<16;++y)v[y]=g.charCodeAt(_++)|g.charCodeAt(_++)<<8|g.charCodeAt(_++)<<16|g.charCodeAt(_++)<<24;else for(y=0;y<16;++y)v[y]=g[_++]|g[_++]<<8|g[_++]<<16|g[_++]<<24;g=T.g[0],_=T.g[1],y=T.g[2];let I=T.g[3],p;p=g+(I^_&(y^I))+v[0]+3614090360&4294967295,g=_+(p<<7&4294967295|p>>>25),p=I+(y^g&(_^y))+v[1]+3905402710&4294967295,I=g+(p<<12&4294967295|p>>>20),p=y+(_^I&(g^_))+v[2]+606105819&4294967295,y=I+(p<<17&4294967295|p>>>15),p=_+(g^y&(I^g))+v[3]+3250441966&4294967295,_=y+(p<<22&4294967295|p>>>10),p=g+(I^_&(y^I))+v[4]+4118548399&4294967295,g=_+(p<<7&4294967295|p>>>25),p=I+(y^g&(_^y))+v[5]+1200080426&4294967295,I=g+(p<<12&4294967295|p>>>20),p=y+(_^I&(g^_))+v[6]+2821735955&4294967295,y=I+(p<<17&4294967295|p>>>15),p=_+(g^y&(I^g))+v[7]+4249261313&4294967295,_=y+(p<<22&4294967295|p>>>10),p=g+(I^_&(y^I))+v[8]+1770035416&4294967295,g=_+(p<<7&4294967295|p>>>25),p=I+(y^g&(_^y))+v[9]+2336552879&4294967295,I=g+(p<<12&4294967295|p>>>20),p=y+(_^I&(g^_))+v[10]+4294925233&4294967295,y=I+(p<<17&4294967295|p>>>15),p=_+(g^y&(I^g))+v[11]+2304563134&4294967295,_=y+(p<<22&4294967295|p>>>10),p=g+(I^_&(y^I))+v[12]+1804603682&4294967295,g=_+(p<<7&4294967295|p>>>25),p=I+(y^g&(_^y))+v[13]+4254626195&4294967295,I=g+(p<<12&4294967295|p>>>20),p=y+(_^I&(g^_))+v[14]+2792965006&4294967295,y=I+(p<<17&4294967295|p>>>15),p=_+(g^y&(I^g))+v[15]+1236535329&4294967295,_=y+(p<<22&4294967295|p>>>10),p=g+(y^I&(_^y))+v[1]+4129170786&4294967295,g=_+(p<<5&4294967295|p>>>27),p=I+(_^y&(g^_))+v[6]+3225465664&4294967295,I=g+(p<<9&4294967295|p>>>23),p=y+(g^_&(I^g))+v[11]+643717713&4294967295,y=I+(p<<14&4294967295|p>>>18),p=_+(I^g&(y^I))+v[0]+3921069994&4294967295,_=y+(p<<20&4294967295|p>>>12),p=g+(y^I&(_^y))+v[5]+3593408605&4294967295,g=_+(p<<5&4294967295|p>>>27),p=I+(_^y&(g^_))+v[10]+38016083&4294967295,I=g+(p<<9&4294967295|p>>>23),p=y+(g^_&(I^g))+v[15]+3634488961&4294967295,y=I+(p<<14&4294967295|p>>>18),p=_+(I^g&(y^I))+v[4]+3889429448&4294967295,_=y+(p<<20&4294967295|p>>>12),p=g+(y^I&(_^y))+v[9]+568446438&4294967295,g=_+(p<<5&4294967295|p>>>27),p=I+(_^y&(g^_))+v[14]+3275163606&4294967295,I=g+(p<<9&4294967295|p>>>23),p=y+(g^_&(I^g))+v[3]+4107603335&4294967295,y=I+(p<<14&4294967295|p>>>18),p=_+(I^g&(y^I))+v[8]+1163531501&4294967295,_=y+(p<<20&4294967295|p>>>12),p=g+(y^I&(_^y))+v[13]+2850285829&4294967295,g=_+(p<<5&4294967295|p>>>27),p=I+(_^y&(g^_))+v[2]+4243563512&4294967295,I=g+(p<<9&4294967295|p>>>23),p=y+(g^_&(I^g))+v[7]+1735328473&4294967295,y=I+(p<<14&4294967295|p>>>18),p=_+(I^g&(y^I))+v[12]+2368359562&4294967295,_=y+(p<<20&4294967295|p>>>12),p=g+(_^y^I)+v[5]+4294588738&4294967295,g=_+(p<<4&4294967295|p>>>28),p=I+(g^_^y)+v[8]+2272392833&4294967295,I=g+(p<<11&4294967295|p>>>21),p=y+(I^g^_)+v[11]+1839030562&4294967295,y=I+(p<<16&4294967295|p>>>16),p=_+(y^I^g)+v[14]+4259657740&4294967295,_=y+(p<<23&4294967295|p>>>9),p=g+(_^y^I)+v[1]+2763975236&4294967295,g=_+(p<<4&4294967295|p>>>28),p=I+(g^_^y)+v[4]+1272893353&4294967295,I=g+(p<<11&4294967295|p>>>21),p=y+(I^g^_)+v[7]+4139469664&4294967295,y=I+(p<<16&4294967295|p>>>16),p=_+(y^I^g)+v[10]+3200236656&4294967295,_=y+(p<<23&4294967295|p>>>9),p=g+(_^y^I)+v[13]+681279174&4294967295,g=_+(p<<4&4294967295|p>>>28),p=I+(g^_^y)+v[0]+3936430074&4294967295,I=g+(p<<11&4294967295|p>>>21),p=y+(I^g^_)+v[3]+3572445317&4294967295,y=I+(p<<16&4294967295|p>>>16),p=_+(y^I^g)+v[6]+76029189&4294967295,_=y+(p<<23&4294967295|p>>>9),p=g+(_^y^I)+v[9]+3654602809&4294967295,g=_+(p<<4&4294967295|p>>>28),p=I+(g^_^y)+v[12]+3873151461&4294967295,I=g+(p<<11&4294967295|p>>>21),p=y+(I^g^_)+v[15]+530742520&4294967295,y=I+(p<<16&4294967295|p>>>16),p=_+(y^I^g)+v[2]+3299628645&4294967295,_=y+(p<<23&4294967295|p>>>9),p=g+(y^(_|~I))+v[0]+4096336452&4294967295,g=_+(p<<6&4294967295|p>>>26),p=I+(_^(g|~y))+v[7]+1126891415&4294967295,I=g+(p<<10&4294967295|p>>>22),p=y+(g^(I|~_))+v[14]+2878612391&4294967295,y=I+(p<<15&4294967295|p>>>17),p=_+(I^(y|~g))+v[5]+4237533241&4294967295,_=y+(p<<21&4294967295|p>>>11),p=g+(y^(_|~I))+v[12]+1700485571&4294967295,g=_+(p<<6&4294967295|p>>>26),p=I+(_^(g|~y))+v[3]+2399980690&4294967295,I=g+(p<<10&4294967295|p>>>22),p=y+(g^(I|~_))+v[10]+4293915773&4294967295,y=I+(p<<15&4294967295|p>>>17),p=_+(I^(y|~g))+v[1]+2240044497&4294967295,_=y+(p<<21&4294967295|p>>>11),p=g+(y^(_|~I))+v[8]+1873313359&4294967295,g=_+(p<<6&4294967295|p>>>26),p=I+(_^(g|~y))+v[15]+4264355552&4294967295,I=g+(p<<10&4294967295|p>>>22),p=y+(g^(I|~_))+v[6]+2734768916&4294967295,y=I+(p<<15&4294967295|p>>>17),p=_+(I^(y|~g))+v[13]+1309151649&4294967295,_=y+(p<<21&4294967295|p>>>11),p=g+(y^(_|~I))+v[4]+4149444226&4294967295,g=_+(p<<6&4294967295|p>>>26),p=I+(_^(g|~y))+v[11]+3174756917&4294967295,I=g+(p<<10&4294967295|p>>>22),p=y+(g^(I|~_))+v[2]+718787259&4294967295,y=I+(p<<15&4294967295|p>>>17),p=_+(I^(y|~g))+v[9]+3951481745&4294967295,T.g[0]=T.g[0]+g&4294967295,T.g[1]=T.g[1]+(y+(p<<21&4294967295|p>>>11))&4294967295,T.g[2]=T.g[2]+y&4294967295,T.g[3]=T.g[3]+I&4294967295}r.prototype.v=function(T,g){g===void 0&&(g=T.length);const _=g-this.blockSize,v=this.C;let y=this.h,I=0;for(;I<g;){if(y==0)for(;I<=_;)s(this,T,I),I+=this.blockSize;if(typeof T=="string"){for(;I<g;)if(v[y++]=T.charCodeAt(I++),y==this.blockSize){s(this,v),y=0;break}}else for(;I<g;)if(v[y++]=T[I++],y==this.blockSize){s(this,v),y=0;break}}this.h=y,this.o+=g},r.prototype.A=function(){var T=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);T[0]=128;for(var g=1;g<T.length-8;++g)T[g]=0;g=this.o*8;for(var _=T.length-8;_<T.length;++_)T[_]=g&255,g/=256;for(this.v(T),T=Array(16),g=0,_=0;_<4;++_)for(let v=0;v<32;v+=8)T[g++]=this.g[_]>>>v&255;return T};function o(T,g){var _=l;return Object.prototype.hasOwnProperty.call(_,T)?_[T]:_[T]=g(T)}function a(T,g){this.h=g;const _=[];let v=!0;for(let y=T.length-1;y>=0;y--){const I=T[y]|0;v&&I==g||(_[y]=I,v=!1)}this.g=_}var l={};function h(T){return-128<=T&&T<128?o(T,function(g){return new a([g|0],g<0?-1:0)}):new a([T|0],T<0?-1:0)}function f(T){if(isNaN(T)||!isFinite(T))return E;if(T<0)return V(f(-T));const g=[];let _=1;for(let v=0;T>=_;v++)g[v]=T/_|0,_*=4294967296;return new a(g,0)}function m(T,g){if(T.length==0)throw Error("number format error: empty string");if(g=g||10,g<2||36<g)throw Error("radix out of range: "+g);if(T.charAt(0)=="-")return V(m(T.substring(1),g));if(T.indexOf("-")>=0)throw Error('number format error: interior "-" character');const _=f(Math.pow(g,8));let v=E;for(let I=0;I<T.length;I+=8){var y=Math.min(8,T.length-I);const p=parseInt(T.substring(I,I+y),g);y<8?(y=f(Math.pow(g,y)),v=v.j(y).add(f(p))):(v=v.j(_),v=v.add(f(p)))}return v}var E=h(0),w=h(1),C=h(16777216);n=a.prototype,n.m=function(){if(M(this))return-V(this).m();let T=0,g=1;for(let _=0;_<this.g.length;_++){const v=this.i(_);T+=(v>=0?v:4294967296+v)*g,g*=4294967296}return T},n.toString=function(T){if(T=T||10,T<2||36<T)throw Error("radix out of range: "+T);if(k(this))return"0";if(M(this))return"-"+V(this).toString(T);const g=f(Math.pow(T,6));var _=this;let v="";for(;;){const y=lt(_,g).g;_=z(_,y.j(g));let I=((_.g.length>0?_.g[0]:_.h)>>>0).toString(T);if(_=y,k(_))return I+v;for(;I.length<6;)I="0"+I;v=I+v}},n.i=function(T){return T<0?0:T<this.g.length?this.g[T]:this.h};function k(T){if(T.h!=0)return!1;for(let g=0;g<T.g.length;g++)if(T.g[g]!=0)return!1;return!0}function M(T){return T.h==-1}n.l=function(T){return T=z(this,T),M(T)?-1:k(T)?0:1};function V(T){const g=T.g.length,_=[];for(let v=0;v<g;v++)_[v]=~T.g[v];return new a(_,~T.h).add(w)}n.abs=function(){return M(this)?V(this):this},n.add=function(T){const g=Math.max(this.g.length,T.g.length),_=[];let v=0;for(let y=0;y<=g;y++){let I=v+(this.i(y)&65535)+(T.i(y)&65535),p=(I>>>16)+(this.i(y)>>>16)+(T.i(y)>>>16);v=p>>>16,I&=65535,p&=65535,_[y]=p<<16|I}return new a(_,_[_.length-1]&-2147483648?-1:0)};function z(T,g){return T.add(V(g))}n.j=function(T){if(k(this)||k(T))return E;if(M(this))return M(T)?V(this).j(V(T)):V(V(this).j(T));if(M(T))return V(this.j(V(T)));if(this.l(C)<0&&T.l(C)<0)return f(this.m()*T.m());const g=this.g.length+T.g.length,_=[];for(var v=0;v<2*g;v++)_[v]=0;for(v=0;v<this.g.length;v++)for(let y=0;y<T.g.length;y++){const I=this.i(v)>>>16,p=this.i(v)&65535,st=T.i(y)>>>16,Pt=T.i(y)&65535;_[2*v+2*y]+=p*Pt,q(_,2*v+2*y),_[2*v+2*y+1]+=I*Pt,q(_,2*v+2*y+1),_[2*v+2*y+1]+=p*st,q(_,2*v+2*y+1),_[2*v+2*y+2]+=I*st,q(_,2*v+2*y+2)}for(T=0;T<g;T++)_[T]=_[2*T+1]<<16|_[2*T];for(T=g;T<2*g;T++)_[T]=0;return new a(_,0)};function q(T,g){for(;(T[g]&65535)!=T[g];)T[g+1]+=T[g]>>>16,T[g]&=65535,g++}function K(T,g){this.g=T,this.h=g}function lt(T,g){if(k(g))throw Error("division by zero");if(k(T))return new K(E,E);if(M(T))return g=lt(V(T),g),new K(V(g.g),V(g.h));if(M(g))return g=lt(T,V(g)),new K(V(g.g),g.h);if(T.g.length>30){if(M(T)||M(g))throw Error("slowDivide_ only works with positive integers.");for(var _=w,v=g;v.l(T)<=0;)_=dt(_),v=dt(v);var y=et(_,1),I=et(v,1);for(v=et(v,2),_=et(_,2);!k(v);){var p=I.add(v);p.l(T)<=0&&(y=y.add(_),I=p),v=et(v,1),_=et(_,1)}return g=z(T,y.j(g)),new K(y,g)}for(y=E;T.l(g)>=0;){for(_=Math.max(1,Math.floor(T.m()/g.m())),v=Math.ceil(Math.log(_)/Math.LN2),v=v<=48?1:Math.pow(2,v-48),I=f(_),p=I.j(g);M(p)||p.l(T)>0;)_-=v,I=f(_),p=I.j(g);k(I)&&(I=w),y=y.add(I),T=z(T,p)}return new K(y,T)}n.B=function(T){return lt(this,T).h},n.and=function(T){const g=Math.max(this.g.length,T.g.length),_=[];for(let v=0;v<g;v++)_[v]=this.i(v)&T.i(v);return new a(_,this.h&T.h)},n.or=function(T){const g=Math.max(this.g.length,T.g.length),_=[];for(let v=0;v<g;v++)_[v]=this.i(v)|T.i(v);return new a(_,this.h|T.h)},n.xor=function(T){const g=Math.max(this.g.length,T.g.length),_=[];for(let v=0;v<g;v++)_[v]=this.i(v)^T.i(v);return new a(_,this.h^T.h)};function dt(T){const g=T.g.length+1,_=[];for(let v=0;v<g;v++)_[v]=T.i(v)<<1|T.i(v-1)>>>31;return new a(_,T.h)}function et(T,g){const _=g>>5;g%=32;const v=T.g.length-_,y=[];for(let I=0;I<v;I++)y[I]=g>0?T.i(I+_)>>>g|T.i(I+_+1)<<32-g:T.i(I+_);return new a(y,T.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,pc=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=f,a.fromString=m,ee=a}).apply(typeof ea<"u"?ea:typeof self<"u"?self:typeof window<"u"?window:{});var er=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var gc,gn,_c,cr,xs,yc,Ec,Tc;(function(){var n,t=Object.defineProperty;function e(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof er=="object"&&er];for(var c=0;c<i.length;++c){var u=i[c];if(u&&u.Math==Math)return u}throw Error("Cannot find global object")}var r=e(this);function s(i,c){if(c)t:{var u=r;i=i.split(".");for(var d=0;d<i.length-1;d++){var A=i[d];if(!(A in u))break t;u=u[A]}i=i[i.length-1],d=u[i],c=c(d),c!=d&&c!=null&&t(u,i,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(i){return i||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(i){return i||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(i){return i||function(c){var u=[],d;for(d in c)Object.prototype.hasOwnProperty.call(c,d)&&u.push([d,c[d]]);return u}});var o=o||{},a=this||self;function l(i){var c=typeof i;return c=="object"&&i!=null||c=="function"}function h(i,c,u){return i.call.apply(i.bind,arguments)}function f(i,c,u){return f=h,f.apply(null,arguments)}function m(i,c){var u=Array.prototype.slice.call(arguments,1);return function(){var d=u.slice();return d.push.apply(d,arguments),i.apply(this,d)}}function E(i,c){function u(){}u.prototype=c.prototype,i.Z=c.prototype,i.prototype=new u,i.prototype.constructor=i,i.Ob=function(d,A,R){for(var P=Array(arguments.length-2),B=2;B<arguments.length;B++)P[B-2]=arguments[B];return c.prototype[A].apply(d,P)}}var w=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?i=>i&&AsyncContext.Snapshot.wrap(i):i=>i;function C(i){const c=i.length;if(c>0){const u=Array(c);for(let d=0;d<c;d++)u[d]=i[d];return u}return[]}function k(i,c){for(let d=1;d<arguments.length;d++){const A=arguments[d];var u=typeof A;if(u=u!="object"?u:A?Array.isArray(A)?"array":u:"null",u=="array"||u=="object"&&typeof A.length=="number"){u=i.length||0;const R=A.length||0;i.length=u+R;for(let P=0;P<R;P++)i[u+P]=A[P]}else i.push(A)}}class M{constructor(c,u){this.i=c,this.j=u,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function V(i){a.setTimeout(()=>{throw i},0)}function z(){var i=T;let c=null;return i.g&&(c=i.g,i.g=i.g.next,i.g||(i.h=null),c.next=null),c}class q{constructor(){this.h=this.g=null}add(c,u){const d=K.get();d.set(c,u),this.h?this.h.next=d:this.g=d,this.h=d}}var K=new M(()=>new lt,i=>i.reset());class lt{constructor(){this.next=this.g=this.h=null}set(c,u){this.h=c,this.g=u,this.next=null}reset(){this.next=this.g=this.h=null}}let dt,et=!1,T=new q,g=()=>{const i=Promise.resolve(void 0);dt=()=>{i.then(_)}};function _(){for(var i;i=z();){try{i.h.call(i.g)}catch(u){V(u)}var c=K;c.j(i),c.h<100&&(c.h++,i.next=c.g,c.g=i)}et=!1}function v(){this.u=this.u,this.C=this.C}v.prototype.u=!1,v.prototype.dispose=function(){this.u||(this.u=!0,this.N())},v.prototype[Symbol.dispose]=function(){this.dispose()},v.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function y(i,c){this.type=i,this.g=this.target=c,this.defaultPrevented=!1}y.prototype.h=function(){this.defaultPrevented=!0};var I=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var i=!1,c=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const u=()=>{};a.addEventListener("test",u,c),a.removeEventListener("test",u,c)}catch{}return i})();function p(i){return/^[\s\xa0]*$/.test(i)}function st(i,c){y.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i&&this.init(i,c)}E(st,y),st.prototype.init=function(i,c){const u=this.type=i.type,d=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;this.target=i.target||i.srcElement,this.g=c,c=i.relatedTarget,c||(u=="mouseover"?c=i.fromElement:u=="mouseout"&&(c=i.toElement)),this.relatedTarget=c,d?(this.clientX=d.clientX!==void 0?d.clientX:d.pageX,this.clientY=d.clientY!==void 0?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=i.pointerType,this.state=i.state,this.i=i,i.defaultPrevented&&st.Z.h.call(this)},st.prototype.h=function(){st.Z.h.call(this);const i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var Pt="closure_listenable_"+(Math.random()*1e6|0),qn=0;function Xe(i,c,u,d,A){this.listener=i,this.proxy=null,this.src=c,this.type=u,this.capture=!!d,this.ha=A,this.key=++qn,this.da=this.fa=!1}function de(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function be(i,c,u){for(const d in i)c.call(u,i[d],d,i)}function Wr(i,c){for(const u in i)c.call(void 0,i[u],u,i)}function ji(i){const c={};for(const u in i)c[u]=i[u];return c}const $i="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function zi(i,c){let u,d;for(let A=1;A<arguments.length;A++){d=arguments[A];for(u in d)i[u]=d[u];for(let R=0;R<$i.length;R++)u=$i[R],Object.prototype.hasOwnProperty.call(d,u)&&(i[u]=d[u])}}function jn(i){this.src=i,this.g={},this.h=0}jn.prototype.add=function(i,c,u,d,A){const R=i.toString();i=this.g[R],i||(i=this.g[R]=[],this.h++);const P=Yr(i,c,d,A);return P>-1?(c=i[P],u||(c.fa=!1)):(c=new Xe(c,this.src,R,!!d,A),c.fa=u,i.push(c)),c};function Xr(i,c){const u=c.type;if(u in i.g){var d=i.g[u],A=Array.prototype.indexOf.call(d,c,void 0),R;(R=A>=0)&&Array.prototype.splice.call(d,A,1),R&&(de(c),i.g[u].length==0&&(delete i.g[u],i.h--))}}function Yr(i,c,u,d){for(let A=0;A<i.length;++A){const R=i[A];if(!R.da&&R.listener==c&&R.capture==!!u&&R.ha==d)return A}return-1}var Jr="closure_lm_"+(Math.random()*1e6|0),Zr={};function Gi(i,c,u,d,A){if(Array.isArray(c)){for(let R=0;R<c.length;R++)Gi(i,c[R],u,d,A);return null}return u=Qi(u),i&&i[Pt]?i.J(c,u,l(d)?!!d.capture:!1,A):zu(i,c,u,!1,d,A)}function zu(i,c,u,d,A,R){if(!c)throw Error("Invalid event type");const P=l(A)?!!A.capture:!!A;let B=es(i);if(B||(i[Jr]=B=new jn(i)),u=B.add(c,u,d,P,R),u.proxy)return u;if(d=Gu(),u.proxy=d,d.src=i,d.listener=u,i.addEventListener)I||(A=P),A===void 0&&(A=!1),i.addEventListener(c.toString(),d,A);else if(i.attachEvent)i.attachEvent(Ki(c.toString()),d);else if(i.addListener&&i.removeListener)i.addListener(d);else throw Error("addEventListener and attachEvent are unavailable.");return u}function Gu(){function i(u){return c.call(i.src,i.listener,u)}const c=Hu;return i}function Hi(i,c,u,d,A){if(Array.isArray(c))for(var R=0;R<c.length;R++)Hi(i,c[R],u,d,A);else d=l(d)?!!d.capture:!!d,u=Qi(u),i&&i[Pt]?(i=i.i,R=String(c).toString(),R in i.g&&(c=i.g[R],u=Yr(c,u,d,A),u>-1&&(de(c[u]),Array.prototype.splice.call(c,u,1),c.length==0&&(delete i.g[R],i.h--)))):i&&(i=es(i))&&(c=i.g[c.toString()],i=-1,c&&(i=Yr(c,u,d,A)),(u=i>-1?c[i]:null)&&ts(u))}function ts(i){if(typeof i!="number"&&i&&!i.da){var c=i.src;if(c&&c[Pt])Xr(c.i,i);else{var u=i.type,d=i.proxy;c.removeEventListener?c.removeEventListener(u,d,i.capture):c.detachEvent?c.detachEvent(Ki(u),d):c.addListener&&c.removeListener&&c.removeListener(d),(u=es(c))?(Xr(u,i),u.h==0&&(u.src=null,c[Jr]=null)):de(i)}}}function Ki(i){return i in Zr?Zr[i]:Zr[i]="on"+i}function Hu(i,c){if(i.da)i=!0;else{c=new st(c,this);const u=i.listener,d=i.ha||i.src;i.fa&&ts(i),i=u.call(d,c)}return i}function es(i){return i=i[Jr],i instanceof jn?i:null}var ns="__closure_events_fn_"+(Math.random()*1e9>>>0);function Qi(i){return typeof i=="function"?i:(i[ns]||(i[ns]=function(c){return i.handleEvent(c)}),i[ns])}function _t(){v.call(this),this.i=new jn(this),this.M=this,this.G=null}E(_t,v),_t.prototype[Pt]=!0,_t.prototype.removeEventListener=function(i,c,u,d){Hi(this,i,c,u,d)};function It(i,c){var u,d=i.G;if(d)for(u=[];d;d=d.G)u.push(d);if(i=i.M,d=c.type||c,typeof c=="string")c=new y(c,i);else if(c instanceof y)c.target=c.target||i;else{var A=c;c=new y(d,i),zi(c,A)}A=!0;let R,P;if(u)for(P=u.length-1;P>=0;P--)R=c.g=u[P],A=$n(R,d,!0,c)&&A;if(R=c.g=i,A=$n(R,d,!0,c)&&A,A=$n(R,d,!1,c)&&A,u)for(P=0;P<u.length;P++)R=c.g=u[P],A=$n(R,d,!1,c)&&A}_t.prototype.N=function(){if(_t.Z.N.call(this),this.i){var i=this.i;for(const c in i.g){const u=i.g[c];for(let d=0;d<u.length;d++)de(u[d]);delete i.g[c],i.h--}}this.G=null},_t.prototype.J=function(i,c,u,d){return this.i.add(String(i),c,!1,u,d)},_t.prototype.K=function(i,c,u,d){return this.i.add(String(i),c,!0,u,d)};function $n(i,c,u,d){if(c=i.i.g[String(c)],!c)return!0;c=c.concat();let A=!0;for(let R=0;R<c.length;++R){const P=c[R];if(P&&!P.da&&P.capture==u){const B=P.listener,ct=P.ha||P.src;P.fa&&Xr(i.i,P),A=B.call(ct,d)!==!1&&A}}return A&&!d.defaultPrevented}function Ku(i,c){if(typeof i!="function")if(i&&typeof i.handleEvent=="function")i=f(i.handleEvent,i);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(i,c||0)}function Wi(i){i.g=Ku(()=>{i.g=null,i.i&&(i.i=!1,Wi(i))},i.l);const c=i.h;i.h=null,i.m.apply(null,c)}class Qu extends v{constructor(c,u){super(),this.m=c,this.l=u,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Wi(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ye(i){v.call(this),this.h=i,this.g={}}E(Ye,v);var Xi=[];function Yi(i){be(i.g,function(c,u){this.g.hasOwnProperty(u)&&ts(c)},i),i.g={}}Ye.prototype.N=function(){Ye.Z.N.call(this),Yi(this)},Ye.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var rs=a.JSON.stringify,Wu=a.JSON.parse,Xu=class{stringify(i){return a.JSON.stringify(i,void 0)}parse(i){return a.JSON.parse(i,void 0)}};function Ji(){}function Zi(){}var Je={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ss(){y.call(this,"d")}E(ss,y);function is(){y.call(this,"c")}E(is,y);var me={},to=null;function zn(){return to=to||new _t}me.Ia="serverreachability";function eo(i){y.call(this,me.Ia,i)}E(eo,y);function Ze(i){const c=zn();It(c,new eo(c))}me.STAT_EVENT="statevent";function no(i,c){y.call(this,me.STAT_EVENT,i),this.stat=c}E(no,y);function vt(i){const c=zn();It(c,new no(c,i))}me.Ja="timingevent";function ro(i,c){y.call(this,me.Ja,i),this.size=c}E(ro,y);function tn(i,c){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){i()},c)}function en(){this.g=!0}en.prototype.ua=function(){this.g=!1};function Yu(i,c,u,d,A,R){i.info(function(){if(i.g)if(R){var P="",B=R.split("&");for(let W=0;W<B.length;W++){var ct=B[W].split("=");if(ct.length>1){const ht=ct[0];ct=ct[1];const kt=ht.split("_");P=kt.length>=2&&kt[1]=="type"?P+(ht+"="+ct+"&"):P+(ht+"=redacted&")}}}else P=null;else P=R;return"XMLHTTP REQ ("+d+") [attempt "+A+"]: "+c+`
`+u+`
`+P})}function Ju(i,c,u,d,A,R,P){i.info(function(){return"XMLHTTP RESP ("+d+") [ attempt "+A+"]: "+c+`
`+u+`
`+R+" "+P})}function Ce(i,c,u,d){i.info(function(){return"XMLHTTP TEXT ("+c+"): "+tl(i,u)+(d?" "+d:"")})}function Zu(i,c){i.info(function(){return"TIMEOUT: "+c})}en.prototype.info=function(){};function tl(i,c){if(!i.g)return c;if(!c)return null;try{const R=JSON.parse(c);if(R){for(i=0;i<R.length;i++)if(Array.isArray(R[i])){var u=R[i];if(!(u.length<2)){var d=u[1];if(Array.isArray(d)&&!(d.length<1)){var A=d[0];if(A!="noop"&&A!="stop"&&A!="close")for(let P=1;P<d.length;P++)d[P]=""}}}}return rs(R)}catch{return c}}var Gn={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},so={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},io;function os(){}E(os,Ji),os.prototype.g=function(){return new XMLHttpRequest},io=new os;function nn(i){return encodeURIComponent(String(i))}function el(i){var c=1;i=i.split(":");const u=[];for(;c>0&&i.length;)u.push(i.shift()),c--;return i.length&&u.push(i.join(":")),u}function Ht(i,c,u,d){this.j=i,this.i=c,this.l=u,this.S=d||1,this.V=new Ye(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new oo}function oo(){this.i=null,this.g="",this.h=!1}var ao={},as={};function cs(i,c,u){i.M=1,i.A=Kn(Nt(c)),i.u=u,i.R=!0,co(i,null)}function co(i,c){i.F=Date.now(),Hn(i),i.B=Nt(i.A);var u=i.B,d=i.S;Array.isArray(d)||(d=[String(d)]),vo(u.i,"t",d),i.C=0,u=i.j.L,i.h=new oo,i.g=Bo(i.j,u?c:null,!i.u),i.P>0&&(i.O=new Qu(f(i.Y,i,i.g),i.P)),c=i.V,u=i.g,d=i.ba;var A="readystatechange";Array.isArray(A)||(A&&(Xi[0]=A.toString()),A=Xi);for(let R=0;R<A.length;R++){const P=Gi(u,A[R],d||c.handleEvent,!1,c.h||c);if(!P)break;c.g[P.key]=P}c=i.J?ji(i.J):{},i.u?(i.v||(i.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.B,i.v,i.u,c)):(i.v="GET",i.g.ea(i.B,i.v,null,c)),Ze(),Yu(i.i,i.v,i.B,i.l,i.S,i.u)}Ht.prototype.ba=function(i){i=i.target;const c=this.O;c&&Wt(i)==3?c.j():this.Y(i)},Ht.prototype.Y=function(i){try{if(i==this.g)t:{const B=Wt(this.g),ct=this.g.ya(),W=this.g.ca();if(!(B<3)&&(B!=3||this.g&&(this.h.h||this.g.la()||Po(this.g)))){this.K||B!=4||ct==7||(ct==8||W<=0?Ze(3):Ze(2)),us(this);var c=this.g.ca();this.X=c;var u=nl(this);if(this.o=c==200,Ju(this.i,this.v,this.B,this.l,this.S,B,c),this.o){if(this.U&&!this.L){e:{if(this.g){var d,A=this.g;if((d=A.g?A.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!p(d)){var R=d;break e}}R=null}if(i=R)Ce(this.i,this.l,i,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ls(this,i);else{this.o=!1,this.m=3,vt(12),pe(this),rn(this);break t}}if(this.R){i=!0;let ht;for(;!this.K&&this.C<u.length;)if(ht=rl(this,u),ht==as){B==4&&(this.m=4,vt(14),i=!1),Ce(this.i,this.l,null,"[Incomplete Response]");break}else if(ht==ao){this.m=4,vt(15),Ce(this.i,this.l,u,"[Invalid Chunk]"),i=!1;break}else Ce(this.i,this.l,ht,null),ls(this,ht);if(uo(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),B!=4||u.length!=0||this.h.h||(this.m=1,vt(16),i=!1),this.o=this.o&&i,!i)Ce(this.i,this.l,u,"[Invalid Chunked Response]"),pe(this),rn(this);else if(u.length>0&&!this.W){this.W=!0;var P=this.j;P.g==this&&P.aa&&!P.P&&(P.j.info("Great, no buffering proxy detected. Bytes received: "+u.length),ys(P),P.P=!0,vt(11))}}else Ce(this.i,this.l,u,null),ls(this,u);B==4&&pe(this),this.o&&!this.K&&(B==4?xo(this.j,this):(this.o=!1,Hn(this)))}else _l(this.g),c==400&&u.indexOf("Unknown SID")>0?(this.m=3,vt(12)):(this.m=0,vt(13)),pe(this),rn(this)}}}catch{}};function nl(i){if(!uo(i))return i.g.la();const c=Po(i.g);if(c==="")return"";let u="";const d=c.length,A=Wt(i.g)==4;if(!i.h.i){if(typeof TextDecoder>"u")return pe(i),rn(i),"";i.h.i=new a.TextDecoder}for(let R=0;R<d;R++)i.h.h=!0,u+=i.h.i.decode(c[R],{stream:!(A&&R==d-1)});return c.length=0,i.h.g+=u,i.C=0,i.h.g}function uo(i){return i.g?i.v=="GET"&&i.M!=2&&i.j.Aa:!1}function rl(i,c){var u=i.C,d=c.indexOf(`
`,u);return d==-1?as:(u=Number(c.substring(u,d)),isNaN(u)?ao:(d+=1,d+u>c.length?as:(c=c.slice(d,d+u),i.C=d+u,c)))}Ht.prototype.cancel=function(){this.K=!0,pe(this)};function Hn(i){i.T=Date.now()+i.H,lo(i,i.H)}function lo(i,c){if(i.D!=null)throw Error("WatchDog timer not null");i.D=tn(f(i.aa,i),c)}function us(i){i.D&&(a.clearTimeout(i.D),i.D=null)}Ht.prototype.aa=function(){this.D=null;const i=Date.now();i-this.T>=0?(Zu(this.i,this.B),this.M!=2&&(Ze(),vt(17)),pe(this),this.m=2,rn(this)):lo(this,this.T-i)};function rn(i){i.j.I==0||i.K||xo(i.j,i)}function pe(i){us(i);var c=i.O;c&&typeof c.dispose=="function"&&c.dispose(),i.O=null,Yi(i.V),i.g&&(c=i.g,i.g=null,c.abort(),c.dispose())}function ls(i,c){try{var u=i.j;if(u.I!=0&&(u.g==i||hs(u.h,i))){if(!i.L&&hs(u.h,i)&&u.I==3){try{var d=u.Ba.g.parse(c)}catch{d=null}if(Array.isArray(d)&&d.length==3){var A=d;if(A[0]==0){t:if(!u.v){if(u.g)if(u.g.F+3e3<i.F)Jn(u),Xn(u);else break t;_s(u),vt(18)}}else u.xa=A[1],0<u.xa-u.K&&A[2]<37500&&u.F&&u.A==0&&!u.C&&(u.C=tn(f(u.Va,u),6e3));mo(u.h)<=1&&u.ta&&(u.ta=void 0)}else _e(u,11)}else if((i.L||u.g==i)&&Jn(u),!p(c))for(A=u.Ba.g.parse(c),c=0;c<A.length;c++){let W=A[c];const ht=W[0];if(!(ht<=u.K))if(u.K=ht,W=W[1],u.I==2)if(W[0]=="c"){u.M=W[1],u.ba=W[2];const kt=W[3];kt!=null&&(u.ka=kt,u.j.info("VER="+u.ka));const ye=W[4];ye!=null&&(u.za=ye,u.j.info("SVER="+u.za));const Xt=W[5];Xt!=null&&typeof Xt=="number"&&Xt>0&&(d=1.5*Xt,u.O=d,u.j.info("backChannelRequestTimeoutMs_="+d)),d=u;const Yt=i.g;if(Yt){const tr=Yt.g?Yt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(tr){var R=d.h;R.g||tr.indexOf("spdy")==-1&&tr.indexOf("quic")==-1&&tr.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&(fs(R,R.h),R.h=null))}if(d.G){const Es=Yt.g?Yt.g.getResponseHeader("X-HTTP-Session-Id"):null;Es&&(d.wa=Es,Y(d.J,d.G,Es))}}u.I=3,u.l&&u.l.ra(),u.aa&&(u.T=Date.now()-i.F,u.j.info("Handshake RTT: "+u.T+"ms")),d=u;var P=i;if(d.na=Uo(d,d.L?d.ba:null,d.W),P.L){po(d.h,P);var B=P,ct=d.O;ct&&(B.H=ct),B.D&&(us(B),Hn(B)),d.g=P}else Mo(d);u.i.length>0&&Yn(u)}else W[0]!="stop"&&W[0]!="close"||_e(u,7);else u.I==3&&(W[0]=="stop"||W[0]=="close"?W[0]=="stop"?_e(u,7):gs(u):W[0]!="noop"&&u.l&&u.l.qa(W),u.A=0)}}Ze(4)}catch{}}var sl=class{constructor(i,c){this.g=i,this.map=c}};function ho(i){this.l=i||10,a.PerformanceNavigationTiming?(i=a.performance.getEntriesByType("navigation"),i=i.length>0&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function fo(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function mo(i){return i.h?1:i.g?i.g.size:0}function hs(i,c){return i.h?i.h==c:i.g?i.g.has(c):!1}function fs(i,c){i.g?i.g.add(c):i.h=c}function po(i,c){i.h&&i.h==c?i.h=null:i.g&&i.g.has(c)&&i.g.delete(c)}ho.prototype.cancel=function(){if(this.i=go(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function go(i){if(i.h!=null)return i.i.concat(i.h.G);if(i.g!=null&&i.g.size!==0){let c=i.i;for(const u of i.g.values())c=c.concat(u.G);return c}return C(i.i)}var _o=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function il(i,c){if(i){i=i.split("&");for(let u=0;u<i.length;u++){const d=i[u].indexOf("=");let A,R=null;d>=0?(A=i[u].substring(0,d),R=i[u].substring(d+1)):A=i[u],c(A,R?decodeURIComponent(R.replace(/\+/g," ")):"")}}}function Kt(i){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;i instanceof Kt?(this.l=i.l,sn(this,i.j),this.o=i.o,this.g=i.g,on(this,i.u),this.h=i.h,ds(this,wo(i.i)),this.m=i.m):i&&(c=String(i).match(_o))?(this.l=!1,sn(this,c[1]||"",!0),this.o=an(c[2]||""),this.g=an(c[3]||"",!0),on(this,c[4]),this.h=an(c[5]||"",!0),ds(this,c[6]||"",!0),this.m=an(c[7]||"")):(this.l=!1,this.i=new un(null,this.l))}Kt.prototype.toString=function(){const i=[];var c=this.j;c&&i.push(cn(c,yo,!0),":");var u=this.g;return(u||c=="file")&&(i.push("//"),(c=this.o)&&i.push(cn(c,yo,!0),"@"),i.push(nn(u).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u=this.u,u!=null&&i.push(":",String(u))),(u=this.h)&&(this.g&&u.charAt(0)!="/"&&i.push("/"),i.push(cn(u,u.charAt(0)=="/"?cl:al,!0))),(u=this.i.toString())&&i.push("?",u),(u=this.m)&&i.push("#",cn(u,ll)),i.join("")},Kt.prototype.resolve=function(i){const c=Nt(this);let u=!!i.j;u?sn(c,i.j):u=!!i.o,u?c.o=i.o:u=!!i.g,u?c.g=i.g:u=i.u!=null;var d=i.h;if(u)on(c,i.u);else if(u=!!i.h){if(d.charAt(0)!="/")if(this.g&&!this.h)d="/"+d;else{var A=c.h.lastIndexOf("/");A!=-1&&(d=c.h.slice(0,A+1)+d)}if(A=d,A==".."||A==".")d="";else if(A.indexOf("./")!=-1||A.indexOf("/.")!=-1){d=A.lastIndexOf("/",0)==0,A=A.split("/");const R=[];for(let P=0;P<A.length;){const B=A[P++];B=="."?d&&P==A.length&&R.push(""):B==".."?((R.length>1||R.length==1&&R[0]!="")&&R.pop(),d&&P==A.length&&R.push("")):(R.push(B),d=!0)}d=R.join("/")}else d=A}return u?c.h=d:u=i.i.toString()!=="",u?ds(c,wo(i.i)):u=!!i.m,u&&(c.m=i.m),c};function Nt(i){return new Kt(i)}function sn(i,c,u){i.j=u?an(c,!0):c,i.j&&(i.j=i.j.replace(/:$/,""))}function on(i,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);i.u=c}else i.u=null}function ds(i,c,u){c instanceof un?(i.i=c,hl(i.i,i.l)):(u||(c=cn(c,ul)),i.i=new un(c,i.l))}function Y(i,c,u){i.i.set(c,u)}function Kn(i){return Y(i,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),i}function an(i,c){return i?c?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function cn(i,c,u){return typeof i=="string"?(i=encodeURI(i).replace(c,ol),u&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function ol(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var yo=/[#\/\?@]/g,al=/[#\?:]/g,cl=/[#\?]/g,ul=/[#\?@]/g,ll=/#/g;function un(i,c){this.h=this.g=null,this.i=i||null,this.j=!!c}function ge(i){i.g||(i.g=new Map,i.h=0,i.i&&il(i.i,function(c,u){i.add(decodeURIComponent(c.replace(/\+/g," ")),u)}))}n=un.prototype,n.add=function(i,c){ge(this),this.i=null,i=Pe(this,i);let u=this.g.get(i);return u||this.g.set(i,u=[]),u.push(c),this.h+=1,this};function Eo(i,c){ge(i),c=Pe(i,c),i.g.has(c)&&(i.i=null,i.h-=i.g.get(c).length,i.g.delete(c))}function To(i,c){return ge(i),c=Pe(i,c),i.g.has(c)}n.forEach=function(i,c){ge(this),this.g.forEach(function(u,d){u.forEach(function(A){i.call(c,A,d,this)},this)},this)};function Io(i,c){ge(i);let u=[];if(typeof c=="string")To(i,c)&&(u=u.concat(i.g.get(Pe(i,c))));else for(i=Array.from(i.g.values()),c=0;c<i.length;c++)u=u.concat(i[c]);return u}n.set=function(i,c){return ge(this),this.i=null,i=Pe(this,i),To(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[c]),this.h+=1,this},n.get=function(i,c){return i?(i=Io(this,i),i.length>0?String(i[0]):c):c};function vo(i,c,u){Eo(i,c),u.length>0&&(i.i=null,i.g.set(Pe(i,c),C(u)),i.h+=u.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],c=Array.from(this.g.keys());for(let d=0;d<c.length;d++){var u=c[d];const A=nn(u);u=Io(this,u);for(let R=0;R<u.length;R++){let P=A;u[R]!==""&&(P+="="+nn(u[R])),i.push(P)}}return this.i=i.join("&")};function wo(i){const c=new un;return c.i=i.i,i.g&&(c.g=new Map(i.g),c.h=i.h),c}function Pe(i,c){return c=String(c),i.j&&(c=c.toLowerCase()),c}function hl(i,c){c&&!i.j&&(ge(i),i.i=null,i.g.forEach(function(u,d){const A=d.toLowerCase();d!=A&&(Eo(this,d),vo(this,A,u))},i)),i.j=c}function fl(i,c){const u=new en;if(a.Image){const d=new Image;d.onload=m(Qt,u,"TestLoadImage: loaded",!0,c,d),d.onerror=m(Qt,u,"TestLoadImage: error",!1,c,d),d.onabort=m(Qt,u,"TestLoadImage: abort",!1,c,d),d.ontimeout=m(Qt,u,"TestLoadImage: timeout",!1,c,d),a.setTimeout(function(){d.ontimeout&&d.ontimeout()},1e4),d.src=i}else c(!1)}function dl(i,c){const u=new en,d=new AbortController,A=setTimeout(()=>{d.abort(),Qt(u,"TestPingServer: timeout",!1,c)},1e4);fetch(i,{signal:d.signal}).then(R=>{clearTimeout(A),R.ok?Qt(u,"TestPingServer: ok",!0,c):Qt(u,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(A),Qt(u,"TestPingServer: error",!1,c)})}function Qt(i,c,u,d,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),d(u)}catch{}}function ml(){this.g=new Xu}function ms(i){this.i=i.Sb||null,this.h=i.ab||!1}E(ms,Ji),ms.prototype.g=function(){return new Qn(this.i,this.h)};function Qn(i,c){_t.call(this),this.H=i,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}E(Qn,_t),n=Qn.prototype,n.open=function(i,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=i,this.D=c,this.readyState=1,hn(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};i&&(c.body=i),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,ln(this)),this.readyState=0},n.Pa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,hn(this)),this.g&&(this.readyState=3,hn(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Ao(this)}else i.text().then(this.Oa.bind(this),this.ga.bind(this))};function Ao(i){i.j.read().then(i.Ma.bind(i)).catch(i.ga.bind(i))}n.Ma=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var c=i.value?i.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!i.done}))&&(this.response=this.responseText+=c)}i.done?ln(this):hn(this),this.readyState==3&&Ao(this)}},n.Oa=function(i){this.g&&(this.response=this.responseText=i,ln(this))},n.Na=function(i){this.g&&(this.response=i,ln(this))},n.ga=function(){this.g&&ln(this)};function ln(i){i.readyState=4,i.l=null,i.j=null,i.B=null,hn(i)}n.setRequestHeader=function(i,c){this.A.append(i,c)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],c=this.h.entries();for(var u=c.next();!u.done;)u=u.value,i.push(u[0]+": "+u[1]),u=c.next();return i.join(`\r
`)};function hn(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(Qn.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function Ro(i){let c="";return be(i,function(u,d){c+=d,c+=":",c+=u,c+=`\r
`}),c}function ps(i,c,u){t:{for(d in u){var d=!1;break t}d=!0}d||(u=Ro(u),typeof i=="string"?u!=null&&nn(u):Y(i,c,u))}function tt(i){_t.call(this),this.headers=new Map,this.L=i||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}E(tt,_t);var pl=/^https?$/i,gl=["POST","PUT"];n=tt.prototype,n.Fa=function(i){this.H=i},n.ea=function(i,c,u,d){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);c=c?c.toUpperCase():"GET",this.D=i,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():io.g(),this.g.onreadystatechange=w(f(this.Ca,this));try{this.B=!0,this.g.open(c,String(i),!0),this.B=!1}catch(R){So(this,R);return}if(i=u||"",u=new Map(this.headers),d)if(Object.getPrototypeOf(d)===Object.prototype)for(var A in d)u.set(A,d[A]);else if(typeof d.keys=="function"&&typeof d.get=="function")for(const R of d.keys())u.set(R,d.get(R));else throw Error("Unknown input type for opt_headers: "+String(d));d=Array.from(u.keys()).find(R=>R.toLowerCase()=="content-type"),A=a.FormData&&i instanceof a.FormData,!(Array.prototype.indexOf.call(gl,c,void 0)>=0)||d||A||u.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[R,P]of u)this.g.setRequestHeader(R,P);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(i),this.v=!1}catch(R){So(this,R)}};function So(i,c){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=c,i.o=5,bo(i),Wn(i)}function bo(i){i.A||(i.A=!0,It(i,"complete"),It(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=i||7,It(this,"complete"),It(this,"abort"),Wn(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Wn(this,!0)),tt.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Co(this):this.Xa())},n.Xa=function(){Co(this)};function Co(i){if(i.h&&typeof o<"u"){if(i.v&&Wt(i)==4)setTimeout(i.Ca.bind(i),0);else if(It(i,"readystatechange"),Wt(i)==4){i.h=!1;try{const R=i.ca();t:switch(R){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break t;default:c=!1}var u;if(!(u=c)){var d;if(d=R===0){let P=String(i.D).match(_o)[1]||null;!P&&a.self&&a.self.location&&(P=a.self.location.protocol.slice(0,-1)),d=!pl.test(P?P.toLowerCase():"")}u=d}if(u)It(i,"complete"),It(i,"success");else{i.o=6;try{var A=Wt(i)>2?i.g.statusText:""}catch{A=""}i.l=A+" ["+i.ca()+"]",bo(i)}}finally{Wn(i)}}}}function Wn(i,c){if(i.g){i.m&&(clearTimeout(i.m),i.m=null);const u=i.g;i.g=null,c||It(i,"ready");try{u.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Wt(i){return i.g?i.g.readyState:0}n.ca=function(){try{return Wt(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(i){if(this.g){var c=this.g.responseText;return i&&c.indexOf(i)==0&&(c=c.substring(i.length)),Wu(c)}};function Po(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.F){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function _l(i){const c={};i=(i.g&&Wt(i)>=2&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let d=0;d<i.length;d++){if(p(i[d]))continue;var u=el(i[d]);const A=u[0];if(u=u[1],typeof u!="string")continue;u=u.trim();const R=c[A]||[];c[A]=R,R.push(u)}Wr(c,function(d){return d.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function fn(i,c,u){return u&&u.internalChannelParams&&u.internalChannelParams[i]||c}function Vo(i){this.za=0,this.i=[],this.j=new en,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=fn("failFast",!1,i),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=fn("baseRetryDelayMs",5e3,i),this.Za=fn("retryDelaySeedMs",1e4,i),this.Ta=fn("forwardChannelMaxRetries",2,i),this.va=fn("forwardChannelRequestTimeoutMs",2e4,i),this.ma=i&&i.xmlHttpFactory||void 0,this.Ua=i&&i.Rb||void 0,this.Aa=i&&i.useFetchStreams||!1,this.O=void 0,this.L=i&&i.supportsCrossDomainXhr||!1,this.M="",this.h=new ho(i&&i.concurrentRequestLimit),this.Ba=new ml,this.S=i&&i.fastHandshake||!1,this.R=i&&i.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=i&&i.Pb||!1,i&&i.ua&&this.j.ua(),i&&i.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&i&&i.detectBufferingProxy||!1,this.ia=void 0,i&&i.longPollingTimeout&&i.longPollingTimeout>0&&(this.ia=i.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Vo.prototype,n.ka=8,n.I=1,n.connect=function(i,c,u,d){vt(0),this.W=i,this.H=c||{},u&&d!==void 0&&(this.H.OSID=u,this.H.OAID=d),this.F=this.X,this.J=Uo(this,null,this.W),Yn(this)};function gs(i){if(Do(i),i.I==3){var c=i.V++,u=Nt(i.J);if(Y(u,"SID",i.M),Y(u,"RID",c),Y(u,"TYPE","terminate"),dn(i,u),c=new Ht(i,i.j,c),c.M=2,c.A=Kn(Nt(u)),u=!1,a.navigator&&a.navigator.sendBeacon)try{u=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!u&&a.Image&&(new Image().src=c.A,u=!0),u||(c.g=Bo(c.j,null),c.g.ea(c.A)),c.F=Date.now(),Hn(c)}Fo(i)}function Xn(i){i.g&&(ys(i),i.g.cancel(),i.g=null)}function Do(i){Xn(i),i.v&&(a.clearTimeout(i.v),i.v=null),Jn(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&a.clearTimeout(i.m),i.m=null)}function Yn(i){if(!fo(i.h)&&!i.m){i.m=!0;var c=i.Ea;dt||g(),et||(dt(),et=!0),T.add(c,i),i.D=0}}function yl(i,c){return mo(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=c.G.concat(i.i),!0):i.I==1||i.I==2||i.D>=(i.Sa?0:i.Ta)?!1:(i.m=tn(f(i.Ea,i,c),Lo(i,i.D)),i.D++,!0)}n.Ea=function(i){if(this.m)if(this.m=null,this.I==1){if(!i){this.V=Math.floor(Math.random()*1e5),i=this.V++;const A=new Ht(this,this.j,i);let R=this.o;if(this.U&&(R?(R=ji(R),zi(R,this.U)):R=this.U),this.u!==null||this.R||(A.J=R,R=null),this.S)t:{for(var c=0,u=0;u<this.i.length;u++){e:{var d=this.i[u];if("__data__"in d.map&&(d=d.map.__data__,typeof d=="string")){d=d.length;break e}d=void 0}if(d===void 0)break;if(c+=d,c>4096){c=u;break t}if(c===4096||u===this.i.length-1){c=u+1;break t}}c=1e3}else c=1e3;c=ko(this,A,c),u=Nt(this.J),Y(u,"RID",i),Y(u,"CVER",22),this.G&&Y(u,"X-HTTP-Session-Id",this.G),dn(this,u),R&&(this.R?c="headers="+nn(Ro(R))+"&"+c:this.u&&ps(u,this.u,R)),fs(this.h,A),this.Ra&&Y(u,"TYPE","init"),this.S?(Y(u,"$req",c),Y(u,"SID","null"),A.U=!0,cs(A,u,null)):cs(A,u,c),this.I=2}}else this.I==3&&(i?No(this,i):this.i.length==0||fo(this.h)||No(this))};function No(i,c){var u;c?u=c.l:u=i.V++;const d=Nt(i.J);Y(d,"SID",i.M),Y(d,"RID",u),Y(d,"AID",i.K),dn(i,d),i.u&&i.o&&ps(d,i.u,i.o),u=new Ht(i,i.j,u,i.D+1),i.u===null&&(u.J=i.o),c&&(i.i=c.G.concat(i.i)),c=ko(i,u,1e3),u.H=Math.round(i.va*.5)+Math.round(i.va*.5*Math.random()),fs(i.h,u),cs(u,d,c)}function dn(i,c){i.H&&be(i.H,function(u,d){Y(c,d,u)}),i.l&&be({},function(u,d){Y(c,d,u)})}function ko(i,c,u){u=Math.min(i.i.length,u);const d=i.l?f(i.l.Ka,i.l,i):null;t:{var A=i.i;let B=-1;for(;;){const ct=["count="+u];B==-1?u>0?(B=A[0].g,ct.push("ofs="+B)):B=0:ct.push("ofs="+B);let W=!0;for(let ht=0;ht<u;ht++){var R=A[ht].g;const kt=A[ht].map;if(R-=B,R<0)B=Math.max(0,A[ht].g-100),W=!1;else try{R="req"+R+"_"||"";try{var P=kt instanceof Map?kt:Object.entries(kt);for(const[ye,Xt]of P){let Yt=Xt;l(Xt)&&(Yt=rs(Xt)),ct.push(R+ye+"="+encodeURIComponent(Yt))}}catch(ye){throw ct.push(R+"type="+encodeURIComponent("_badmap")),ye}}catch{d&&d(kt)}}if(W){P=ct.join("&");break t}}P=void 0}return i=i.i.splice(0,u),c.G=i,P}function Mo(i){if(!i.g&&!i.v){i.Y=1;var c=i.Da;dt||g(),et||(dt(),et=!0),T.add(c,i),i.A=0}}function _s(i){return i.g||i.v||i.A>=3?!1:(i.Y++,i.v=tn(f(i.Da,i),Lo(i,i.A)),i.A++,!0)}n.Da=function(){if(this.v=null,Oo(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var i=4*this.T;this.j.info("BP detection timer enabled: "+i),this.B=tn(f(this.Wa,this),i)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,vt(10),Xn(this),Oo(this))};function ys(i){i.B!=null&&(a.clearTimeout(i.B),i.B=null)}function Oo(i){i.g=new Ht(i,i.j,"rpc",i.Y),i.u===null&&(i.g.J=i.o),i.g.P=0;var c=Nt(i.na);Y(c,"RID","rpc"),Y(c,"SID",i.M),Y(c,"AID",i.K),Y(c,"CI",i.F?"0":"1"),!i.F&&i.ia&&Y(c,"TO",i.ia),Y(c,"TYPE","xmlhttp"),dn(i,c),i.u&&i.o&&ps(c,i.u,i.o),i.O&&(i.g.H=i.O);var u=i.g;i=i.ba,u.M=1,u.A=Kn(Nt(c)),u.u=null,u.R=!0,co(u,i)}n.Va=function(){this.C!=null&&(this.C=null,Xn(this),_s(this),vt(19))};function Jn(i){i.C!=null&&(a.clearTimeout(i.C),i.C=null)}function xo(i,c){var u=null;if(i.g==c){Jn(i),ys(i),i.g=null;var d=2}else if(hs(i.h,c))u=c.G,po(i.h,c),d=1;else return;if(i.I!=0){if(c.o)if(d==1){u=c.u?c.u.length:0,c=Date.now()-c.F;var A=i.D;d=zn(),It(d,new ro(d,u)),Yn(i)}else Mo(i);else if(A=c.m,A==3||A==0&&c.X>0||!(d==1&&yl(i,c)||d==2&&_s(i)))switch(u&&u.length>0&&(c=i.h,c.i=c.i.concat(u)),A){case 1:_e(i,5);break;case 4:_e(i,10);break;case 3:_e(i,6);break;default:_e(i,2)}}}function Lo(i,c){let u=i.Qa+Math.floor(Math.random()*i.Za);return i.isActive()||(u*=2),u*c}function _e(i,c){if(i.j.info("Error code "+c),c==2){var u=f(i.bb,i),d=i.Ua;const A=!d;d=new Kt(d||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||sn(d,"https"),Kn(d),A?fl(d.toString(),u):dl(d.toString(),u)}else vt(2);i.I=0,i.l&&i.l.pa(c),Fo(i),Do(i)}n.bb=function(i){i?(this.j.info("Successfully pinged google.com"),vt(2)):(this.j.info("Failed to ping google.com"),vt(1))};function Fo(i){if(i.I=0,i.ja=[],i.l){const c=go(i.h);(c.length!=0||i.i.length!=0)&&(k(i.ja,c),k(i.ja,i.i),i.h.i.length=0,C(i.i),i.i.length=0),i.l.oa()}}function Uo(i,c,u){var d=u instanceof Kt?Nt(u):new Kt(u);if(d.g!="")c&&(d.g=c+"."+d.g),on(d,d.u);else{var A=a.location;d=A.protocol,c=c?c+"."+A.hostname:A.hostname,A=+A.port;const R=new Kt(null);d&&sn(R,d),c&&(R.g=c),A&&on(R,A),u&&(R.h=u),d=R}return u=i.G,c=i.wa,u&&c&&Y(d,u,c),Y(d,"VER",i.ka),dn(i,d),d}function Bo(i,c,u){if(c&&!i.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=i.Aa&&!i.ma?new tt(new ms({ab:u})):new tt(i.ma),c.Fa(i.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function qo(){}n=qo.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Zn(){}Zn.prototype.g=function(i,c){return new Rt(i,c)};function Rt(i,c){_t.call(this),this.g=new Vo(c),this.l=i,this.h=c&&c.messageUrlParams||null,i=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(i?i["X-WebChannel-Content-Type"]=c.messageContentType:i={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(i?i["X-WebChannel-Client-Profile"]=c.sa:i={"X-WebChannel-Client-Profile":c.sa}),this.g.U=i,(i=c&&c.Qb)&&!p(i)&&(this.g.u=i),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!p(c)&&(this.g.G=c,i=this.h,i!==null&&c in i&&(i=this.h,c in i&&delete i[c])),this.j=new Ve(this)}E(Rt,_t),Rt.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Rt.prototype.close=function(){gs(this.g)},Rt.prototype.o=function(i){var c=this.g;if(typeof i=="string"){var u={};u.__data__=i,i=u}else this.v&&(u={},u.__data__=rs(i),i=u);c.i.push(new sl(c.Ya++,i)),c.I==3&&Yn(c)},Rt.prototype.N=function(){this.g.l=null,delete this.j,gs(this.g),delete this.g,Rt.Z.N.call(this)};function jo(i){ss.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var c=i.__sm__;if(c){t:{for(const u in c){i=u;break t}i=void 0}(this.i=i)&&(i=this.i,c=c!==null&&i in c?c[i]:void 0),this.data=c}else this.data=i}E(jo,ss);function $o(){is.call(this),this.status=1}E($o,is);function Ve(i){this.g=i}E(Ve,qo),Ve.prototype.ra=function(){It(this.g,"a")},Ve.prototype.qa=function(i){It(this.g,new jo(i))},Ve.prototype.pa=function(i){It(this.g,new $o)},Ve.prototype.oa=function(){It(this.g,"b")},Zn.prototype.createWebChannel=Zn.prototype.g,Rt.prototype.send=Rt.prototype.o,Rt.prototype.open=Rt.prototype.m,Rt.prototype.close=Rt.prototype.close,Tc=function(){return new Zn},Ec=function(){return zn()},yc=me,xs={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Gn.NO_ERROR=0,Gn.TIMEOUT=8,Gn.HTTP_ERROR=6,cr=Gn,so.COMPLETE="complete",_c=so,Zi.EventType=Je,Je.OPEN="a",Je.CLOSE="b",Je.ERROR="c",Je.MESSAGE="d",_t.prototype.listen=_t.prototype.J,gn=Zi,tt.prototype.listenOnce=tt.prototype.K,tt.prototype.getLastError=tt.prototype.Ha,tt.prototype.getLastErrorCode=tt.prototype.ya,tt.prototype.getStatus=tt.prototype.ca,tt.prototype.getResponseJson=tt.prototype.La,tt.prototype.getResponseText=tt.prototype.la,tt.prototype.send=tt.prototype.ea,tt.prototype.setWithCredentials=tt.prototype.Fa,gc=tt}).apply(typeof er<"u"?er:typeof self<"u"?self:typeof window<"u"?window:{});const na="@firebase/firestore",ra="4.9.3";class Et{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Et.UNAUTHENTICATED=new Et(null),Et.GOOGLE_CREDENTIALS=new Et("google-credentials-uid"),Et.FIRST_PARTY=new Et("first-party-uid"),Et.MOCK_USER=new Et("mock-user");let Ge="12.7.0";const we=new uc("@firebase/firestore");function De(){return we.logLevel}function N(n,...t){if(we.logLevel<=H.DEBUG){const e=t.map(ri);we.debug(`Firestore (${Ge}): ${n}`,...e)}}function zt(n,...t){if(we.logLevel<=H.ERROR){const e=t.map(ri);we.error(`Firestore (${Ge}): ${n}`,...e)}}function Fe(n,...t){if(we.logLevel<=H.WARN){const e=t.map(ri);we.warn(`Firestore (${Ge}): ${n}`,...e)}}function ri(n){if(typeof n=="string")return n;try{return(function(e){return JSON.stringify(e)})(n)}catch{return n}}function x(n,t,e){let r="Unexpected state";typeof t=="string"?r=t:e=t,Ic(n,r,e)}function Ic(n,t,e){let r=`FIRESTORE (${Ge}) INTERNAL ASSERTION FAILED: ${t} (ID: ${n.toString(16)})`;if(e!==void 0)try{r+=" CONTEXT: "+JSON.stringify(e)}catch{r+=" CONTEXT: "+e}throw zt(r),new Error(r)}function Q(n,t,e,r){let s="Unexpected state";typeof e=="string"?s=e:r=e,n||Ic(t,s,r)}function U(n,t){return n}const S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class D extends ze{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class jt{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class vc{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class sf{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Et.UNAUTHENTICATED)))}shutdown(){}}class of{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class af{constructor(t){this.t=t,this.currentUser=Et.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){Q(this.o===void 0,42304);let r=this.i;const s=h=>this.i!==r?(r=this.i,e(h)):Promise.resolve();let o=new jt;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new jt,t.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const h=o;t.enqueueRetryable((async()=>{await h.promise,await s(this.currentUser)}))},l=h=>{N("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((h=>l(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?l(h):(N("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new jt)}}),0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((r=>this.i!==t?(N("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Q(typeof r.accessToken=="string",31837,{l:r}),new vc(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return Q(t===null||typeof t=="string",2055,{h:t}),new Et(t)}}class cf{constructor(t,e,r){this.P=t,this.T=e,this.I=r,this.type="FirstParty",this.user=Et.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class uf{constructor(t,e,r){this.P=t,this.T=e,this.I=r}getToken(){return Promise.resolve(new cf(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable((()=>e(Et.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class sa{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class lf{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,qh(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){Q(this.o===void 0,3512);const r=o=>{o.error!=null&&N("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,N("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(o.token):Promise.resolve()};this.o=o=>{t.enqueueRetryable((()=>r(o)))};const s=o=>{N("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>s(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):N("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new sa(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((e=>e?(Q(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new sa(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function hf(n){const t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}class si{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=hf(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<e&&(r+=t.charAt(s[o]%62))}return r}}function j(n,t){return n<t?-1:n>t?1:0}function Ls(n,t){const e=Math.min(n.length,t.length);for(let r=0;r<e;r++){const s=n.charAt(r),o=t.charAt(r);if(s!==o)return As(s)===As(o)?j(s,o):As(s)?1:-1}return j(n.length,t.length)}const ff=55296,df=57343;function As(n){const t=n.charCodeAt(0);return t>=ff&&t<=df}function Ue(n,t,e){return n.length===t.length&&n.every(((r,s)=>e(r,t[s])))}const ia="__name__";class Ot{constructor(t,e,r){e===void 0?e=0:e>t.length&&x(637,{offset:e,range:t.length}),r===void 0?r=t.length-e:r>t.length-e&&x(1746,{length:r,range:t.length-e}),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return Ot.comparator(this,t)===0}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Ot?t.forEach((r=>{e.push(r)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const r=Math.min(t.length,e.length);for(let s=0;s<r;s++){const o=Ot.compareSegments(t.get(s),e.get(s));if(o!==0)return o}return j(t.length,e.length)}static compareSegments(t,e){const r=Ot.isNumericId(t),s=Ot.isNumericId(e);return r&&!s?-1:!r&&s?1:r&&s?Ot.extractNumericId(t).compare(Ot.extractNumericId(e)):Ls(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return ee.fromString(t.substring(4,t.length-2))}}class X extends Ot{construct(t,e,r){return new X(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const r of t){if(r.indexOf("//")>=0)throw new D(S.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter((s=>s.length>0)))}return new X(e)}static emptyPath(){return new X([])}}const mf=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class pt extends Ot{construct(t,e,r){return new pt(t,e,r)}static isValidIdentifier(t){return mf.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),pt.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===ia}static keyField(){return new pt([ia])}static fromServerFormat(t){const e=[];let r="",s=0;const o=()=>{if(r.length===0)throw new D(S.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""};let a=!1;for(;s<t.length;){const l=t[s];if(l==="\\"){if(s+1===t.length)throw new D(S.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const h=t[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new D(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=h,s+=2}else l==="`"?(a=!a,s++):l!=="."||a?(r+=l,s++):(o(),s++)}if(o(),a)throw new D(S.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new pt(e)}static emptyPath(){return new pt([])}}class O{constructor(t){this.path=t}static fromPath(t){return new O(X.fromString(t))}static fromName(t){return new O(X.fromString(t).popFirst(5))}static empty(){return new O(X.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&X.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return X.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new O(new X(t.slice()))}}function wc(n,t,e){if(!e)throw new D(S.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function pf(n,t,e,r){if(t===!0&&r===!0)throw new D(S.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function oa(n){if(!O.isDocumentKey(n))throw new D(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function aa(n){if(O.isDocumentKey(n))throw new D(S.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Ac(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Pr(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const t=(function(r){return r.constructor?r.constructor.name:null})(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":x(12329,{type:typeof n})}function Ct(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new D(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=Pr(n);throw new D(S.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}function at(n,t){const e={typeString:n};return t&&(e.value=t),e}function On(n,t){if(!Ac(n))throw new D(S.INVALID_ARGUMENT,"JSON must be an object");let e;for(const r in t)if(t[r]){const s=t[r].typeString,o="value"in t[r]?{value:t[r].value}:void 0;if(!(r in n)){e=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){e=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&a!==o.value){e=`Expected '${r}' field to equal '${o.value}'`;break}}if(e)throw new D(S.INVALID_ARGUMENT,e);return!0}const ca=-62135596800,ua=1e6;class J{static now(){return J.fromMillis(Date.now())}static fromDate(t){return J.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),r=Math.floor((t-1e3*e)*ua);return new J(e,r)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new D(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new D(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<ca)throw new D(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new D(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/ua}_compareTo(t){return this.seconds===t.seconds?j(this.nanoseconds,t.nanoseconds):j(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:J._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(On(t,J._jsonSchema))return new J(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-ca;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}J._jsonSchemaVersion="firestore/timestamp/1.0",J._jsonSchema={type:at("string",J._jsonSchemaVersion),seconds:at("number"),nanoseconds:at("number")};class F{static fromTimestamp(t){return new F(t)}static min(){return new F(new J(0,0))}static max(){return new F(new J(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const bn=-1;function gf(n,t){const e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=F.fromTimestamp(r===1e9?new J(e+1,0):new J(e,r));return new re(s,O.empty(),t)}function _f(n){return new re(n.readTime,n.key,bn)}class re{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new re(F.min(),O.empty(),bn)}static max(){return new re(F.max(),O.empty(),bn)}}function yf(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=O.comparator(n.documentKey,t.documentKey),e!==0?e:j(n.largestBatchId,t.largestBatchId))}const Ef="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Tf{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function He(n){if(n.code!==S.FAILED_PRECONDITION||n.message!==Ef)throw n;N("LocalStore","Unexpectedly lost primary lease")}class b{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&x(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new b(((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(t,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(e,o).next(r,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof b?e:b.resolve(e)}catch(e){return b.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):b.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):b.reject(e)}static resolve(t){return new b(((e,r)=>{e(t)}))}static reject(t){return new b(((e,r)=>{r(t)}))}static waitFor(t){return new b(((e,r)=>{let s=0,o=0,a=!1;t.forEach((l=>{++s,l.next((()=>{++o,a&&o===s&&e()}),(h=>r(h)))})),a=!0,o===s&&e()}))}static or(t){let e=b.resolve(!1);for(const r of t)e=e.next((s=>s?b.resolve(s):r()));return e}static forEach(t,e){const r=[];return t.forEach(((s,o)=>{r.push(e.call(this,s,o))})),this.waitFor(r)}static mapArray(t,e){return new b(((r,s)=>{const o=t.length,a=new Array(o);let l=0;for(let h=0;h<o;h++){const f=h;e(t[f]).next((m=>{a[f]=m,++l,l===o&&r(a)}),(m=>s(m)))}}))}static doWhile(t,e){return new b(((r,s)=>{const o=()=>{t()===!0?e().next((()=>{o()}),s):r()};o()}))}}function If(n){const t=n.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function Ke(n){return n.name==="IndexedDbTransactionError"}class Vr{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>e.writeSequenceNumber(r))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}Vr.ce=-1;const ii=-1;function Dr(n){return n==null}function yr(n){return n===0&&1/n==-1/0}function vf(n){return typeof n=="number"&&Number.isInteger(n)&&!yr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const Rc="";function wf(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=la(t)),t=Af(n.get(e),t);return la(t)}function Af(n,t){let e=t;const r=n.length;for(let s=0;s<r;s++){const o=n.charAt(s);switch(o){case"\0":e+="";break;case Rc:e+="";break;default:e+=o}}return e}function la(n){return n+Rc+""}function ha(n){let t=0;for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function le(n,t){for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function Sc(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}class Z{constructor(t,e){this.comparator=t,this.root=e||mt.EMPTY}insert(t,e){return new Z(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,mt.BLACK,null,null))}remove(t){return new Z(this.comparator,this.root.remove(t,this.comparator).copy(null,null,mt.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const r=this.comparator(t,e.key);if(r===0)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(t,r.key);if(s===0)return e+r.left.size;s<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,r)=>(t(e,r),!1)))}toString(){const t=[];return this.inorderTraversal(((e,r)=>(t.push(`${e}:${r}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new nr(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new nr(this.root,t,this.comparator,!1)}getReverseIterator(){return new nr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new nr(this.root,t,this.comparator,!0)}}class nr{constructor(t,e,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!t.isEmpty();)if(o=e?r(t.key,e):1,e&&s&&(o*=-1),o<0)t=this.isReverse?t.left:t.right;else{if(o===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class mt{constructor(t,e,r,s,o){this.key=t,this.value=e,this.color=r??mt.RED,this.left=s??mt.EMPTY,this.right=o??mt.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,s,o){return new mt(t??this.key,e??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let s=this;const o=r(t,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(t,e,r),null):o===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return mt.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return mt.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,mt.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,mt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw x(43730,{key:this.key,value:this.value});if(this.right.isRed())throw x(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw x(27949);return t+(this.isRed()?0:1)}}mt.EMPTY=null,mt.RED=!0,mt.BLACK=!1;mt.EMPTY=new class{constructor(){this.size=0}get key(){throw x(57766)}get value(){throw x(16141)}get color(){throw x(16727)}get left(){throw x(29726)}get right(){throw x(36894)}copy(t,e,r,s,o){return this}insert(t,e,r){return new mt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ut{constructor(t){this.comparator=t,this.data=new Z(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,r)=>(t(e),!1)))}forEachInRange(t,e){const r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let r;for(r=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new fa(this.data.getIterator())}getIteratorFrom(t){return new fa(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((r=>{e=e.add(r)})),e}isEqual(t){if(!(t instanceof ut)||this.size!==t.size)return!1;const e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){const s=e.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new ut(this.comparator);return e.data=t,e}}class fa{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class St{constructor(t){this.fields=t,t.sort(pt.comparator)}static empty(){return new St([])}unionWith(t){let e=new ut(pt.comparator);for(const r of this.fields)e=e.add(r);for(const r of t)e=e.add(r);return new St(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Ue(this.fields,t.fields,((e,r)=>e.isEqual(r)))}}class bc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class gt{constructor(t){this.binaryString=t}static fromBase64String(t){const e=(function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new bc("Invalid base64 string: "+o):o}})(t);return new gt(e)}static fromUint8Array(t){const e=(function(s){let o="";for(let a=0;a<s.length;++a)o+=String.fromCharCode(s[a]);return o})(t);return new gt(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(e){return btoa(e)})(this.binaryString)}toUint8Array(){return(function(e){const r=new Uint8Array(e.length);for(let s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return j(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}gt.EMPTY_BYTE_STRING=new gt("");const Rf=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function se(n){if(Q(!!n,39018),typeof n=="string"){let t=0;const e=Rf.exec(n);if(Q(!!e,46558,{timestamp:n}),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:nt(n.seconds),nanos:nt(n.nanos)}}function nt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ie(n){return typeof n=="string"?gt.fromBase64String(n):gt.fromUint8Array(n)}const Cc="server_timestamp",Pc="__type__",Vc="__previous_value__",Dc="__local_write_time__";function oi(n){return(n?.mapValue?.fields||{})[Pc]?.stringValue===Cc}function Nr(n){const t=n.mapValue.fields[Vc];return oi(t)?Nr(t):t}function Cn(n){const t=se(n.mapValue.fields[Dc].timestampValue);return new J(t.seconds,t.nanos)}class Sf{constructor(t,e,r,s,o,a,l,h,f,m){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=h,this.useFetchStreams=f,this.isUsingEmulator=m}}const Er="(default)";class Pn{constructor(t,e){this.projectId=t,this.database=e||Er}static empty(){return new Pn("","")}get isDefaultDatabase(){return this.database===Er}isEqual(t){return t instanceof Pn&&t.projectId===this.projectId&&t.database===this.database}}const Nc="__type__",bf="__max__",rr={mapValue:{}},kc="__vector__",Tr="value";function oe(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?oi(n)?4:Pf(n)?9007199254740991:Cf(n)?10:11:x(28295,{value:n})}function qt(n,t){if(n===t)return!0;const e=oe(n);if(e!==oe(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return Cn(n).isEqual(Cn(t));case 3:return(function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const a=se(s.timestampValue),l=se(o.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos})(n,t);case 5:return n.stringValue===t.stringValue;case 6:return(function(s,o){return ie(s.bytesValue).isEqual(ie(o.bytesValue))})(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return(function(s,o){return nt(s.geoPointValue.latitude)===nt(o.geoPointValue.latitude)&&nt(s.geoPointValue.longitude)===nt(o.geoPointValue.longitude)})(n,t);case 2:return(function(s,o){if("integerValue"in s&&"integerValue"in o)return nt(s.integerValue)===nt(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const a=nt(s.doubleValue),l=nt(o.doubleValue);return a===l?yr(a)===yr(l):isNaN(a)&&isNaN(l)}return!1})(n,t);case 9:return Ue(n.arrayValue.values||[],t.arrayValue.values||[],qt);case 10:case 11:return(function(s,o){const a=s.mapValue.fields||{},l=o.mapValue.fields||{};if(ha(a)!==ha(l))return!1;for(const h in a)if(a.hasOwnProperty(h)&&(l[h]===void 0||!qt(a[h],l[h])))return!1;return!0})(n,t);default:return x(52216,{left:n})}}function Vn(n,t){return(n.values||[]).find((e=>qt(e,t)))!==void 0}function Be(n,t){if(n===t)return 0;const e=oe(n),r=oe(t);if(e!==r)return j(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return j(n.booleanValue,t.booleanValue);case 2:return(function(o,a){const l=nt(o.integerValue||o.doubleValue),h=nt(a.integerValue||a.doubleValue);return l<h?-1:l>h?1:l===h?0:isNaN(l)?isNaN(h)?0:-1:1})(n,t);case 3:return da(n.timestampValue,t.timestampValue);case 4:return da(Cn(n),Cn(t));case 5:return Ls(n.stringValue,t.stringValue);case 6:return(function(o,a){const l=ie(o),h=ie(a);return l.compareTo(h)})(n.bytesValue,t.bytesValue);case 7:return(function(o,a){const l=o.split("/"),h=a.split("/");for(let f=0;f<l.length&&f<h.length;f++){const m=j(l[f],h[f]);if(m!==0)return m}return j(l.length,h.length)})(n.referenceValue,t.referenceValue);case 8:return(function(o,a){const l=j(nt(o.latitude),nt(a.latitude));return l!==0?l:j(nt(o.longitude),nt(a.longitude))})(n.geoPointValue,t.geoPointValue);case 9:return ma(n.arrayValue,t.arrayValue);case 10:return(function(o,a){const l=o.fields||{},h=a.fields||{},f=l[Tr]?.arrayValue,m=h[Tr]?.arrayValue,E=j(f?.values?.length||0,m?.values?.length||0);return E!==0?E:ma(f,m)})(n.mapValue,t.mapValue);case 11:return(function(o,a){if(o===rr.mapValue&&a===rr.mapValue)return 0;if(o===rr.mapValue)return 1;if(a===rr.mapValue)return-1;const l=o.fields||{},h=Object.keys(l),f=a.fields||{},m=Object.keys(f);h.sort(),m.sort();for(let E=0;E<h.length&&E<m.length;++E){const w=Ls(h[E],m[E]);if(w!==0)return w;const C=Be(l[h[E]],f[m[E]]);if(C!==0)return C}return j(h.length,m.length)})(n.mapValue,t.mapValue);default:throw x(23264,{he:e})}}function da(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return j(n,t);const e=se(n),r=se(t),s=j(e.seconds,r.seconds);return s!==0?s:j(e.nanos,r.nanos)}function ma(n,t){const e=n.values||[],r=t.values||[];for(let s=0;s<e.length&&s<r.length;++s){const o=Be(e[s],r[s]);if(o)return o}return j(e.length,r.length)}function qe(n){return Fs(n)}function Fs(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(e){const r=se(e);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(e){return ie(e).toBase64()})(n.bytesValue):"referenceValue"in n?(function(e){return O.fromName(e).toString()})(n.referenceValue):"geoPointValue"in n?(function(e){return`geo(${e.latitude},${e.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(e){let r="[",s=!0;for(const o of e.values||[])s?s=!1:r+=",",r+=Fs(o);return r+"]"})(n.arrayValue):"mapValue"in n?(function(e){const r=Object.keys(e.fields||{}).sort();let s="{",o=!0;for(const a of r)o?o=!1:s+=",",s+=`${a}:${Fs(e.fields[a])}`;return s+"}"})(n.mapValue):x(61005,{value:n})}function ur(n){switch(oe(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Nr(n);return t?16+ur(t):16;case 5:return 2*n.stringValue.length;case 6:return ie(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,o)=>s+ur(o)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return le(r.fields,((o,a)=>{s+=o.length+ur(a)})),s})(n.mapValue);default:throw x(13486,{value:n})}}function pa(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function Us(n){return!!n&&"integerValue"in n}function ai(n){return!!n&&"arrayValue"in n}function ga(n){return!!n&&"nullValue"in n}function _a(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function lr(n){return!!n&&"mapValue"in n}function Cf(n){return(n?.mapValue?.fields||{})[Nc]?.stringValue===kc}function In(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const t={mapValue:{fields:{}}};return le(n.mapValue.fields,((e,r)=>t.mapValue.fields[e]=In(r))),t}if(n.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=In(n.arrayValue.values[e]);return t}return{...n}}function Pf(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===bf}class At{constructor(t){this.value=t}static empty(){return new At({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!lr(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=In(e)}setAll(t){let e=pt.emptyPath(),r={},s=[];t.forEach(((a,l)=>{if(!e.isImmediateParentOf(l)){const h=this.getFieldsMap(e);this.applyChanges(h,r,s),r={},s=[],e=l.popLast()}a?r[l.lastSegment()]=In(a):s.push(l.lastSegment())}));const o=this.getFieldsMap(e);this.applyChanges(o,r,s)}delete(t){const e=this.field(t.popLast());lr(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return qt(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let s=e.mapValue.fields[t.get(r)];lr(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,r){le(e,((s,o)=>t[s]=o));for(const s of r)delete t[s]}clone(){return new At(In(this.value))}}function Mc(n){const t=[];return le(n.fields,((e,r)=>{const s=new pt([e]);if(lr(r)){const o=Mc(r.mapValue).fields;if(o.length===0)t.push(s);else for(const a of o)t.push(s.child(a))}else t.push(s)})),new St(t)}class Tt{constructor(t,e,r,s,o,a,l){this.key=t,this.documentType=e,this.version=r,this.readTime=s,this.createTime=o,this.data=a,this.documentState=l}static newInvalidDocument(t){return new Tt(t,0,F.min(),F.min(),F.min(),At.empty(),0)}static newFoundDocument(t,e,r,s){return new Tt(t,1,e,F.min(),r,s,0)}static newNoDocument(t,e){return new Tt(t,2,e,F.min(),F.min(),At.empty(),0)}static newUnknownDocument(t,e){return new Tt(t,3,e,F.min(),F.min(),At.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(F.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=At.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=At.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=F.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Tt&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Tt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Ir{constructor(t,e){this.position=t,this.inclusive=e}}function ya(n,t,e){let r=0;for(let s=0;s<n.position.length;s++){const o=t[s],a=n.position[s];if(o.field.isKeyField()?r=O.comparator(O.fromName(a.referenceValue),e.key):r=Be(a,e.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Ea(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!qt(n.position[e],t.position[e]))return!1;return!0}class Dn{constructor(t,e="asc"){this.field=t,this.dir=e}}function Vf(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}class Oc{}class ot extends Oc{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,r):new Nf(t,e,r):e==="array-contains"?new Of(t,r):e==="in"?new xf(t,r):e==="not-in"?new Lf(t,r):e==="array-contains-any"?new Ff(t,r):new ot(t,e,r)}static createKeyFieldInFilter(t,e,r){return e==="in"?new kf(t,r):new Mf(t,r)}matches(t){const e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(Be(e,this.value)):e!==null&&oe(this.value)===oe(e)&&this.matchesComparison(Be(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return x(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Dt extends Oc{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new Dt(t,e)}matches(t){return xc(this)?this.filters.find((e=>!e.matches(t)))===void 0:this.filters.find((e=>e.matches(t)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function xc(n){return n.op==="and"}function Lc(n){return Df(n)&&xc(n)}function Df(n){for(const t of n.filters)if(t instanceof Dt)return!1;return!0}function Bs(n){if(n instanceof ot)return n.field.canonicalString()+n.op.toString()+qe(n.value);if(Lc(n))return n.filters.map((t=>Bs(t))).join(",");{const t=n.filters.map((e=>Bs(e))).join(",");return`${n.op}(${t})`}}function Fc(n,t){return n instanceof ot?(function(r,s){return s instanceof ot&&r.op===s.op&&r.field.isEqual(s.field)&&qt(r.value,s.value)})(n,t):n instanceof Dt?(function(r,s){return s instanceof Dt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((o,a,l)=>o&&Fc(a,s.filters[l])),!0):!1})(n,t):void x(19439)}function Uc(n){return n instanceof ot?(function(e){return`${e.field.canonicalString()} ${e.op} ${qe(e.value)}`})(n):n instanceof Dt?(function(e){return e.op.toString()+" {"+e.getFilters().map(Uc).join(" ,")+"}"})(n):"Filter"}class Nf extends ot{constructor(t,e,r){super(t,e,r),this.key=O.fromName(r.referenceValue)}matches(t){const e=O.comparator(t.key,this.key);return this.matchesComparison(e)}}class kf extends ot{constructor(t,e){super(t,"in",e),this.keys=Bc("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Mf extends ot{constructor(t,e){super(t,"not-in",e),this.keys=Bc("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Bc(n,t){return(t.arrayValue?.values||[]).map((e=>O.fromName(e.referenceValue)))}class Of extends ot{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return ai(e)&&Vn(e.arrayValue,this.value)}}class xf extends ot{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return e!==null&&Vn(this.value.arrayValue,e)}}class Lf extends ot{constructor(t,e){super(t,"not-in",e)}matches(t){if(Vn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!Vn(this.value.arrayValue,e)}}class Ff extends ot{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!ai(e)||!e.arrayValue.values)&&e.arrayValue.values.some((r=>Vn(this.value.arrayValue,r)))}}class Uf{constructor(t,e=null,r=[],s=[],o=null,a=null,l=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=a,this.endAt=l,this.Te=null}}function Ta(n,t=null,e=[],r=[],s=null,o=null,a=null){return new Uf(n,t,e,r,s,o,a)}function ci(n){const t=U(n);if(t.Te===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((r=>Bs(r))).join(","),e+="|ob:",e+=t.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),Dr(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((r=>qe(r))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((r=>qe(r))).join(",")),t.Te=e}return t.Te}function ui(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!Vf(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!Fc(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!Ea(n.startAt,t.startAt)&&Ea(n.endAt,t.endAt)}function qs(n){return O.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class Qe{constructor(t,e=null,r=[],s=[],o=null,a="F",l=null,h=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=a,this.startAt=l,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Bf(n,t,e,r,s,o,a,l){return new Qe(n,t,e,r,s,o,a,l)}function kr(n){return new Qe(n)}function Ia(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function qc(n){return n.collectionGroup!==null}function vn(n){const t=U(n);if(t.Ie===null){t.Ie=[];const e=new Set;for(const o of t.explicitOrderBy)t.Ie.push(o),e.add(o.field.canonicalString());const r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new ut(pt.comparator);return a.filters.forEach((h=>{h.getFlattenedFilters().forEach((f=>{f.isInequality()&&(l=l.add(f.field))}))})),l})(t).forEach((o=>{e.has(o.canonicalString())||o.isKeyField()||t.Ie.push(new Dn(o,r))})),e.has(pt.keyField().canonicalString())||t.Ie.push(new Dn(pt.keyField(),r))}return t.Ie}function xt(n){const t=U(n);return t.Ee||(t.Ee=qf(t,vn(n))),t.Ee}function qf(n,t){if(n.limitType==="F")return Ta(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map((s=>{const o=s.dir==="desc"?"asc":"desc";return new Dn(s.field,o)}));const e=n.endAt?new Ir(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Ir(n.startAt.position,n.startAt.inclusive):null;return Ta(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}function js(n,t){const e=n.filters.concat([t]);return new Qe(n.path,n.collectionGroup,n.explicitOrderBy.slice(),e,n.limit,n.limitType,n.startAt,n.endAt)}function $s(n,t,e){return new Qe(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function Mr(n,t){return ui(xt(n),xt(t))&&n.limitType===t.limitType}function jc(n){return`${ci(xt(n))}|lt:${n.limitType}`}function Ne(n){return`Query(target=${(function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map((s=>Uc(s))).join(", ")}]`),Dr(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map((s=>qe(s))).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map((s=>qe(s))).join(",")),`Target(${r})`})(xt(n))}; limitType=${n.limitType})`}function Or(n,t){return t.isFoundDocument()&&(function(r,s){const o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):O.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(n,t)&&(function(r,s){for(const o of vn(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0})(n,t)&&(function(r,s){for(const o of r.filters)if(!o.matches(s))return!1;return!0})(n,t)&&(function(r,s){return!(r.startAt&&!(function(a,l,h){const f=ya(a,l,h);return a.inclusive?f<=0:f<0})(r.startAt,vn(r),s)||r.endAt&&!(function(a,l,h){const f=ya(a,l,h);return a.inclusive?f>=0:f>0})(r.endAt,vn(r),s))})(n,t)}function jf(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function $c(n){return(t,e)=>{let r=!1;for(const s of vn(n)){const o=$f(s,t,e);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function $f(n,t,e){const r=n.field.isKeyField()?O.comparator(t.key,e.key):(function(o,a,l){const h=a.data.field(o),f=l.data.field(o);return h!==null&&f!==null?Be(h,f):x(42886)})(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return x(19790,{direction:n.dir})}}class Re{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){for(const[s,o]of r)if(this.equalsFn(s,t))return o}}has(t){return this.get(t)!==void 0}set(t,e){const r=this.mapKeyFn(t),s=this.inner[r];if(s===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],t))return void(s[o]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],t))return r.length===1?delete this.inner[e]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(t){le(this.inner,((e,r)=>{for(const[s,o]of r)t(s,o)}))}isEmpty(){return Sc(this.inner)}size(){return this.innerSize}}const zf=new Z(O.comparator);function Gt(){return zf}const zc=new Z(O.comparator);function _n(...n){let t=zc;for(const e of n)t=t.insert(e.key,e);return t}function Gc(n){let t=zc;return n.forEach(((e,r)=>t=t.insert(e,r.overlayedDocument))),t}function Te(){return wn()}function Hc(){return wn()}function wn(){return new Re((n=>n.toString()),((n,t)=>n.isEqual(t)))}const Gf=new Z(O.comparator),Hf=new ut(O.comparator);function $(...n){let t=Hf;for(const e of n)t=t.add(e);return t}const Kf=new ut(j);function Qf(){return Kf}function li(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:yr(t)?"-0":t}}function Kc(n){return{integerValue:""+n}}function Qc(n,t){return vf(t)?Kc(t):li(n,t)}class xr{constructor(){this._=void 0}}function Wf(n,t,e){return n instanceof vr?(function(s,o){const a={fields:{[Pc]:{stringValue:Cc},[Dc]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&oi(o)&&(o=Nr(o)),o&&(a.fields[Vc]=o),{mapValue:a}})(e,t):n instanceof Nn?Xc(n,t):n instanceof kn?Yc(n,t):(function(s,o){const a=Wc(s,o),l=va(a)+va(s.Ae);return Us(a)&&Us(s.Ae)?Kc(l):li(s.serializer,l)})(n,t)}function Xf(n,t,e){return n instanceof Nn?Xc(n,t):n instanceof kn?Yc(n,t):e}function Wc(n,t){return n instanceof Mn?(function(r){return Us(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(t)?t:{integerValue:0}:null}class vr extends xr{}class Nn extends xr{constructor(t){super(),this.elements=t}}function Xc(n,t){const e=Jc(t);for(const r of n.elements)e.some((s=>qt(s,r)))||e.push(r);return{arrayValue:{values:e}}}class kn extends xr{constructor(t){super(),this.elements=t}}function Yc(n,t){let e=Jc(t);for(const r of n.elements)e=e.filter((s=>!qt(s,r)));return{arrayValue:{values:e}}}class Mn extends xr{constructor(t,e){super(),this.serializer=t,this.Ae=e}}function va(n){return nt(n.integerValue||n.doubleValue)}function Jc(n){return ai(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Yf{constructor(t,e){this.field=t,this.transform=e}}function Jf(n,t){return n.field.isEqual(t.field)&&(function(r,s){return r instanceof Nn&&s instanceof Nn||r instanceof kn&&s instanceof kn?Ue(r.elements,s.elements,qt):r instanceof Mn&&s instanceof Mn?qt(r.Ae,s.Ae):r instanceof vr&&s instanceof vr})(n.transform,t.transform)}class Zf{constructor(t,e){this.version=t,this.transformResults=e}}class Vt{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Vt}static exists(t){return new Vt(void 0,t)}static updateTime(t){return new Vt(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function hr(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}class Lr{}function Zc(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new hi(n.key,Vt.none()):new xn(n.key,n.data,Vt.none());{const e=n.data,r=At.empty();let s=new ut(pt.comparator);for(let o of t.fields)if(!s.has(o)){let a=e.field(o);a===null&&o.length>1&&(o=o.popLast(),a=e.field(o)),a===null?r.delete(o):r.set(o,a),s=s.add(o)}return new he(n.key,r,new St(s.toArray()),Vt.none())}}function td(n,t,e){n instanceof xn?(function(s,o,a){const l=s.value.clone(),h=Aa(s.fieldTransforms,o,a.transformResults);l.setAll(h),o.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(n,t,e):n instanceof he?(function(s,o,a){if(!hr(s.precondition,o))return void o.convertToUnknownDocument(a.version);const l=Aa(s.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(tu(s)),h.setAll(l),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()})(n,t,e):(function(s,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,t,e)}function An(n,t,e,r){return n instanceof xn?(function(o,a,l,h){if(!hr(o.precondition,a))return l;const f=o.value.clone(),m=Ra(o.fieldTransforms,h,a);return f.setAll(m),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),null})(n,t,e,r):n instanceof he?(function(o,a,l,h){if(!hr(o.precondition,a))return l;const f=Ra(o.fieldTransforms,h,a),m=a.data;return m.setAll(tu(o)),m.setAll(f),a.convertToFoundDocument(a.version,m).setHasLocalMutations(),l===null?null:l.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((E=>E.field)))})(n,t,e,r):(function(o,a,l){return hr(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l})(n,t,e)}function ed(n,t){let e=null;for(const r of n.fieldTransforms){const s=t.data.field(r.field),o=Wc(r.transform,s||null);o!=null&&(e===null&&(e=At.empty()),e.set(r.field,o))}return e||null}function wa(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Ue(r,s,((o,a)=>Jf(o,a)))})(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}class xn extends Lr{constructor(t,e,r,s=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class he extends Lr{constructor(t,e,r,s,o=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function tu(n){const t=new Map;return n.fieldMask.fields.forEach((e=>{if(!e.isEmpty()){const r=n.data.field(e);t.set(e,r)}})),t}function Aa(n,t,e){const r=new Map;Q(n.length===e.length,32656,{Re:e.length,Ve:n.length});for(let s=0;s<e.length;s++){const o=n[s],a=o.transform,l=t.data.field(o.field);r.set(o.field,Xf(a,l,e[s]))}return r}function Ra(n,t,e){const r=new Map;for(const s of n){const o=s.transform,a=e.data.field(s.field);r.set(s.field,Wf(o,a,t))}return r}class hi extends Lr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class nd extends Lr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class rd{constructor(t,e,r,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(t,e){const r=e.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(t.key)&&td(o,t,r[s])}}applyToLocalView(t,e){for(const r of this.baseMutations)r.key.isEqual(t.key)&&(e=An(r,t,e,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(t.key)&&(e=An(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const r=Hc();return this.mutations.forEach((s=>{const o=t.get(s.key),a=o.overlayedDocument;let l=this.applyToLocalView(a,o.mutatedFields);l=e.has(s.key)?null:l;const h=Zc(a,l);h!==null&&r.set(s.key,h),a.isValidDocument()||a.convertToNoDocument(F.min())})),r}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),$())}isEqual(t){return this.batchId===t.batchId&&Ue(this.mutations,t.mutations,((e,r)=>wa(e,r)))&&Ue(this.baseMutations,t.baseMutations,((e,r)=>wa(e,r)))}}class fi{constructor(t,e,r,s){this.batch=t,this.commitVersion=e,this.mutationResults=r,this.docVersions=s}static from(t,e,r){Q(t.mutations.length===r.length,58842,{me:t.mutations.length,fe:r.length});let s=(function(){return Gf})();const o=t.mutations;for(let a=0;a<o.length;a++)s=s.insert(o[a].key,r[a].version);return new fi(t,e,r,s)}}class sd{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class id{constructor(t,e){this.count=t,this.unchangedNames=e}}var it,G;function od(n){switch(n){case S.OK:return x(64938);case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0;default:return x(15467,{code:n})}}function eu(n){if(n===void 0)return zt("GRPC error has no .code"),S.UNKNOWN;switch(n){case it.OK:return S.OK;case it.CANCELLED:return S.CANCELLED;case it.UNKNOWN:return S.UNKNOWN;case it.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case it.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case it.INTERNAL:return S.INTERNAL;case it.UNAVAILABLE:return S.UNAVAILABLE;case it.UNAUTHENTICATED:return S.UNAUTHENTICATED;case it.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case it.NOT_FOUND:return S.NOT_FOUND;case it.ALREADY_EXISTS:return S.ALREADY_EXISTS;case it.PERMISSION_DENIED:return S.PERMISSION_DENIED;case it.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case it.ABORTED:return S.ABORTED;case it.OUT_OF_RANGE:return S.OUT_OF_RANGE;case it.UNIMPLEMENTED:return S.UNIMPLEMENTED;case it.DATA_LOSS:return S.DATA_LOSS;default:return x(39323,{code:n})}}(G=it||(it={}))[G.OK=0]="OK",G[G.CANCELLED=1]="CANCELLED",G[G.UNKNOWN=2]="UNKNOWN",G[G.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",G[G.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",G[G.NOT_FOUND=5]="NOT_FOUND",G[G.ALREADY_EXISTS=6]="ALREADY_EXISTS",G[G.PERMISSION_DENIED=7]="PERMISSION_DENIED",G[G.UNAUTHENTICATED=16]="UNAUTHENTICATED",G[G.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",G[G.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",G[G.ABORTED=10]="ABORTED",G[G.OUT_OF_RANGE=11]="OUT_OF_RANGE",G[G.UNIMPLEMENTED=12]="UNIMPLEMENTED",G[G.INTERNAL=13]="INTERNAL",G[G.UNAVAILABLE=14]="UNAVAILABLE",G[G.DATA_LOSS=15]="DATA_LOSS";function ad(){return new TextEncoder}const cd=new ee([4294967295,4294967295],0);function Sa(n){const t=ad().encode(n),e=new pc;return e.update(t),new Uint8Array(e.digest())}function ba(n){const t=new DataView(n.buffer),e=t.getUint32(0,!0),r=t.getUint32(4,!0),s=t.getUint32(8,!0),o=t.getUint32(12,!0);return[new ee([e,r],0),new ee([s,o],0)]}class di{constructor(t,e,r){if(this.bitmap=t,this.padding=e,this.hashCount=r,e<0||e>=8)throw new yn(`Invalid padding: ${e}`);if(r<0)throw new yn(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new yn(`Invalid hash count: ${r}`);if(t.length===0&&e!==0)throw new yn(`Invalid padding when bitmap length is 0: ${e}`);this.ge=8*t.length-e,this.pe=ee.fromNumber(this.ge)}ye(t,e,r){let s=t.add(e.multiply(ee.fromNumber(r)));return s.compare(cd)===1&&(s=new ee([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;const e=Sa(t),[r,s]=ba(e);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);if(!this.we(a))return!1}return!0}static create(t,e,r){const s=t%8==0?0:8-t%8,o=new Uint8Array(Math.ceil(t/8)),a=new di(o,s,e);return r.forEach((l=>a.insert(l))),a}insert(t){if(this.ge===0)return;const e=Sa(t),[r,s]=ba(e);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);this.Se(a)}}Se(t){const e=Math.floor(t/8),r=t%8;this.bitmap[e]|=1<<r}}class yn extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Fr{constructor(t,e,r,s,o){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(t,e,r){const s=new Map;return s.set(t,Ln.createSynthesizedTargetChangeForCurrentChange(t,e,r)),new Fr(F.min(),s,new Z(j),Gt(),$())}}class Ln{constructor(t,e,r,s,o){this.resumeToken=t,this.current=e,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(t,e,r){return new Ln(r,e,$(),$(),$())}}class fr{constructor(t,e,r,s){this.be=t,this.removedTargetIds=e,this.key=r,this.De=s}}class nu{constructor(t,e){this.targetId=t,this.Ce=e}}class ru{constructor(t,e,r=gt.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=r,this.cause=s}}class Ca{constructor(){this.ve=0,this.Fe=Pa(),this.Me=gt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=$(),e=$(),r=$();return this.Fe.forEach(((s,o)=>{switch(o){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:r=r.add(s);break;default:x(38017,{changeType:o})}})),new Ln(this.Me,this.xe,t,e,r)}qe(){this.Oe=!1,this.Fe=Pa()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,Q(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class ud{constructor(t){this.Ge=t,this.ze=new Map,this.je=Gt(),this.Je=sr(),this.He=sr(),this.Ye=new Z(j)}Ze(t){for(const e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(const e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,(e=>{const r=this.nt(e);switch(t.state){case 0:this.rt(e)&&r.Le(t.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(t.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(r.We(),r.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),r.Le(t.resumeToken));break;default:x(56790,{state:t.state})}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach(((r,s)=>{this.rt(s)&&e(s)}))}st(t){const e=t.targetId,r=t.Ce.count,s=this.ot(e);if(s){const o=s.target;if(qs(o))if(r===0){const a=new O(o.path);this.et(e,a,Tt.newNoDocument(a,F.min()))}else Q(r===1,20013,{expectedCount:r});else{const a=this._t(e);if(a!==r){const l=this.ut(t),h=l?this.ct(l,t,a):1;if(h!==0){this.it(e);const f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,f)}}}}}ut(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=e;let a,l;try{a=ie(r).toUint8Array()}catch(h){if(h instanceof bc)return Fe("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{l=new di(a,s,o)}catch(h){return Fe(h instanceof yn?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return l.ge===0?null:l}ct(t,e,r){return e.Ce.count===r-this.Pt(t,e.targetId)?0:2}Pt(t,e){const r=this.Ge.getRemoteKeysForTarget(e);let s=0;return r.forEach((o=>{const a=this.Ge.ht(),l=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;t.mightContain(l)||(this.et(e,o,null),s++)})),s}Tt(t){const e=new Map;this.ze.forEach(((o,a)=>{const l=this.ot(a);if(l){if(o.current&&qs(l.target)){const h=new O(l.target.path);this.It(h).has(a)||this.Et(a,h)||this.et(a,h,Tt.newNoDocument(h,t))}o.Be&&(e.set(a,o.ke()),o.qe())}}));let r=$();this.He.forEach(((o,a)=>{let l=!0;a.forEachWhile((h=>{const f=this.ot(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)})),l&&(r=r.add(o))})),this.je.forEach(((o,a)=>a.setReadTime(t)));const s=new Fr(t,e,this.Ye,this.je,r);return this.je=Gt(),this.Je=sr(),this.He=sr(),this.Ye=new Z(j),s}Xe(t,e){if(!this.rt(t))return;const r=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,r),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,r){if(!this.rt(t))return;const s=this.nt(t);this.Et(t,e)?s.Qe(e,1):s.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),r&&(this.je=this.je.insert(e,r))}removeTarget(t){this.ze.delete(t)}_t(t){const e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new Ca,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new ut(j),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new ut(j),this.Je=this.Je.insert(t,e)),e}rt(t){const e=this.ot(t)!==null;return e||N("WatchChangeAggregator","Detected inactive target",t),e}ot(t){const e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new Ca),this.Ge.getRemoteKeysForTarget(t).forEach((e=>{this.et(t,e,null)}))}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}}function sr(){return new Z(O.comparator)}function Pa(){return new Z(O.comparator)}const ld={asc:"ASCENDING",desc:"DESCENDING"},hd={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},fd={and:"AND",or:"OR"};class dd{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function zs(n,t){return n.useProto3Json||Dr(t)?t:{value:t}}function wr(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function su(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function md(n,t){return wr(n,t.toTimestamp())}function Lt(n){return Q(!!n,49232),F.fromTimestamp((function(e){const r=se(e);return new J(r.seconds,r.nanos)})(n))}function mi(n,t){return Gs(n,t).canonicalString()}function Gs(n,t){const e=(function(s){return new X(["projects",s.projectId,"databases",s.database])})(n).child("documents");return t===void 0?e:e.child(t)}function iu(n){const t=X.fromString(n);return Q(lu(t),10190,{key:t.toString()}),t}function Hs(n,t){return mi(n.databaseId,t.path)}function Rs(n,t){const e=iu(t);if(e.get(1)!==n.databaseId.projectId)throw new D(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new D(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new O(au(e))}function ou(n,t){return mi(n.databaseId,t)}function pd(n){const t=iu(n);return t.length===4?X.emptyPath():au(t)}function Ks(n){return new X(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function au(n){return Q(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Va(n,t,e){return{name:Hs(n,t),fields:e.value.mapValue.fields}}function gd(n,t){let e;if("targetChange"in t){t.targetChange;const r=(function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:x(39313,{state:f})})(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],o=(function(f,m){return f.useProto3Json?(Q(m===void 0||typeof m=="string",58123),gt.fromBase64String(m||"")):(Q(m===void 0||m instanceof Buffer||m instanceof Uint8Array,16193),gt.fromUint8Array(m||new Uint8Array))})(n,t.targetChange.resumeToken),a=t.targetChange.cause,l=a&&(function(f){const m=f.code===void 0?S.UNKNOWN:eu(f.code);return new D(m,f.message||"")})(a);e=new ru(r,s,o,l||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const s=Rs(n,r.document.name),o=Lt(r.document.updateTime),a=r.document.createTime?Lt(r.document.createTime):F.min(),l=new At({mapValue:{fields:r.document.fields}}),h=Tt.newFoundDocument(s,o,a,l),f=r.targetIds||[],m=r.removedTargetIds||[];e=new fr(f,m,h.key,h)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const s=Rs(n,r.document),o=r.readTime?Lt(r.readTime):F.min(),a=Tt.newNoDocument(s,o),l=r.removedTargetIds||[];e=new fr([],l,a.key,a)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const s=Rs(n,r.document),o=r.removedTargetIds||[];e=new fr([],o,s,null)}else{if(!("filter"in t))return x(11601,{Rt:t});{t.filter;const r=t.filter;r.targetId;const{count:s=0,unchangedNames:o}=r,a=new id(s,o),l=r.targetId;e=new nu(l,a)}}return e}function _d(n,t){let e;if(t instanceof xn)e={update:Va(n,t.key,t.value)};else if(t instanceof hi)e={delete:Hs(n,t.key)};else if(t instanceof he)e={update:Va(n,t.key,t.data),updateMask:Sd(t.fieldMask)};else{if(!(t instanceof nd))return x(16599,{Vt:t.type});e={verify:Hs(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map((r=>(function(o,a){const l=a.transform;if(l instanceof vr)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Nn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof kn)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Mn)return{fieldPath:a.field.canonicalString(),increment:l.Ae};throw x(20930,{transform:a.transform})})(0,r)))),t.precondition.isNone||(e.currentDocument=(function(s,o){return o.updateTime!==void 0?{updateTime:md(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:x(27497)})(n,t.precondition)),e}function yd(n,t){return n&&n.length>0?(Q(t!==void 0,14353),n.map((e=>(function(s,o){let a=s.updateTime?Lt(s.updateTime):Lt(o);return a.isEqual(F.min())&&(a=Lt(o)),new Zf(a,s.transformResults||[])})(e,t)))):[]}function Ed(n,t){return{documents:[ou(n,t.path)]}}function Td(n,t){const e={structuredQuery:{}},r=t.path;let s;t.collectionGroup!==null?(s=r,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=r.popLast(),e.structuredQuery.from=[{collectionId:r.lastSegment()}]),e.parent=ou(n,s);const o=(function(f){if(f.length!==0)return uu(Dt.create(f,"and"))})(t.filters);o&&(e.structuredQuery.where=o);const a=(function(f){if(f.length!==0)return f.map((m=>(function(w){return{field:ke(w.field),direction:wd(w.dir)}})(m)))})(t.orderBy);a&&(e.structuredQuery.orderBy=a);const l=zs(n,t.limit);return l!==null&&(e.structuredQuery.limit=l),t.startAt&&(e.structuredQuery.startAt=(function(f){return{before:f.inclusive,values:f.position}})(t.startAt)),t.endAt&&(e.structuredQuery.endAt=(function(f){return{before:!f.inclusive,values:f.position}})(t.endAt)),{ft:e,parent:s}}function Id(n){let t=pd(n.parent);const e=n.structuredQuery,r=e.from?e.from.length:0;let s=null;if(r>0){Q(r===1,65062);const m=e.from[0];m.allDescendants?s=m.collectionId:t=t.child(m.collectionId)}let o=[];e.where&&(o=(function(E){const w=cu(E);return w instanceof Dt&&Lc(w)?w.getFilters():[w]})(e.where));let a=[];e.orderBy&&(a=(function(E){return E.map((w=>(function(k){return new Dn(Me(k.field),(function(V){switch(V){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(k.direction))})(w)))})(e.orderBy));let l=null;e.limit&&(l=(function(E){let w;return w=typeof E=="object"?E.value:E,Dr(w)?null:w})(e.limit));let h=null;e.startAt&&(h=(function(E){const w=!!E.before,C=E.values||[];return new Ir(C,w)})(e.startAt));let f=null;return e.endAt&&(f=(function(E){const w=!E.before,C=E.values||[];return new Ir(C,w)})(e.endAt)),Bf(t,s,a,o,l,"F",h,f)}function vd(n,t){const e=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return x(28987,{purpose:s})}})(t.purpose);return e==null?null:{"goog-listen-tags":e}}function cu(n){return n.unaryFilter!==void 0?(function(e){switch(e.unaryFilter.op){case"IS_NAN":const r=Me(e.unaryFilter.field);return ot.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Me(e.unaryFilter.field);return ot.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Me(e.unaryFilter.field);return ot.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Me(e.unaryFilter.field);return ot.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return x(61313);default:return x(60726)}})(n):n.fieldFilter!==void 0?(function(e){return ot.create(Me(e.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return x(58110);default:return x(50506)}})(e.fieldFilter.op),e.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(e){return Dt.create(e.compositeFilter.filters.map((r=>cu(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return x(1026)}})(e.compositeFilter.op))})(n):x(30097,{filter:n})}function wd(n){return ld[n]}function Ad(n){return hd[n]}function Rd(n){return fd[n]}function ke(n){return{fieldPath:n.canonicalString()}}function Me(n){return pt.fromServerFormat(n.fieldPath)}function uu(n){return n instanceof ot?(function(e){if(e.op==="=="){if(_a(e.value))return{unaryFilter:{field:ke(e.field),op:"IS_NAN"}};if(ga(e.value))return{unaryFilter:{field:ke(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(_a(e.value))return{unaryFilter:{field:ke(e.field),op:"IS_NOT_NAN"}};if(ga(e.value))return{unaryFilter:{field:ke(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ke(e.field),op:Ad(e.op),value:e.value}}})(n):n instanceof Dt?(function(e){const r=e.getFilters().map((s=>uu(s)));return r.length===1?r[0]:{compositeFilter:{op:Rd(e.op),filters:r}}})(n):x(54877,{filter:n})}function Sd(n){const t=[];return n.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function lu(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class Jt{constructor(t,e,r,s,o=F.min(),a=F.min(),l=gt.EMPTY_BYTE_STRING,h=null){this.target=t,this.targetId=e,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=h}withSequenceNumber(t){return new Jt(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Jt(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Jt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Jt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class bd{constructor(t){this.yt=t}}function Cd(n){const t=Id({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?$s(t,t.limit,"L"):t}class Pd{constructor(){this.Cn=new Vd}addToCollectionParentIndex(t,e){return this.Cn.add(e),b.resolve()}getCollectionParents(t,e){return b.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return b.resolve()}deleteFieldIndex(t,e){return b.resolve()}deleteAllFieldIndexes(t){return b.resolve()}createTargetIndexes(t,e){return b.resolve()}getDocumentsMatchingTarget(t,e){return b.resolve(null)}getIndexType(t,e){return b.resolve(0)}getFieldIndexes(t,e){return b.resolve([])}getNextCollectionGroupToUpdate(t){return b.resolve(null)}getMinOffset(t,e){return b.resolve(re.min())}getMinOffsetFromCollectionGroup(t,e){return b.resolve(re.min())}updateCollectionGroup(t,e,r){return b.resolve()}updateIndexEntries(t,e){return b.resolve()}}class Vd{constructor(){this.index={}}add(t){const e=t.lastSegment(),r=t.popLast(),s=this.index[e]||new ut(X.comparator),o=!s.has(r);return this.index[e]=s.add(r),o}has(t){const e=t.lastSegment(),r=t.popLast(),s=this.index[e];return s&&s.has(r)}getEntries(t){return(this.index[t]||new ut(X.comparator)).toArray()}}const Da={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},hu=41943040;class wt{static withCacheSize(t){return new wt(t,wt.DEFAULT_COLLECTION_PERCENTILE,wt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}}wt.DEFAULT_COLLECTION_PERCENTILE=10,wt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,wt.DEFAULT=new wt(hu,wt.DEFAULT_COLLECTION_PERCENTILE,wt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),wt.DISABLED=new wt(-1,0,0);class je{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new je(0)}static cr(){return new je(-1)}}const Na="LruGarbageCollector",Dd=1048576;function ka([n,t],[e,r]){const s=j(n,e);return s===0?j(t,r):s}class Nd{constructor(t){this.Ir=t,this.buffer=new ut(ka),this.Er=0}dr(){return++this.Er}Ar(t){const e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{const r=this.buffer.last();ka(e,r)<0&&(this.buffer=this.buffer.delete(r).add(e))}}get maxValue(){return this.buffer.last()[0]}}class kd{constructor(t,e,r){this.garbageCollector=t,this.asyncQueue=e,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(t){N(Na,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Ke(e)?N(Na,"Ignoring IndexedDB error during garbage collection: ",e):await He(e)}await this.Vr(3e5)}))}}class Md{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next((r=>Math.floor(e/100*r)))}nthSequenceNumber(t,e){if(e===0)return b.resolve(Vr.ce);const r=new Nd(e);return this.mr.forEachTarget(t,(s=>r.Ar(s.sequenceNumber))).next((()=>this.mr.pr(t,(s=>r.Ar(s))))).next((()=>r.maxValue))}removeTargets(t,e,r){return this.mr.removeTargets(t,e,r)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(N("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(Da)):this.getCacheSize(t).next((r=>r<this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Da):this.yr(t,e)))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let r,s,o,a,l,h,f;const m=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((E=>(E>this.params.maximumSequenceNumbersToCollect?(N("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${E}`),s=this.params.maximumSequenceNumbersToCollect):s=E,a=Date.now(),this.nthSequenceNumber(t,s)))).next((E=>(r=E,l=Date.now(),this.removeTargets(t,r,e)))).next((E=>(o=E,h=Date.now(),this.removeOrphanedDocuments(t,r)))).next((E=>(f=Date.now(),De()<=H.DEBUG&&N("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-m}ms
	Determined least recently used ${s} in `+(l-a)+`ms
	Removed ${o} targets in `+(h-l)+`ms
	Removed ${E} documents in `+(f-h)+`ms
Total Duration: ${f-m}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:E}))))}}function Od(n,t){return new Md(n,t)}class xd{constructor(){this.changes=new Re((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Tt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const r=this.changes.get(e);return r!==void 0?b.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Ld{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Fd{constructor(t,e,r,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=s}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next((s=>(r=s,this.remoteDocumentCache.getEntry(t,e)))).next((s=>(r!==null&&An(r.mutation,s,St.empty(),J.now()),s)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((r=>this.getLocalViewOfDocuments(t,r,$()).next((()=>r))))}getLocalViewOfDocuments(t,e,r=$()){const s=Te();return this.populateOverlays(t,s,e).next((()=>this.computeViews(t,e,s,r).next((o=>{let a=_n();return o.forEach(((l,h)=>{a=a.insert(l,h.overlayedDocument)})),a}))))}getOverlayedDocuments(t,e){const r=Te();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,$())))}populateOverlays(t,e,r){const s=[];return r.forEach((o=>{e.has(o)||s.push(o)})),this.documentOverlayCache.getOverlays(t,s).next((o=>{o.forEach(((a,l)=>{e.set(a,l)}))}))}computeViews(t,e,r,s){let o=Gt();const a=wn(),l=(function(){return wn()})();return e.forEach(((h,f)=>{const m=r.get(f.key);s.has(f.key)&&(m===void 0||m.mutation instanceof he)?o=o.insert(f.key,f):m!==void 0?(a.set(f.key,m.mutation.getFieldMask()),An(m.mutation,f,m.mutation.getFieldMask(),J.now())):a.set(f.key,St.empty())})),this.recalculateAndSaveOverlays(t,o).next((h=>(h.forEach(((f,m)=>a.set(f,m))),e.forEach(((f,m)=>l.set(f,new Ld(m,a.get(f)??null)))),l)))}recalculateAndSaveOverlays(t,e){const r=wn();let s=new Z(((a,l)=>a-l)),o=$();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((a=>{for(const l of a)l.keys().forEach((h=>{const f=e.get(h);if(f===null)return;let m=r.get(h)||St.empty();m=l.applyToLocalView(f,m),r.set(h,m);const E=(s.get(l.batchId)||$()).add(h);s=s.insert(l.batchId,E)}))})).next((()=>{const a=[],l=s.getReverseIterator();for(;l.hasNext();){const h=l.getNext(),f=h.key,m=h.value,E=Hc();m.forEach((w=>{if(!o.has(w)){const C=Zc(e.get(w),r.get(w));C!==null&&E.set(w,C),o=o.add(w)}})),a.push(this.documentOverlayCache.saveOverlays(t,f,E))}return b.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((r=>this.recalculateAndSaveOverlays(t,r)))}getDocumentsMatchingQuery(t,e,r,s){return(function(a){return O.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):qc(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,s):this.getDocumentsMatchingCollectionQuery(t,e,r,s)}getNextDocuments(t,e,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,s).next((o=>{const a=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,s-o.size):b.resolve(Te());let l=bn,h=o;return a.next((f=>b.forEach(f,((m,E)=>(l<E.largestBatchId&&(l=E.largestBatchId),o.get(m)?b.resolve():this.remoteDocumentCache.getEntry(t,m).next((w=>{h=h.insert(m,w)}))))).next((()=>this.populateOverlays(t,f,o))).next((()=>this.computeViews(t,h,f,$()))).next((m=>({batchId:l,changes:Gc(m)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new O(e)).next((r=>{let s=_n();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(t,e,r,s){const o=e.collectionGroup;let a=_n();return this.indexManager.getCollectionParents(t,o).next((l=>b.forEach(l,(h=>{const f=(function(E,w){return new Qe(w,null,E.explicitOrderBy.slice(),E.filters.slice(),E.limit,E.limitType,E.startAt,E.endAt)})(e,h.child(o));return this.getDocumentsMatchingCollectionQuery(t,f,r,s).next((m=>{m.forEach(((E,w)=>{a=a.insert(E,w)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(t,e,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next((a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,o,s)))).next((a=>{o.forEach(((h,f)=>{const m=f.getKey();a.get(m)===null&&(a=a.insert(m,Tt.newInvalidDocument(m)))}));let l=_n();return a.forEach(((h,f)=>{const m=o.get(h);m!==void 0&&An(m.mutation,f,St.empty(),J.now()),Or(e,f)&&(l=l.insert(h,f))})),l}))}}class Ud{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return b.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,(function(s){return{id:s.id,version:s.version,createTime:Lt(s.createTime)}})(e)),b.resolve()}getNamedQuery(t,e){return b.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,(function(s){return{name:s.name,query:Cd(s.bundledQuery),readTime:Lt(s.readTime)}})(e)),b.resolve()}}class Bd{constructor(){this.overlays=new Z(O.comparator),this.qr=new Map}getOverlay(t,e){return b.resolve(this.overlays.get(e))}getOverlays(t,e){const r=Te();return b.forEach(e,(s=>this.getOverlay(t,s).next((o=>{o!==null&&r.set(s,o)})))).next((()=>r))}saveOverlays(t,e,r){return r.forEach(((s,o)=>{this.St(t,e,o)})),b.resolve()}removeOverlaysForBatchId(t,e,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),b.resolve()}getOverlaysForCollection(t,e,r){const s=Te(),o=e.length+1,a=new O(e.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const h=l.getNext().value,f=h.getKey();if(!e.isPrefixOf(f.path))break;f.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return b.resolve(s)}getOverlaysForCollectionGroup(t,e,r,s){let o=new Z(((f,m)=>f-m));const a=this.overlays.getIterator();for(;a.hasNext();){const f=a.getNext().value;if(f.getKey().getCollectionGroup()===e&&f.largestBatchId>r){let m=o.get(f.largestBatchId);m===null&&(m=Te(),o=o.insert(f.largestBatchId,m)),m.set(f.getKey(),f)}}const l=Te(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((f,m)=>l.set(f,m))),!(l.size()>=s)););return b.resolve(l)}St(t,e,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new sd(e,r));let o=this.qr.get(e);o===void 0&&(o=$(),this.qr.set(e,o)),this.qr.set(e,o.add(r.key))}}class qd{constructor(){this.sessionToken=gt.EMPTY_BYTE_STRING}getSessionToken(t){return b.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,b.resolve()}}class pi{constructor(){this.Qr=new ut(ft.$r),this.Ur=new ut(ft.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){const r=new ft(t,e);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(t,e){t.forEach((r=>this.addReference(r,e)))}removeReference(t,e){this.Gr(new ft(t,e))}zr(t,e){t.forEach((r=>this.removeReference(r,e)))}jr(t){const e=new O(new X([])),r=new ft(e,t),s=new ft(e,t+1),o=[];return this.Ur.forEachInRange([r,s],(a=>{this.Gr(a),o.push(a.key)})),o}Jr(){this.Qr.forEach((t=>this.Gr(t)))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){const e=new O(new X([])),r=new ft(e,t),s=new ft(e,t+1);let o=$();return this.Ur.forEachInRange([r,s],(a=>{o=o.add(a.key)})),o}containsKey(t){const e=new ft(t,0),r=this.Qr.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}}class ft{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return O.comparator(t.key,e.key)||j(t.Yr,e.Yr)}static Kr(t,e){return j(t.Yr,e.Yr)||O.comparator(t.key,e.key)}}class jd{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new ut(ft.$r)}checkEmpty(t){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,r,s){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new rd(o,e,r,s);this.mutationQueue.push(a);for(const l of s)this.Zr=this.Zr.add(new ft(l.key,o)),this.indexManager.addToCollectionParentIndex(t,l.key.path.popLast());return b.resolve(a)}lookupMutationBatch(t,e){return b.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){const r=e+1,s=this.ei(r),o=s<0?0:s;return b.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?ii:this.tr-1)}getAllMutationBatches(t){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const r=new ft(e,0),s=new ft(e,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,s],(a=>{const l=this.Xr(a.Yr);o.push(l)})),b.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new ut(j);return e.forEach((s=>{const o=new ft(s,0),a=new ft(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,a],(l=>{r=r.add(l.Yr)}))})),b.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(t,e){const r=e.path,s=r.length+1;let o=r;O.isDocumentKey(o)||(o=o.child(""));const a=new ft(new O(o),0);let l=new ut(j);return this.Zr.forEachWhile((h=>{const f=h.key.path;return!!r.isPrefixOf(f)&&(f.length===s&&(l=l.add(h.Yr)),!0)}),a),b.resolve(this.ti(l))}ti(t){const e=[];return t.forEach((r=>{const s=this.Xr(r);s!==null&&e.push(s)})),e}removeMutationBatch(t,e){Q(this.ni(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return b.forEach(e.mutations,(s=>{const o=new ft(s.key,e.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.Zr=r}))}ir(t){}containsKey(t,e){const r=new ft(e,0),s=this.Zr.firstAfterOrEqual(r);return b.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,b.resolve()}ni(t,e){return this.ei(t)}ei(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Xr(t){const e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class $d{constructor(t){this.ri=t,this.docs=(function(){return new Z(O.comparator)})(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const r=e.key,s=this.docs.get(r),o=s?s.size:0,a=this.ri(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const r=this.docs.get(e);return b.resolve(r?r.document.mutableCopy():Tt.newInvalidDocument(e))}getEntries(t,e){let r=Gt();return e.forEach((s=>{const o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():Tt.newInvalidDocument(s))})),b.resolve(r)}getDocumentsMatchingQuery(t,e,r,s){let o=Gt();const a=e.path,l=new O(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(l);for(;h.hasNext();){const{key:f,value:{document:m}}=h.getNext();if(!a.isPrefixOf(f.path))break;f.path.length>a.length+1||yf(_f(m),r)<=0||(s.has(m.key)||Or(e,m))&&(o=o.insert(m.key,m.mutableCopy()))}return b.resolve(o)}getAllFromCollectionGroup(t,e,r,s){x(9500)}ii(t,e){return b.forEach(this.docs,(r=>e(r)))}newChangeBuffer(t){return new zd(this)}getSize(t){return b.resolve(this.size)}}class zd extends xd{constructor(t){super(),this.Nr=t}applyChanges(t){const e=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?e.push(this.Nr.addEntry(t,s)):this.Nr.removeEntry(r)})),b.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}}class Gd{constructor(t){this.persistence=t,this.si=new Re((e=>ci(e)),ui),this.lastRemoteSnapshotVersion=F.min(),this.highestTargetId=0,this.oi=0,this._i=new pi,this.targetCount=0,this.ai=je.ur()}forEachTarget(t,e){return this.si.forEach(((r,s)=>e(s))),b.resolve()}getLastRemoteSnapshotVersion(t){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return b.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.oi&&(this.oi=e),b.resolve()}Pr(t){this.si.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ai=new je(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,b.resolve()}updateTargetData(t,e){return this.Pr(e),b.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,b.resolve()}removeTargets(t,e,r){let s=0;const o=[];return this.si.forEach(((a,l)=>{l.sequenceNumber<=e&&r.get(l.targetId)===null&&(this.si.delete(a),o.push(this.removeMatchingKeysForTargetId(t,l.targetId)),s++)})),b.waitFor(o).next((()=>s))}getTargetCount(t){return b.resolve(this.targetCount)}getTargetData(t,e){const r=this.si.get(e)||null;return b.resolve(r)}addMatchingKeys(t,e,r){return this._i.Wr(e,r),b.resolve()}removeMatchingKeys(t,e,r){this._i.zr(e,r);const s=this.persistence.referenceDelegate,o=[];return s&&e.forEach((a=>{o.push(s.markPotentiallyOrphaned(t,a))})),b.waitFor(o)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),b.resolve()}getMatchingKeysForTargetId(t,e){const r=this._i.Hr(e);return b.resolve(r)}containsKey(t,e){return b.resolve(this._i.containsKey(e))}}class fu{constructor(t,e){this.ui={},this.overlays={},this.ci=new Vr(0),this.li=!1,this.li=!0,this.hi=new qd,this.referenceDelegate=t(this),this.Pi=new Gd(this),this.indexManager=new Pd,this.remoteDocumentCache=(function(s){return new $d(s)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new bd(e),this.Ii=new Ud(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Bd,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this.ui[t.toKey()];return r||(r=new jd(e,this.referenceDelegate),this.ui[t.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,r){N("MemoryPersistence","Starting transaction:",t);const s=new Hd(this.ci.next());return this.referenceDelegate.Ei(),r(s).next((o=>this.referenceDelegate.di(s).next((()=>o)))).toPromise().then((o=>(s.raiseOnCommittedEvent(),o)))}Ai(t,e){return b.or(Object.values(this.ui).map((r=>()=>r.containsKey(t,e))))}}class Hd extends Tf{constructor(t){super(),this.currentSequenceNumber=t}}class gi{constructor(t){this.persistence=t,this.Ri=new pi,this.Vi=null}static mi(t){return new gi(t)}get fi(){if(this.Vi)return this.Vi;throw x(60996)}addReference(t,e,r){return this.Ri.addReference(r,e),this.fi.delete(r.toString()),b.resolve()}removeReference(t,e,r){return this.Ri.removeReference(r,e),this.fi.add(r.toString()),b.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),b.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach((s=>this.fi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((s=>{s.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(t,e)))}Ei(){this.Vi=new Set}di(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.fi,(r=>{const s=O.fromPath(r);return this.gi(t,s).next((o=>{o||e.removeEntry(s,F.min())}))})).next((()=>(this.Vi=null,e.apply(t))))}updateLimboDocument(t,e){return this.gi(t,e).next((r=>{r?this.fi.delete(e.toString()):this.fi.add(e.toString())}))}Ti(t){return 0}gi(t,e){return b.or([()=>b.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}}class Ar{constructor(t,e){this.persistence=t,this.pi=new Re((r=>wf(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=Od(this,e)}static mi(t,e){return new Ar(t,e)}Ei(){}di(t){return b.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){const e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next((r=>e.next((s=>r+s))))}wr(t){let e=0;return this.pr(t,(r=>{e++})).next((()=>e))}pr(t,e){return b.forEach(this.pi,((r,s)=>this.br(t,r,s).next((o=>o?b.resolve():e(s)))))}removeTargets(t,e,r){return this.persistence.getTargetCache().removeTargets(t,e,r)}removeOrphanedDocuments(t,e){let r=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ii(t,(a=>this.br(t,a,e).next((l=>{l||(r++,o.removeEntry(a,F.min()))})))).next((()=>o.apply(t))).next((()=>r))}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),b.resolve()}removeTarget(t,e){const r=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,r)}addReference(t,e,r){return this.pi.set(r,t.currentSequenceNumber),b.resolve()}removeReference(t,e,r){return this.pi.set(r,t.currentSequenceNumber),b.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),b.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=ur(t.data.value)),e}br(t,e,r){return b.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const s=this.pi.get(e);return b.resolve(s!==void 0&&s>r)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class _i{constructor(t,e,r,s){this.targetId=t,this.fromCache=e,this.Es=r,this.ds=s}static As(t,e){let r=$(),s=$();for(const o of e.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new _i(t,e.fromCache,r,s)}}class Kd{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class Qd{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return Fl()?8:If(xl())>0?6:4})()}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,r,s){const o={result:null};return this.ys(t,e).next((a=>{o.result=a})).next((()=>{if(!o.result)return this.ws(t,e,s,r).next((a=>{o.result=a}))})).next((()=>{if(o.result)return;const a=new Kd;return this.Ss(t,e,a).next((l=>{if(o.result=l,this.Vs)return this.bs(t,e,a,l.size)}))})).next((()=>o.result))}bs(t,e,r,s){return r.documentReadCount<this.fs?(De()<=H.DEBUG&&N("QueryEngine","SDK will not create cache indexes for query:",Ne(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),b.resolve()):(De()<=H.DEBUG&&N("QueryEngine","Query:",Ne(e),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(De()<=H.DEBUG&&N("QueryEngine","The SDK decides to create cache indexes for query:",Ne(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,xt(e))):b.resolve())}ys(t,e){if(Ia(e))return b.resolve(null);let r=xt(e);return this.indexManager.getIndexType(t,r).next((s=>s===0?null:(e.limit!==null&&s===1&&(e=$s(e,null,"F"),r=xt(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next((o=>{const a=$(...o);return this.ps.getDocuments(t,a).next((l=>this.indexManager.getMinOffset(t,r).next((h=>{const f=this.Ds(e,l);return this.Cs(e,f,a,h.readTime)?this.ys(t,$s(e,null,"F")):this.vs(t,f,e,h)}))))})))))}ws(t,e,r,s){return Ia(e)||s.isEqual(F.min())?b.resolve(null):this.ps.getDocuments(t,r).next((o=>{const a=this.Ds(e,o);return this.Cs(e,a,r,s)?b.resolve(null):(De()<=H.DEBUG&&N("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Ne(e)),this.vs(t,a,e,gf(s,bn)).next((l=>l)))}))}Ds(t,e){let r=new ut($c(t));return e.forEach(((s,o)=>{Or(t,o)&&(r=r.add(o))})),r}Cs(t,e,r,s){if(t.limit===null)return!1;if(r.size!==e.size)return!0;const o=t.limitType==="F"?e.last():e.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}Ss(t,e,r){return De()<=H.DEBUG&&N("QueryEngine","Using full collection scan to execute query:",Ne(e)),this.ps.getDocumentsMatchingQuery(t,e,re.min(),r)}vs(t,e,r,s){return this.ps.getDocumentsMatchingQuery(t,r,s).next((o=>(e.forEach((a=>{o=o.insert(a.key,a)})),o)))}}const yi="LocalStore",Wd=3e8;class Xd{constructor(t,e,r,s){this.persistence=t,this.Fs=e,this.serializer=s,this.Ms=new Z(j),this.xs=new Re((o=>ci(o)),ui),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(r)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Fd(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ms)))}}function Yd(n,t,e,r){return new Xd(n,t,e,r)}async function du(n,t){const e=U(n);return await e.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return e.mutationQueue.getAllMutationBatches(r).next((o=>(s=o,e.Bs(t),e.mutationQueue.getAllMutationBatches(r)))).next((o=>{const a=[],l=[];let h=$();for(const f of s){a.push(f.batchId);for(const m of f.mutations)h=h.add(m.key)}for(const f of o){l.push(f.batchId);for(const m of f.mutations)h=h.add(m.key)}return e.localDocuments.getDocuments(r,h).next((f=>({Ls:f,removedBatchIds:a,addedBatchIds:l})))}))}))}function Jd(n,t){const e=U(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=t.batch.keys(),o=e.Ns.newChangeBuffer({trackRemovals:!0});return(function(l,h,f,m){const E=f.batch,w=E.keys();let C=b.resolve();return w.forEach((k=>{C=C.next((()=>m.getEntry(h,k))).next((M=>{const V=f.docVersions.get(k);Q(V!==null,48541),M.version.compareTo(V)<0&&(E.applyToRemoteDocument(M,f),M.isValidDocument()&&(M.setReadTime(f.commitVersion),m.addEntry(M)))}))})),C.next((()=>l.mutationQueue.removeMutationBatch(h,E)))})(e,r,t,o).next((()=>o.apply(r))).next((()=>e.mutationQueue.performConsistencyCheck(r))).next((()=>e.documentOverlayCache.removeOverlaysForBatchId(r,s,t.batch.batchId))).next((()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(l){let h=$();for(let f=0;f<l.mutationResults.length;++f)l.mutationResults[f].transformResults.length>0&&(h=h.add(l.batch.mutations[f].key));return h})(t)))).next((()=>e.localDocuments.getDocuments(r,s)))}))}function mu(n){const t=U(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Pi.getLastRemoteSnapshotVersion(e)))}function Zd(n,t){const e=U(n),r=t.snapshotVersion;let s=e.Ms;return e.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const a=e.Ns.newChangeBuffer({trackRemovals:!0});s=e.Ms;const l=[];t.targetChanges.forEach(((m,E)=>{const w=s.get(E);if(!w)return;l.push(e.Pi.removeMatchingKeys(o,m.removedDocuments,E).next((()=>e.Pi.addMatchingKeys(o,m.addedDocuments,E))));let C=w.withSequenceNumber(o.currentSequenceNumber);t.targetMismatches.get(E)!==null?C=C.withResumeToken(gt.EMPTY_BYTE_STRING,F.min()).withLastLimboFreeSnapshotVersion(F.min()):m.resumeToken.approximateByteSize()>0&&(C=C.withResumeToken(m.resumeToken,r)),s=s.insert(E,C),(function(M,V,z){return M.resumeToken.approximateByteSize()===0||V.snapshotVersion.toMicroseconds()-M.snapshotVersion.toMicroseconds()>=Wd?!0:z.addedDocuments.size+z.modifiedDocuments.size+z.removedDocuments.size>0})(w,C,m)&&l.push(e.Pi.updateTargetData(o,C))}));let h=Gt(),f=$();if(t.documentUpdates.forEach((m=>{t.resolvedLimboDocuments.has(m)&&l.push(e.persistence.referenceDelegate.updateLimboDocument(o,m))})),l.push(tm(o,a,t.documentUpdates).next((m=>{h=m.ks,f=m.qs}))),!r.isEqual(F.min())){const m=e.Pi.getLastRemoteSnapshotVersion(o).next((E=>e.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));l.push(m)}return b.waitFor(l).next((()=>a.apply(o))).next((()=>e.localDocuments.getLocalViewOfDocuments(o,h,f))).next((()=>h))})).then((o=>(e.Ms=s,o)))}function tm(n,t,e){let r=$(),s=$();return e.forEach((o=>r=r.add(o))),t.getEntries(n,r).next((o=>{let a=Gt();return e.forEach(((l,h)=>{const f=o.get(l);h.isFoundDocument()!==f.isFoundDocument()&&(s=s.add(l)),h.isNoDocument()&&h.version.isEqual(F.min())?(t.removeEntry(l,h.readTime),a=a.insert(l,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(t.addEntry(h),a=a.insert(l,h)):N(yi,"Ignoring outdated watch update for ",l,". Current version:",f.version," Watch version:",h.version)})),{ks:a,qs:s}}))}function em(n,t){const e=U(n);return e.persistence.runTransaction("Get next mutation batch","readonly",(r=>(t===void 0&&(t=ii),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t))))}function nm(n,t){const e=U(n);return e.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return e.Pi.getTargetData(r,t).next((o=>o?(s=o,b.resolve(s)):e.Pi.allocateTargetId(r).next((a=>(s=new Jt(t,a,"TargetPurposeListen",r.currentSequenceNumber),e.Pi.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=e.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.Ms=e.Ms.insert(r.targetId,r),e.xs.set(t,r.targetId)),r}))}async function Qs(n,t,e){const r=U(n),s=r.Ms.get(t),o=e?"readwrite":"readwrite-primary";try{e||await r.persistence.runTransaction("Release target",o,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!Ke(a))throw a;N(yi,`Failed to update sequence numbers for target ${t}: ${a}`)}r.Ms=r.Ms.remove(t),r.xs.delete(s.target)}function Ma(n,t,e){const r=U(n);let s=F.min(),o=$();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(h,f,m){const E=U(h),w=E.xs.get(m);return w!==void 0?b.resolve(E.Ms.get(w)):E.Pi.getTargetData(f,m)})(r,a,xt(t)).next((l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,l.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(a,t,e?s:F.min(),e?o:$()))).next((l=>(rm(r,jf(t),l),{documents:l,Qs:o})))))}function rm(n,t,e){let r=n.Os.get(t)||F.min();e.forEach(((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),n.Os.set(t,r)}class Oa{constructor(){this.activeTargetIds=Qf()}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class sm{constructor(){this.Mo=new Oa,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t,e=!0){return e&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,r){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new Oa,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class im{Oo(t){}shutdown(){}}const xa="ConnectivityMonitor";class La{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){N(xa,"Network connectivity changed: AVAILABLE");for(const t of this.qo)t(0)}ko(){N(xa,"Network connectivity changed: UNAVAILABLE");for(const t of this.qo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let ir=null;function Ws(){return ir===null?ir=(function(){return 268435456+Math.round(2147483648*Math.random())})():ir++,"0x"+ir.toString(16)}const Ss="RestConnection",om={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class am{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===Er?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(t,e,r,s,o){const a=Ws(),l=this.zo(t,e.toUriEncodedString());N(Ss,`Sending RPC '${t}' ${a}:`,l,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,s,o);const{host:f}=new URL(l),m=ei(f);return this.Jo(t,l,h,r,m).then((E=>(N(Ss,`Received RPC '${t}' ${a}: `,E),E)),(E=>{throw Fe(Ss,`RPC '${t}' ${a} failed with error: `,E,"url: ",l,"request:",r),E}))}Ho(t,e,r,s,o,a){return this.Go(t,e,r,s,o)}jo(t,e,r){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Ge})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((s,o)=>t[o]=s)),r&&r.headers.forEach(((s,o)=>t[o]=s))}zo(t,e){const r=om[t];return`${this.Uo}/v1/${e}:${r}`}terminate(){}}class cm{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}}const yt="WebChannelConnection";class um extends am{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,r,s,o){const a=Ws();return new Promise(((l,h)=>{const f=new gc;f.setWithCredentials(!0),f.listenOnce(_c.COMPLETE,(()=>{try{switch(f.getLastErrorCode()){case cr.NO_ERROR:const E=f.getResponseJson();N(yt,`XHR for RPC '${t}' ${a} received:`,JSON.stringify(E)),l(E);break;case cr.TIMEOUT:N(yt,`RPC '${t}' ${a} timed out`),h(new D(S.DEADLINE_EXCEEDED,"Request time out"));break;case cr.HTTP_ERROR:const w=f.getStatus();if(N(yt,`RPC '${t}' ${a} failed with status:`,w,"response text:",f.getResponseText()),w>0){let C=f.getResponseJson();Array.isArray(C)&&(C=C[0]);const k=C?.error;if(k&&k.status&&k.message){const M=(function(z){const q=z.toLowerCase().replace(/_/g,"-");return Object.values(S).indexOf(q)>=0?q:S.UNKNOWN})(k.status);h(new D(M,k.message))}else h(new D(S.UNKNOWN,"Server responded with status "+f.getStatus()))}else h(new D(S.UNAVAILABLE,"Connection failed."));break;default:x(9055,{l_:t,streamId:a,h_:f.getLastErrorCode(),P_:f.getLastError()})}}finally{N(yt,`RPC '${t}' ${a} completed.`)}}));const m=JSON.stringify(s);N(yt,`RPC '${t}' ${a} sending request:`,s),f.send(e,"POST",m,r,15)}))}T_(t,e,r){const s=Ws(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=Tc(),l=Ec(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,e,r),h.encodeInitMessageHeaders=!0;const m=o.join("");N(yt,`Creating RPC '${t}' stream ${s}: ${m}`,h);const E=a.createWebChannel(m,h);this.I_(E);let w=!1,C=!1;const k=new cm({Yo:V=>{C?N(yt,`Not sending because RPC '${t}' stream ${s} is closed:`,V):(w||(N(yt,`Opening RPC '${t}' stream ${s} transport.`),E.open(),w=!0),N(yt,`RPC '${t}' stream ${s} sending:`,V),E.send(V))},Zo:()=>E.close()}),M=(V,z,q)=>{V.listen(z,(K=>{try{q(K)}catch(lt){setTimeout((()=>{throw lt}),0)}}))};return M(E,gn.EventType.OPEN,(()=>{C||(N(yt,`RPC '${t}' stream ${s} transport opened.`),k.o_())})),M(E,gn.EventType.CLOSE,(()=>{C||(C=!0,N(yt,`RPC '${t}' stream ${s} transport closed`),k.a_(),this.E_(E))})),M(E,gn.EventType.ERROR,(V=>{C||(C=!0,Fe(yt,`RPC '${t}' stream ${s} transport errored. Name:`,V.name,"Message:",V.message),k.a_(new D(S.UNAVAILABLE,"The operation could not be completed")))})),M(E,gn.EventType.MESSAGE,(V=>{if(!C){const z=V.data[0];Q(!!z,16349);const q=z,K=q?.error||q[0]?.error;if(K){N(yt,`RPC '${t}' stream ${s} received error:`,K);const lt=K.status;let dt=(function(g){const _=it[g];if(_!==void 0)return eu(_)})(lt),et=K.message;dt===void 0&&(dt=S.INTERNAL,et="Unknown error status: "+lt+" with message "+K.message),C=!0,k.a_(new D(dt,et)),E.close()}else N(yt,`RPC '${t}' stream ${s} received:`,z),k.u_(z)}})),M(l,yc.STAT_EVENT,(V=>{V.stat===xs.PROXY?N(yt,`RPC '${t}' stream ${s} detected buffering proxy`):V.stat===xs.NOPROXY&&N(yt,`RPC '${t}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{k.__()}),0),k}terminate(){this.c_.forEach((t=>t.close())),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter((e=>e===t))}}function bs(){return typeof document<"u"?document:null}function Ur(n){return new dd(n,!0)}class pu{constructor(t,e,r=1e3,s=1.5,o=6e4){this.Mi=t,this.timerId=e,this.d_=r,this.A_=s,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();const e=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,e-r);s>0&&N("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),t()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Fa="PersistentStream";class gu{constructor(t,e,r,s,o,a,l,h){this.Mi=t,this.S_=r,this.b_=s,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new pu(t,e)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(t){this.Q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():e&&e.code===S.RESOURCE_EXHAUSTED?(zt(e.toString()),zt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===S.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.r_(e)}K_(){}auth(){this.state=1;const t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===e&&this.G_(r,s)}),(r=>{t((()=>{const s=new D(S.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(t,e){const r=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(t){return N(Fa,`close with error: ${t}`),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget((()=>this.D_===t?e():(N(Fa,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class lm extends gu{constructor(t,e,r,s,o,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,r,s,a),this.serializer=o}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();const e=gd(this.serializer,t),r=(function(o){if(!("targetChange"in o))return F.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?F.min():a.readTime?Lt(a.readTime):F.min()})(t);return this.listener.H_(e,r)}Y_(t){const e={};e.database=Ks(this.serializer),e.addTarget=(function(o,a){let l;const h=a.target;if(l=qs(h)?{documents:Ed(o,h)}:{query:Td(o,h).ft},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=su(o,a.resumeToken);const f=zs(o,a.expectedCount);f!==null&&(l.expectedCount=f)}else if(a.snapshotVersion.compareTo(F.min())>0){l.readTime=wr(o,a.snapshotVersion.toTimestamp());const f=zs(o,a.expectedCount);f!==null&&(l.expectedCount=f)}return l})(this.serializer,t);const r=vd(this.serializer,t);r&&(e.labels=r),this.q_(e)}Z_(t){const e={};e.database=Ks(this.serializer),e.removeTarget=t,this.q_(e)}}class hm extends gu{constructor(t,e,r,s,o,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,r,s,a),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}J_(t){return Q(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,Q(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){Q(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const e=yd(t.writeResults,t.commitTime),r=Lt(t.commitTime);return this.listener.na(r,e)}ra(){const t={};t.database=Ks(this.serializer),this.q_(t)}ea(t){const e={streamToken:this.lastStreamToken,writes:t.map((r=>_d(this.serializer,r)))};this.q_(e)}}class fm{}class dm extends fm{constructor(t,e,r,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new D(S.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Go(t,Gs(e,r),s,o,a))).catch((o=>{throw o.name==="FirebaseError"?(o.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new D(S.UNKNOWN,o.toString())}))}Ho(t,e,r,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,l])=>this.connection.Ho(t,Gs(e,r),s,a,l,o))).catch((a=>{throw a.name==="FirebaseError"?(a.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new D(S.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class mm{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(zt(e),this.aa=!1):N("OnlineStateTracker",e)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Ae="RemoteStore";class pm{constructor(t,e,r,s,o){this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((a=>{r.enqueueAndForget((async()=>{Se(this)&&(N(Ae,"Restarting streams for network reachability change."),await(async function(h){const f=U(h);f.Ea.add(4),await Fn(f),f.Ra.set("Unknown"),f.Ea.delete(4),await Br(f)})(this))}))})),this.Ra=new mm(r,s)}}async function Br(n){if(Se(n))for(const t of n.da)await t(!0)}async function Fn(n){for(const t of n.da)await t(!1)}function _u(n,t){const e=U(n);e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),vi(e)?Ii(e):We(e).O_()&&Ti(e,t))}function Ei(n,t){const e=U(n),r=We(e);e.Ia.delete(t),r.O_()&&yu(e,t),e.Ia.size===0&&(r.O_()?r.L_():Se(e)&&e.Ra.set("Unknown"))}function Ti(n,t){if(n.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(F.min())>0){const e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}We(n).Y_(t)}function yu(n,t){n.Va.Ue(t),We(n).Z_(t)}function Ii(n){n.Va=new ud({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),At:t=>n.Ia.get(t)||null,ht:()=>n.datastore.serializer.databaseId}),We(n).start(),n.Ra.ua()}function vi(n){return Se(n)&&!We(n).x_()&&n.Ia.size>0}function Se(n){return U(n).Ea.size===0}function Eu(n){n.Va=void 0}async function gm(n){n.Ra.set("Online")}async function _m(n){n.Ia.forEach(((t,e)=>{Ti(n,t)}))}async function ym(n,t){Eu(n),vi(n)?(n.Ra.ha(t),Ii(n)):n.Ra.set("Unknown")}async function Em(n,t,e){if(n.Ra.set("Online"),t instanceof ru&&t.state===2&&t.cause)try{await(async function(s,o){const a=o.cause;for(const l of o.targetIds)s.Ia.has(l)&&(await s.remoteSyncer.rejectListen(l,a),s.Ia.delete(l),s.Va.removeTarget(l))})(n,t)}catch(r){N(Ae,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await Rr(n,r)}else if(t instanceof fr?n.Va.Ze(t):t instanceof nu?n.Va.st(t):n.Va.tt(t),!e.isEqual(F.min()))try{const r=await mu(n.localStore);e.compareTo(r)>=0&&await(function(o,a){const l=o.Va.Tt(a);return l.targetChanges.forEach(((h,f)=>{if(h.resumeToken.approximateByteSize()>0){const m=o.Ia.get(f);m&&o.Ia.set(f,m.withResumeToken(h.resumeToken,a))}})),l.targetMismatches.forEach(((h,f)=>{const m=o.Ia.get(h);if(!m)return;o.Ia.set(h,m.withResumeToken(gt.EMPTY_BYTE_STRING,m.snapshotVersion)),yu(o,h);const E=new Jt(m.target,h,f,m.sequenceNumber);Ti(o,E)})),o.remoteSyncer.applyRemoteEvent(l)})(n,e)}catch(r){N(Ae,"Failed to raise snapshot:",r),await Rr(n,r)}}async function Rr(n,t,e){if(!Ke(t))throw t;n.Ea.add(1),await Fn(n),n.Ra.set("Offline"),e||(e=()=>mu(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{N(Ae,"Retrying IndexedDB access"),await e(),n.Ea.delete(1),await Br(n)}))}function Tu(n,t){return t().catch((e=>Rr(n,e,t)))}async function qr(n){const t=U(n),e=ae(t);let r=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:ii;for(;Tm(t);)try{const s=await em(t.localStore,r);if(s===null){t.Ta.length===0&&e.L_();break}r=s.batchId,Im(t,s)}catch(s){await Rr(t,s)}Iu(t)&&vu(t)}function Tm(n){return Se(n)&&n.Ta.length<10}function Im(n,t){n.Ta.push(t);const e=ae(n);e.O_()&&e.X_&&e.ea(t.mutations)}function Iu(n){return Se(n)&&!ae(n).x_()&&n.Ta.length>0}function vu(n){ae(n).start()}async function vm(n){ae(n).ra()}async function wm(n){const t=ae(n);for(const e of n.Ta)t.ea(e.mutations)}async function Am(n,t,e){const r=n.Ta.shift(),s=fi.from(r,t,e);await Tu(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await qr(n)}async function Rm(n,t){t&&ae(n).X_&&await(async function(r,s){if((function(a){return od(a)&&a!==S.ABORTED})(s.code)){const o=r.Ta.shift();ae(r).B_(),await Tu(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s))),await qr(r)}})(n,t),Iu(n)&&vu(n)}async function Ua(n,t){const e=U(n);e.asyncQueue.verifyOperationInProgress(),N(Ae,"RemoteStore received new credentials");const r=Se(e);e.Ea.add(3),await Fn(e),r&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await Br(e)}async function Sm(n,t){const e=U(n);t?(e.Ea.delete(2),await Br(e)):t||(e.Ea.add(2),await Fn(e),e.Ra.set("Unknown"))}function We(n){return n.ma||(n.ma=(function(e,r,s){const o=U(e);return o.sa(),new lm(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:gm.bind(null,n),t_:_m.bind(null,n),r_:ym.bind(null,n),H_:Em.bind(null,n)}),n.da.push((async t=>{t?(n.ma.B_(),vi(n)?Ii(n):n.Ra.set("Unknown")):(await n.ma.stop(),Eu(n))}))),n.ma}function ae(n){return n.fa||(n.fa=(function(e,r,s){const o=U(e);return o.sa(),new hm(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:vm.bind(null,n),r_:Rm.bind(null,n),ta:wm.bind(null,n),na:Am.bind(null,n)}),n.da.push((async t=>{t?(n.fa.B_(),await qr(n)):(await n.fa.stop(),n.Ta.length>0&&(N(Ae,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class wi{constructor(t,e,r,s,o){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new jt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,s,o){const a=Date.now()+r,l=new wi(t,e,a,s,o);return l.start(r),l}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new D(S.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ai(n,t){if(zt("AsyncQueue",`${t}: ${n}`),Ke(n))return new D(S.UNAVAILABLE,`${t}: ${n}`);throw n}class Le{static emptySet(t){return new Le(t.comparator)}constructor(t){this.comparator=t?(e,r)=>t(e,r)||O.comparator(e.key,r.key):(e,r)=>O.comparator(e.key,r.key),this.keyedMap=_n(),this.sortedSet=new Z(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,r)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Le)||this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;e.hasNext();){const s=e.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){const r=new Le;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=e,r}}class Ba{constructor(){this.ga=new Z(O.comparator)}track(t){const e=t.doc.key,r=this.ga.get(e);r?t.type!==0&&r.type===3?this.ga=this.ga.insert(e,t):t.type===3&&r.type!==1?this.ga=this.ga.insert(e,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.ga=this.ga.remove(e):t.type===1&&r.type===2?this.ga=this.ga.insert(e,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):x(63341,{Rt:t,pa:r}):this.ga=this.ga.insert(e,t)}ya(){const t=[];return this.ga.inorderTraversal(((e,r)=>{t.push(r)})),t}}class $e{constructor(t,e,r,s,o,a,l,h,f){this.query=t,this.docs=e,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(t,e,r,s,o){const a=[];return e.forEach((l=>{a.push({type:0,doc:l})})),new $e(t,e,Le.emptySet(e),a,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Mr(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,r=t.docChanges;if(e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==r[s].type||!e[s].doc.isEqual(r[s].doc))return!1;return!0}}class bm{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((t=>t.Da()))}}class Cm{constructor(){this.queries=qa(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(e,r){const s=U(e),o=s.queries;s.queries=qa(),o.forEach(((a,l)=>{for(const h of l.Sa)h.onError(r)}))})(this,new D(S.ABORTED,"Firestore shutting down"))}}function qa(){return new Re((n=>jc(n)),Mr)}async function Ri(n,t){const e=U(n);let r=3;const s=t.query;let o=e.queries.get(s);o?!o.ba()&&t.Da()&&(r=2):(o=new bm,r=t.Da()?0:1);try{switch(r){case 0:o.wa=await e.onListen(s,!0);break;case 1:o.wa=await e.onListen(s,!1);break;case 2:await e.onFirstRemoteStoreListen(s)}}catch(a){const l=Ai(a,`Initialization of query '${Ne(t.query)}' failed`);return void t.onError(l)}e.queries.set(s,o),o.Sa.push(t),t.va(e.onlineState),o.wa&&t.Fa(o.wa)&&bi(e)}async function Si(n,t){const e=U(n),r=t.query;let s=3;const o=e.queries.get(r);if(o){const a=o.Sa.indexOf(t);a>=0&&(o.Sa.splice(a,1),o.Sa.length===0?s=t.Da()?0:1:!o.ba()&&t.Da()&&(s=2))}switch(s){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function Pm(n,t){const e=U(n);let r=!1;for(const s of t){const o=s.query,a=e.queries.get(o);if(a){for(const l of a.Sa)l.Fa(s)&&(r=!0);a.wa=s}}r&&bi(e)}function Vm(n,t,e){const r=U(n),s=r.queries.get(t);if(s)for(const o of s.Sa)o.onError(e);r.queries.delete(t)}function bi(n){n.Ca.forEach((t=>{t.next()}))}var Xs,ja;(ja=Xs||(Xs={})).Ma="default",ja.Cache="cache";class Ci{constructor(t,e,r){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(t){if(!this.options.includeMetadataChanges){const r=[];for(const s of t.docChanges)s.type!==3&&r.push(s);t=new $e(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache||!this.Da())return!0;const r=e!=="Offline";return(!this.options.qa||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;const e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}ka(t){t=$e.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==Xs.Cache}}class wu{constructor(t){this.key=t}}class Au{constructor(t){this.key=t}}class Dm{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=$(),this.mutatedKeys=$(),this.eu=$c(t),this.tu=new Le(this.eu)}get nu(){return this.Ya}ru(t,e){const r=e?e.iu:new Ba,s=e?e.tu:this.tu;let o=e?e.mutatedKeys:this.mutatedKeys,a=s,l=!1;const h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,f=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((m,E)=>{const w=s.get(m),C=Or(this.query,E)?E:null,k=!!w&&this.mutatedKeys.has(w.key),M=!!C&&(C.hasLocalMutations||this.mutatedKeys.has(C.key)&&C.hasCommittedMutations);let V=!1;w&&C?w.data.isEqual(C.data)?k!==M&&(r.track({type:3,doc:C}),V=!0):this.su(w,C)||(r.track({type:2,doc:C}),V=!0,(h&&this.eu(C,h)>0||f&&this.eu(C,f)<0)&&(l=!0)):!w&&C?(r.track({type:0,doc:C}),V=!0):w&&!C&&(r.track({type:1,doc:w}),V=!0,(h||f)&&(l=!0)),V&&(C?(a=a.add(C),o=M?o.add(m):o.delete(m)):(a=a.delete(m),o=o.delete(m)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const m=this.query.limitType==="F"?a.last():a.first();a=a.delete(m.key),o=o.delete(m.key),r.track({type:1,doc:m})}return{tu:a,iu:r,Cs:l,mutatedKeys:o}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,r,s){const o=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const a=t.iu.ya();a.sort(((m,E)=>(function(C,k){const M=V=>{switch(V){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return x(20277,{Rt:V})}};return M(C)-M(k)})(m.type,E.type)||this.eu(m.doc,E.doc))),this.ou(r),s=s??!1;const l=e&&!s?this._u():[],h=this.Xa.size===0&&this.current&&!s?1:0,f=h!==this.Za;return this.Za=h,a.length!==0||f?{snapshot:new $e(this.query,t.tu,o,a,t.mutatedKeys,h===0,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Ba,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach((e=>this.Ya=this.Ya.add(e))),t.modifiedDocuments.forEach((e=>{})),t.removedDocuments.forEach((e=>this.Ya=this.Ya.delete(e))),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Xa;this.Xa=$(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const e=[];return t.forEach((r=>{this.Xa.has(r)||e.push(new Au(r))})),this.Xa.forEach((r=>{t.has(r)||e.push(new wu(r))})),e}cu(t){this.Ya=t.Qs,this.Xa=$();const e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return $e.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Pi="SyncEngine";class Nm{constructor(t,e,r){this.query=t,this.targetId=e,this.view=r}}class km{constructor(t){this.key=t,this.hu=!1}}class Mm{constructor(t,e,r,s,o,a){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Re((l=>jc(l)),Mr),this.Iu=new Map,this.Eu=new Set,this.du=new Z(O.comparator),this.Au=new Map,this.Ru=new pi,this.Vu={},this.mu=new Map,this.fu=je.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Om(n,t,e=!0){const r=Vu(n);let s;const o=r.Tu.get(t);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=await Ru(r,t,e,!0),s}async function xm(n,t){const e=Vu(n);await Ru(e,t,!0,!1)}async function Ru(n,t,e,r){const s=await nm(n.localStore,xt(t)),o=s.targetId,a=n.sharedClientState.addLocalQueryTarget(o,e);let l;return r&&(l=await Lm(n,t,o,a==="current",s.resumeToken)),n.isPrimaryClient&&e&&_u(n.remoteStore,s),l}async function Lm(n,t,e,r,s){n.pu=(E,w,C)=>(async function(M,V,z,q){let K=V.view.ru(z);K.Cs&&(K=await Ma(M.localStore,V.query,!1).then((({documents:T})=>V.view.ru(T,K))));const lt=q&&q.targetChanges.get(V.targetId),dt=q&&q.targetMismatches.get(V.targetId)!=null,et=V.view.applyChanges(K,M.isPrimaryClient,lt,dt);return za(M,V.targetId,et.au),et.snapshot})(n,E,w,C);const o=await Ma(n.localStore,t,!0),a=new Dm(t,o.Qs),l=a.ru(o.documents),h=Ln.createSynthesizedTargetChangeForCurrentChange(e,r&&n.onlineState!=="Offline",s),f=a.applyChanges(l,n.isPrimaryClient,h);za(n,e,f.au);const m=new Nm(t,e,a);return n.Tu.set(t,m),n.Iu.has(e)?n.Iu.get(e).push(t):n.Iu.set(e,[t]),f.snapshot}async function Fm(n,t,e){const r=U(n),s=r.Tu.get(t),o=r.Iu.get(s.targetId);if(o.length>1)return r.Iu.set(s.targetId,o.filter((a=>!Mr(a,t)))),void r.Tu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Qs(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),e&&Ei(r.remoteStore,s.targetId),Ys(r,s.targetId)})).catch(He)):(Ys(r,s.targetId),await Qs(r.localStore,s.targetId,!0))}async function Um(n,t){const e=U(n),r=e.Tu.get(t),s=e.Iu.get(r.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),Ei(e.remoteStore,r.targetId))}async function Bm(n,t,e){const r=Km(n);try{const s=await(function(a,l){const h=U(a),f=J.now(),m=l.reduce(((C,k)=>C.add(k.key)),$());let E,w;return h.persistence.runTransaction("Locally write mutations","readwrite",(C=>{let k=Gt(),M=$();return h.Ns.getEntries(C,m).next((V=>{k=V,k.forEach(((z,q)=>{q.isValidDocument()||(M=M.add(z))}))})).next((()=>h.localDocuments.getOverlayedDocuments(C,k))).next((V=>{E=V;const z=[];for(const q of l){const K=ed(q,E.get(q.key).overlayedDocument);K!=null&&z.push(new he(q.key,K,Mc(K.value.mapValue),Vt.exists(!0)))}return h.mutationQueue.addMutationBatch(C,f,z,l)})).next((V=>{w=V;const z=V.applyToLocalDocumentSet(E,M);return h.documentOverlayCache.saveOverlays(C,V.batchId,z)}))})).then((()=>({batchId:w.batchId,changes:Gc(E)})))})(r.localStore,t);r.sharedClientState.addPendingMutation(s.batchId),(function(a,l,h){let f=a.Vu[a.currentUser.toKey()];f||(f=new Z(j)),f=f.insert(l,h),a.Vu[a.currentUser.toKey()]=f})(r,s.batchId,e),await Un(r,s.changes),await qr(r.remoteStore)}catch(s){const o=Ai(s,"Failed to persist write");e.reject(o)}}async function Su(n,t){const e=U(n);try{const r=await Zd(e.localStore,t);t.targetChanges.forEach(((s,o)=>{const a=e.Au.get(o);a&&(Q(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?Q(a.hu,14607):s.removedDocuments.size>0&&(Q(a.hu,42227),a.hu=!1))})),await Un(e,r,t)}catch(r){await He(r)}}function $a(n,t,e){const r=U(n);if(r.isPrimaryClient&&e===0||!r.isPrimaryClient&&e===1){const s=[];r.Tu.forEach(((o,a)=>{const l=a.view.va(t);l.snapshot&&s.push(l.snapshot)})),(function(a,l){const h=U(a);h.onlineState=l;let f=!1;h.queries.forEach(((m,E)=>{for(const w of E.Sa)w.va(l)&&(f=!0)})),f&&bi(h)})(r.eventManager,t),s.length&&r.Pu.H_(s),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function qm(n,t,e){const r=U(n);r.sharedClientState.updateQueryState(t,"rejected",e);const s=r.Au.get(t),o=s&&s.key;if(o){let a=new Z(O.comparator);a=a.insert(o,Tt.newNoDocument(o,F.min()));const l=$().add(o),h=new Fr(F.min(),new Map,new Z(j),a,l);await Su(r,h),r.du=r.du.remove(o),r.Au.delete(t),Vi(r)}else await Qs(r.localStore,t,!1).then((()=>Ys(r,t,e))).catch(He)}async function jm(n,t){const e=U(n),r=t.batch.batchId;try{const s=await Jd(e.localStore,t);Cu(e,r,null),bu(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await Un(e,s)}catch(s){await He(s)}}async function $m(n,t,e){const r=U(n);try{const s=await(function(a,l){const h=U(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",(f=>{let m;return h.mutationQueue.lookupMutationBatch(f,l).next((E=>(Q(E!==null,37113),m=E.keys(),h.mutationQueue.removeMutationBatch(f,E)))).next((()=>h.mutationQueue.performConsistencyCheck(f))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(f,m,l))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,m))).next((()=>h.localDocuments.getDocuments(f,m)))}))})(r.localStore,t);Cu(r,t,e),bu(r,t),r.sharedClientState.updateMutationState(t,"rejected",e),await Un(r,s)}catch(s){await He(s)}}function bu(n,t){(n.mu.get(t)||[]).forEach((e=>{e.resolve()})),n.mu.delete(t)}function Cu(n,t,e){const r=U(n);let s=r.Vu[r.currentUser.toKey()];if(s){const o=s.get(t);o&&(e?o.reject(e):o.resolve(),s=s.remove(t)),r.Vu[r.currentUser.toKey()]=s}}function Ys(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(const r of n.Iu.get(t))n.Tu.delete(r),e&&n.Pu.yu(r,e);n.Iu.delete(t),n.isPrimaryClient&&n.Ru.jr(t).forEach((r=>{n.Ru.containsKey(r)||Pu(n,r)}))}function Pu(n,t){n.Eu.delete(t.path.canonicalString());const e=n.du.get(t);e!==null&&(Ei(n.remoteStore,e),n.du=n.du.remove(t),n.Au.delete(e),Vi(n))}function za(n,t,e){for(const r of e)r instanceof wu?(n.Ru.addReference(r.key,t),zm(n,r)):r instanceof Au?(N(Pi,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,t),n.Ru.containsKey(r.key)||Pu(n,r.key)):x(19791,{wu:r})}function zm(n,t){const e=t.key,r=e.path.canonicalString();n.du.get(e)||n.Eu.has(r)||(N(Pi,"New document in limbo: "+e),n.Eu.add(r),Vi(n))}function Vi(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const t=n.Eu.values().next().value;n.Eu.delete(t);const e=new O(X.fromString(t)),r=n.fu.next();n.Au.set(r,new km(e)),n.du=n.du.insert(e,r),_u(n.remoteStore,new Jt(xt(kr(e.path)),r,"TargetPurposeLimboResolution",Vr.ce))}}async function Un(n,t,e){const r=U(n),s=[],o=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((l,h)=>{a.push(r.pu(h,t,e).then((f=>{if((f||e)&&r.isPrimaryClient){const m=f?!f.fromCache:e?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,m?"current":"not-current")}if(f){s.push(f);const m=_i.As(h.targetId,f);o.push(m)}})))})),await Promise.all(a),r.Pu.H_(s),await(async function(h,f){const m=U(h);try{await m.persistence.runTransaction("notifyLocalViewChanges","readwrite",(E=>b.forEach(f,(w=>b.forEach(w.Es,(C=>m.persistence.referenceDelegate.addReference(E,w.targetId,C))).next((()=>b.forEach(w.ds,(C=>m.persistence.referenceDelegate.removeReference(E,w.targetId,C)))))))))}catch(E){if(!Ke(E))throw E;N(yi,"Failed to update sequence numbers: "+E)}for(const E of f){const w=E.targetId;if(!E.fromCache){const C=m.Ms.get(w),k=C.snapshotVersion,M=C.withLastLimboFreeSnapshotVersion(k);m.Ms=m.Ms.insert(w,M)}}})(r.localStore,o))}async function Gm(n,t){const e=U(n);if(!e.currentUser.isEqual(t)){N(Pi,"User change. New user:",t.toKey());const r=await du(e.localStore,t);e.currentUser=t,(function(o,a){o.mu.forEach((l=>{l.forEach((h=>{h.reject(new D(S.CANCELLED,a))}))})),o.mu.clear()})(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await Un(e,r.Ls)}}function Hm(n,t){const e=U(n),r=e.Au.get(t);if(r&&r.hu)return $().add(r.key);{let s=$();const o=e.Iu.get(t);if(!o)return s;for(const a of o){const l=e.Tu.get(a);s=s.unionWith(l.view.nu)}return s}}function Vu(n){const t=U(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=Su.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Hm.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=qm.bind(null,t),t.Pu.H_=Pm.bind(null,t.eventManager),t.Pu.yu=Vm.bind(null,t.eventManager),t}function Km(n){const t=U(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=jm.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=$m.bind(null,t),t}class Sr{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=Ur(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,e){return null}Mu(t,e){return null}vu(t){return Yd(this.persistence,new Qd,t.initialUser,this.serializer)}Cu(t){return new fu(gi.mi,this.serializer)}Du(t){return new sm}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Sr.provider={build:()=>new Sr};class Qm extends Sr{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){Q(this.persistence.referenceDelegate instanceof Ar,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new kd(r,t.asyncQueue,e)}Cu(t){const e=this.cacheSizeBytes!==void 0?wt.withCacheSize(this.cacheSizeBytes):wt.DEFAULT;return new fu((r=>Ar.mi(r,e)),this.serializer)}}class Js{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>$a(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Gm.bind(null,this.syncEngine),await Sm(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return(function(){return new Cm})()}createDatastore(t){const e=Ur(t.databaseInfo.databaseId),r=(function(o){return new um(o)})(t.databaseInfo);return(function(o,a,l,h){return new dm(o,a,l,h)})(t.authCredentials,t.appCheckCredentials,r,e)}createRemoteStore(t){return(function(r,s,o,a,l){return new pm(r,s,o,a,l)})(this.localStore,this.datastore,t.asyncQueue,(e=>$a(this.syncEngine,e,0)),(function(){return La.v()?new La:new im})())}createSyncEngine(t,e){return(function(s,o,a,l,h,f,m){const E=new Mm(s,o,a,l,h,f);return m&&(E.gu=!0),E})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){await(async function(e){const r=U(e);N(Ae,"RemoteStore shutting down."),r.Ea.add(5),await Fn(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Js.provider={build:()=>new Js};class Di{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):zt("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout((()=>{this.muted||t(e)}),0)}}const ce="FirestoreClient";class Wm{constructor(t,e,r,s,o){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this.databaseInfo=s,this.user=Et.UNAUTHENTICATED,this.clientId=si.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async a=>{N(ce,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(N(ce,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new jt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const r=Ai(e,"Failed to shutdown persistence");t.reject(r)}})),t.promise}}async function Cs(n,t){n.asyncQueue.verifyOperationInProgress(),N(ce,"Initializing OfflineComponentProvider");const e=n.configuration;await t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await du(t.localStore,s),r=s)})),t.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=t}async function Ga(n,t){n.asyncQueue.verifyOperationInProgress();const e=await Xm(n);N(ce,"Initializing OnlineComponentProvider"),await t.initialize(e,n.configuration),n.setCredentialChangeListener((r=>Ua(t.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>Ua(t.remoteStore,s))),n._onlineComponents=t}async function Xm(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){N(ce,"Using user provided OfflineComponentProvider");try{await Cs(n,n._uninitializedComponentsProvider._offline)}catch(t){const e=t;if(!(function(s){return s.name==="FirebaseError"?s.code===S.FAILED_PRECONDITION||s.code===S.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(e))throw e;Fe("Error using user provided cache. Falling back to memory cache: "+e),await Cs(n,new Sr)}}else N(ce,"Using default OfflineComponentProvider"),await Cs(n,new Qm(void 0));return n._offlineComponents}async function Du(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(N(ce,"Using user provided OnlineComponentProvider"),await Ga(n,n._uninitializedComponentsProvider._online)):(N(ce,"Using default OnlineComponentProvider"),await Ga(n,new Js))),n._onlineComponents}function Ym(n){return Du(n).then((t=>t.syncEngine))}async function br(n){const t=await Du(n),e=t.eventManager;return e.onListen=Om.bind(null,t.syncEngine),e.onUnlisten=Fm.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=xm.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=Um.bind(null,t.syncEngine),e}function Jm(n,t,e={}){const r=new jt;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,l,h,f){const m=new Di({next:w=>{m.Nu(),a.enqueueAndForget((()=>Si(o,E)));const C=w.docs.has(l);!C&&w.fromCache?f.reject(new D(S.UNAVAILABLE,"Failed to get document because the client is offline.")):C&&w.fromCache&&h&&h.source==="server"?f.reject(new D(S.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(w)},error:w=>f.reject(w)}),E=new Ci(kr(l.path),m,{includeMetadataChanges:!0,qa:!0});return Ri(o,E)})(await br(n),n.asyncQueue,t,e,r))),r.promise}function Zm(n,t,e={}){const r=new jt;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,l,h,f){const m=new Di({next:w=>{m.Nu(),a.enqueueAndForget((()=>Si(o,E))),w.fromCache&&h.source==="server"?f.reject(new D(S.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(w)},error:w=>f.reject(w)}),E=new Ci(l,m,{includeMetadataChanges:!0,qa:!0});return Ri(o,E)})(await br(n),n.asyncQueue,t,e,r))),r.promise}function Nu(n){const t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}const Ha=new Map;const ku="firestore.googleapis.com",Ka=!0;class Qa{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new D(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=ku,this.ssl=Ka}else this.host=t.host,this.ssl=t.ssl??Ka;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=hu;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<Dd)throw new D(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}pf("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Nu(t.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new D(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new D(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new D(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class jr{constructor(t,e,r,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Qa({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new D(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new D(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Qa(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new sf;switch(r.type){case"firstParty":return new uf(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new D(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(e){const r=Ha.get(e);r&&(N("ComponentProvider","Removing Datastore"),Ha.delete(e),r.terminate())})(this),Promise.resolve()}}function tp(n,t,e,r={}){n=Ct(n,jr);const s=ei(t),o=n._getSettings(),a={...o,emulatorOptions:n._getEmulatorOptions()},l=`${t}:${e}`;s&&(Dl(`https://${l}`),Ol("Firestore",!0)),o.host!==ku&&o.host!==l&&Fe("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:l,ssl:s,emulatorOptions:r};if(!pr(h,a)&&(n._setSettings(h),r.mockUserToken)){let f,m;if(typeof r.mockUserToken=="string")f=r.mockUserToken,m=Et.MOCK_USER;else{f=Nl(r.mockUserToken,n._app?.options.projectId);const E=r.mockUserToken.sub||r.mockUserToken.user_id;if(!E)throw new D(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");m=new Et(E)}n._authCredentials=new of(new vc(f,m))}}class fe{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new fe(this.firestore,t,this._query)}}class rt{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ne(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new rt(this.firestore,t,this._key)}toJSON(){return{type:rt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,r){if(On(e,rt._jsonSchema))return new rt(t,r||null,new O(X.fromString(e.referencePath)))}}rt._jsonSchemaVersion="firestore/documentReference/1.0",rt._jsonSchema={type:at("string",rt._jsonSchemaVersion),referencePath:at("string")};class ne extends fe{constructor(t,e,r){super(t,e,kr(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new rt(this.firestore,null,new O(t))}withConverter(t){return new ne(this.firestore,t,this._path)}}function mn(n,t,...e){if(n=Bt(n),wc("collection","path",t),n instanceof jr){const r=X.fromString(t,...e);return aa(r),new ne(n,null,r)}{if(!(n instanceof rt||n instanceof ne))throw new D(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(X.fromString(t,...e));return aa(r),new ne(n.firestore,null,r)}}function Oe(n,t,...e){if(n=Bt(n),arguments.length===1&&(t=si.newId()),wc("doc","path",t),n instanceof jr){const r=X.fromString(t,...e);return oa(r),new rt(n,null,new O(r))}{if(!(n instanceof rt||n instanceof ne))throw new D(S.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(X.fromString(t,...e));return oa(r),new rt(n.firestore,n instanceof ne?n.converter:null,new O(r))}}const Wa="AsyncQueue";class Xa{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new pu(this,"async_queue_retry"),this._c=()=>{const r=bs();r&&N(Wa,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=t;const e=bs();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const e=bs();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise((()=>{}));const e=new jt;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Xu.push(t),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!Ke(t))throw t;N(Wa,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(t){const e=this.ac.then((()=>(this.rc=!0,t().catch((r=>{throw this.nc=r,this.rc=!1,zt("INTERNAL UNHANDLED ERROR: ",Ya(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=e,e}enqueueAfterDelay(t,e,r){this.uc(),this.oc.indexOf(t)>-1&&(e=0);const s=wi.createAndSchedule(this,t,e,r,(o=>this.hc(o)));return this.tc.push(s),s}uc(){this.nc&&x(47125,{Pc:Ya(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do t=this.ac,await t;while(t!==this.ac)}Ic(t){for(const e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then((()=>{this.tc.sort(((e,r)=>e.targetTimeMs-r.targetTimeMs));for(const e of this.tc)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tc()}))}dc(t){this.oc.push(t)}hc(t){const e=this.tc.indexOf(t);this.tc.splice(e,1)}}function Ya(n){let t=n.message||"";return n.stack&&(t=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),t}function Ja(n){return(function(e,r){if(typeof e!="object"||e===null)return!1;const s=e;for(const o of r)if(o in s&&typeof s[o]=="function")return!0;return!1})(n,["next","error","complete"])}class ue extends jr{constructor(t,e,r,s){super(t,e,r,s),this.type="firestore",this._queue=new Xa,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new Xa(t),this._firestoreClient=void 0,await t}}}function ep(n,t){const e=typeof n=="object"?n:Gh(),r=typeof n=="string"?n:Er,s=Bh(e,"firestore").getImmediate({identifier:r});if(!s._initialized){const o=Pl("firestore");o&&tp(s,...o)}return s}function $r(n){if(n._terminated)throw new D(S.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||np(n),n._firestoreClient}function np(n){const t=n._freezeSettings(),e=(function(s,o,a,l){return new Sf(s,o,a,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,Nu(l.experimentalLongPollingOptions),l.useFetchStreams,l.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,t);n._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),n._firestoreClient=new Wm(n._authCredentials,n._appCheckCredentials,n._queue,e,n._componentsProvider&&(function(s){const o=s?._online.build();return{_offline:s?._offline.build(o),_online:o}})(n._componentsProvider))}class bt{constructor(t){this._byteString=t}static fromBase64String(t){try{return new bt(gt.fromBase64String(t))}catch(e){throw new D(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new bt(gt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:bt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(On(t,bt._jsonSchema))return bt.fromBase64String(t.bytes)}}bt._jsonSchemaVersion="firestore/bytes/1.0",bt._jsonSchema={type:at("string",bt._jsonSchemaVersion),bytes:at("string")};class zr{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new D(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new pt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Gr{constructor(t){this._methodName=t}}class Ft{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new D(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new D(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return j(this._lat,t._lat)||j(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ft._jsonSchemaVersion}}static fromJSON(t){if(On(t,Ft._jsonSchema))return new Ft(t.latitude,t.longitude)}}Ft._jsonSchemaVersion="firestore/geoPoint/1.0",Ft._jsonSchema={type:at("string",Ft._jsonSchemaVersion),latitude:at("number"),longitude:at("number")};class Ut{constructor(t){this._values=(t||[]).map((e=>e))}toArray(){return this._values.map((t=>t))}isEqual(t){return(function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0})(this._values,t._values)}toJSON(){return{type:Ut._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(On(t,Ut._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every((e=>typeof e=="number")))return new Ut(t.vectorValues);throw new D(S.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ut._jsonSchemaVersion="firestore/vectorValue/1.0",Ut._jsonSchema={type:at("string",Ut._jsonSchemaVersion),vectorValues:at("object")};const rp=/^__.*__$/;class sp{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return this.fieldMask!==null?new he(t,this.data,this.fieldMask,e,this.fieldTransforms):new xn(t,this.data,e,this.fieldTransforms)}}class Mu{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return new he(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function Ou(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw x(40011,{Ac:n})}}class Ni{constructor(t,e,r,s,o,a){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new Ni({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){const e=this.path?.child(t),r=this.Vc({path:e,fc:!1});return r.gc(t),r}yc(t){const e=this.path?.child(t),r=this.Vc({path:e,fc:!1});return r.Rc(),r}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return Cr(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return this.fieldMask.find((e=>t.isPrefixOf(e)))!==void 0||this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))!==void 0}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(t.length===0)throw this.Sc("Document fields must not be empty");if(Ou(this.Ac)&&rp.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}}class ip{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||Ur(t)}Cc(t,e,r,s=!1){return new Ni({Ac:t,methodName:e,Dc:r,path:pt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ki(n){const t=n._freezeSettings(),e=Ur(n._databaseId);return new ip(n._databaseId,!!t.ignoreUndefinedProperties,e)}function op(n,t,e,r,s,o={}){const a=n.Cc(o.merge||o.mergeFields?2:0,t,e,s);Oi("Data must be an object, but it was:",a,r);const l=xu(r,a);let h,f;if(o.merge)h=new St(a.fieldMask),f=a.fieldTransforms;else if(o.mergeFields){const m=[];for(const E of o.mergeFields){const w=Zs(t,E,e);if(!a.contains(w))throw new D(S.INVALID_ARGUMENT,`Field '${w}' is specified in your field mask but missing from your input data.`);Fu(m,w)||m.push(w)}h=new St(m),f=a.fieldTransforms.filter((E=>h.covers(E.field)))}else h=null,f=a.fieldTransforms;return new sp(new At(l),h,f)}class Hr extends Gr{_toFieldTransform(t){if(t.Ac!==2)throw t.Ac===1?t.Sc(`${this._methodName}() can only appear at the top level of your update data`):t.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Hr}}class Mi extends Gr{constructor(t,e){super(t),this.Fc=e}_toFieldTransform(t){const e=new Mn(t.serializer,Qc(t.serializer,this.Fc));return new Yf(t.path,e)}isEqual(t){return t instanceof Mi&&this.Fc===t.Fc}}function ap(n,t,e,r){const s=n.Cc(1,t,e);Oi("Data must be an object, but it was:",s,r);const o=[],a=At.empty();le(r,((h,f)=>{const m=xi(t,h,e);f=Bt(f);const E=s.yc(m);if(f instanceof Hr)o.push(m);else{const w=Bn(f,E);w!=null&&(o.push(m),a.set(m,w))}}));const l=new St(o);return new Mu(a,l,s.fieldTransforms)}function cp(n,t,e,r,s,o){const a=n.Cc(1,t,e),l=[Zs(t,r,e)],h=[s];if(o.length%2!=0)throw new D(S.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let w=0;w<o.length;w+=2)l.push(Zs(t,o[w])),h.push(o[w+1]);const f=[],m=At.empty();for(let w=l.length-1;w>=0;--w)if(!Fu(f,l[w])){const C=l[w];let k=h[w];k=Bt(k);const M=a.yc(C);if(k instanceof Hr)f.push(C);else{const V=Bn(k,M);V!=null&&(f.push(C),m.set(C,V))}}const E=new St(f);return new Mu(m,E,a.fieldTransforms)}function up(n,t,e,r=!1){return Bn(e,n.Cc(r?4:3,t))}function Bn(n,t){if(Lu(n=Bt(n)))return Oi("Unsupported field value:",t,n),xu(n,t);if(n instanceof Gr)return(function(r,s){if(!Ou(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)})(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.fc&&t.Ac!==4)throw t.Sc("Nested arrays are not supported");return(function(r,s){const o=[];let a=0;for(const l of r){let h=Bn(l,s.wc(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}})(n,t)}return(function(r,s){if((r=Bt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Qc(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=J.fromDate(r);return{timestampValue:wr(s.serializer,o)}}if(r instanceof J){const o=new J(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:wr(s.serializer,o)}}if(r instanceof Ft)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof bt)return{bytesValue:su(s.serializer,r._byteString)};if(r instanceof rt){const o=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:mi(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Ut)return(function(a,l){return{mapValue:{fields:{[Nc]:{stringValue:kc},[Tr]:{arrayValue:{values:a.toArray().map((f=>{if(typeof f!="number")throw l.Sc("VectorValues must only contain numeric values.");return li(l.serializer,f)}))}}}}}})(r,s);throw s.Sc(`Unsupported field value: ${Pr(r)}`)})(n,t)}function xu(n,t){const e={};return Sc(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):le(n,((r,s)=>{const o=Bn(s,t.mc(r));o!=null&&(e[r]=o)})),{mapValue:{fields:e}}}function Lu(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof J||n instanceof Ft||n instanceof bt||n instanceof rt||n instanceof Gr||n instanceof Ut)}function Oi(n,t,e){if(!Lu(e)||!Ac(e)){const r=Pr(e);throw r==="an object"?t.Sc(n+" a custom object"):t.Sc(n+" "+r)}}function Zs(n,t,e){if((t=Bt(t))instanceof zr)return t._internalPath;if(typeof t=="string")return xi(n,t);throw Cr("Field path arguments must be of type string or ",n,!1,void 0,e)}const lp=new RegExp("[~\\*/\\[\\]]");function xi(n,t,e){if(t.search(lp)>=0)throw Cr(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new zr(...t.split("."))._internalPath}catch{throw Cr(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function Cr(n,t,e,r,s){const o=r&&!r.isEmpty(),a=s!==void 0;let l=`Function ${t}() called with invalid data`;e&&(l+=" (via `toFirestore()`)"),l+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${s}`),h+=")"),new D(S.INVALID_ARGUMENT,l+n+h)}function Fu(n,t){return n.some((e=>e.isEqual(t)))}class Uu{constructor(t,e,r,s,o){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new rt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new hp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Kr("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}}class hp extends Uu{data(){return super.data()}}function Kr(n,t){return typeof t=="string"?xi(n,t):t instanceof zr?t._internalPath:t._delegate._internalPath}function Bu(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new D(S.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Li{}class qu extends Li{}function Ps(n,t,...e){let r=[];t instanceof Li&&r.push(t),r=r.concat(e),(function(o){const a=o.filter((h=>h instanceof Fi)).length,l=o.filter((h=>h instanceof Qr)).length;if(a>1||a>0&&l>0)throw new D(S.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const s of r)n=s._apply(n);return n}class Qr extends qu{constructor(t,e,r){super(),this._field=t,this._op=e,this._value=r,this.type="where"}static _create(t,e,r){return new Qr(t,e,r)}_apply(t){const e=this._parse(t);return ju(t._query,e),new fe(t.firestore,t.converter,js(t._query,e))}_parse(t){const e=ki(t.firestore);return(function(o,a,l,h,f,m,E){let w;if(f.isKeyField()){if(m==="array-contains"||m==="array-contains-any")throw new D(S.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if(m==="in"||m==="not-in"){ec(E,m);const k=[];for(const M of E)k.push(tc(h,o,M));w={arrayValue:{values:k}}}else w=tc(h,o,E)}else m!=="in"&&m!=="not-in"&&m!=="array-contains-any"||ec(E,m),w=up(l,a,E,m==="in"||m==="not-in");return ot.create(f,m,w)})(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}}function Za(n,t,e){const r=t,s=Kr("where",n);return Qr._create(s,r,e)}class Fi extends Li{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new Fi(t,e)}_parse(t){const e=this._queryConstraints.map((r=>r._parse(t))).filter((r=>r.getFilters().length>0));return e.length===1?e[0]:Dt.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return e.getFilters().length===0?t:((function(s,o){let a=s;const l=o.getFlattenedFilters();for(const h of l)ju(a,h),a=js(a,h)})(t._query,e),new fe(t.firestore,t.converter,js(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Ui extends qu{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new Ui(t,e)}_apply(t){const e=(function(s,o,a){if(s.startAt!==null)throw new D(S.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new D(S.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Dn(o,a)})(t._query,this._field,this._direction);return new fe(t.firestore,t.converter,(function(s,o){const a=s.explicitOrderBy.concat([o]);return new Qe(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)})(t._query,e))}}function Vs(n,t="asc"){const e=t,r=Kr("orderBy",n);return Ui._create(r,e)}function tc(n,t,e){if(typeof(e=Bt(e))=="string"){if(e==="")throw new D(S.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!qc(t)&&e.indexOf("/")!==-1)throw new D(S.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);const r=t.path.child(X.fromString(e));if(!O.isDocumentKey(r))throw new D(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return pa(n,new O(r))}if(e instanceof rt)return pa(n,e._key);throw new D(S.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Pr(e)}.`)}function ec(n,t){if(!Array.isArray(n)||n.length===0)throw new D(S.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function ju(n,t){const e=(function(s,o){for(const a of s)for(const l of a.getFlattenedFilters())if(o.indexOf(l.op)>=0)return l.op;return null})(n.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(t.op));if(e!==null)throw e===t.op?new D(S.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new D(S.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}class fp{convertValue(t,e="none"){switch(oe(t)){case 0:return null;case 1:return t.booleanValue;case 2:return nt(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ie(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw x(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const r={};return le(t,((s,o)=>{r[s]=this.convertValue(o,e)})),r}convertVectorValue(t){const e=t.fields?.[Tr].arrayValue?.values?.map((r=>nt(r.doubleValue)));return new Ut(e)}convertGeoPoint(t){return new Ft(nt(t.latitude),nt(t.longitude))}convertArray(t,e){return(t.values||[]).map((r=>this.convertValue(r,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const r=Nr(t);return r==null?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(Cn(t));default:return null}}convertTimestamp(t){const e=se(t);return new J(e.seconds,e.nanos)}convertDocumentKey(t,e){const r=X.fromString(t);Q(lu(r),9688,{name:t});const s=new Pn(r.get(1),r.get(3)),o=new O(r.popFirst(5));return s.isEqual(e)||zt(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),o}}function dp(n,t,e){let r;return r=n?n.toFirestore(t):t,r}class En{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Ie extends Uu{constructor(t,e,r,s,o,a){super(t,e,r,s,a),this._firestore=t,this._firestoreImpl=t,this.metadata=o}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new dr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const r=this._document.data.field(Kr("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new D(S.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=Ie._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}}Ie._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ie._jsonSchema={type:at("string",Ie._jsonSchemaVersion),bundleSource:at("string","DocumentSnapshot"),bundleName:at("string"),bundle:at("string")};class dr extends Ie{data(t={}){return super.data(t)}}class ve{constructor(t,e,r,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new En(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach((r=>{t.call(e,new dr(this._firestore,this._userDataWriter,r.key,r,new En(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new D(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=(function(s,o){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((l=>{const h=new dr(s._firestore,s._userDataWriter,l.doc.key,l.doc,new En(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((l=>o||l.type!==3)).map((l=>{const h=new dr(s._firestore,s._userDataWriter,l.doc.key,l.doc,new En(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let f=-1,m=-1;return l.type!==0&&(f=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),m=a.indexOf(l.doc.key)),{type:mp(l.type),doc:h,oldIndex:f,newIndex:m}}))}})(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new D(S.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=ve._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=si.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],r=[],s=[];return this.docs.forEach((o=>{o._document!==null&&(e.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))})),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function mp(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return x(61501,{type:n})}}function nc(n){n=Ct(n,rt);const t=Ct(n.firestore,ue);return Jm($r(t),n._key).then((e=>$u(t,n,e)))}ve._jsonSchemaVersion="firestore/querySnapshot/1.0",ve._jsonSchema={type:at("string",ve._jsonSchemaVersion),bundleSource:at("string","QuerySnapshot"),bundleName:at("string"),bundle:at("string")};class Bi extends fp{constructor(t){super(),this.firestore=t}convertBytes(t){return new bt(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new rt(this.firestore,null,e)}}function rc(n){n=Ct(n,fe);const t=Ct(n.firestore,ue),e=$r(t),r=new Bi(t);return Bu(n._query),Zm(e,n._query).then((s=>new ve(t,r,n,s)))}function pn(n,t,e,...r){n=Ct(n,rt);const s=Ct(n.firestore,ue),o=ki(s);let a;return a=typeof(t=Bt(t))=="string"||t instanceof zr?cp(o,"updateDoc",n._key,t,e,r):ap(o,"updateDoc",n._key,t),qi(s,[a.toMutation(n._key,Vt.exists(!0))])}function pp(n){return qi(Ct(n.firestore,ue),[new hi(n._key,Vt.none())])}function sc(n,t){const e=Ct(n.firestore,ue),r=Oe(n),s=dp(n.converter,t);return qi(e,[op(ki(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Vt.exists(!1))]).then((()=>r))}function gp(n,...t){n=Bt(n);let e={includeMetadataChanges:!1,source:"default"},r=0;typeof t[r]!="object"||Ja(t[r])||(e=t[r++]);const s={includeMetadataChanges:e.includeMetadataChanges,source:e.source};if(Ja(t[r])){const h=t[r];t[r]=h.next?.bind(h),t[r+1]=h.error?.bind(h),t[r+2]=h.complete?.bind(h)}let o,a,l;if(n instanceof rt)a=Ct(n.firestore,ue),l=kr(n._key.path),o={next:h=>{t[r]&&t[r]($u(a,n,h))},error:t[r+1],complete:t[r+2]};else{const h=Ct(n,fe);a=Ct(h.firestore,ue),l=h._query;const f=new Bi(a);o={next:m=>{t[r]&&t[r](new ve(a,f,h,m))},error:t[r+1],complete:t[r+2]},Bu(n._query)}return(function(f,m,E,w){const C=new Di(w),k=new Ci(m,C,E);return f.asyncQueue.enqueueAndForget((async()=>Ri(await br(f),k))),()=>{C.Nu(),f.asyncQueue.enqueueAndForget((async()=>Si(await br(f),k)))}})($r(a),l,s,o)}function qi(n,t){return(function(r,s){const o=new jt;return r.asyncQueue.enqueueAndForget((async()=>Bm(await Ym(r),s,o))),o.promise})($r(n),t)}function $u(n,t,e){const r=e.docs.get(t._key),s=new Bi(n);return new Ie(n,s,t._key,r,new En(e.hasPendingWrites,e.fromCache),t.converter)}function or(n){return new Mi("increment",n)}(function(t,e=!0){(function(s){Ge=s})(zh),_r(new Rn("firestore",((r,{instanceIdentifier:s,options:o})=>{const a=r.getProvider("app").getImmediate(),l=new ue(new af(r.getProvider("auth-internal")),new lf(a,r.getProvider("app-check-internal")),(function(f,m){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new D(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Pn(f.options.projectId,m)})(a,s),a);return o={useFetchStreams:e,...o},l._setSettings(o),l}),"PUBLIC").setMultipleInstances(!0)),xe(na,ra,t),xe(na,ra,"esm2020")})();const _p={apiKey:"AIzaSyBvFv05IJoQgTLzGZZ1caZ0HR1YxpcnoC0",authDomain:"sistemaadmin-gestion.firebaseapp.com",projectId:"sistemaadmin-gestion",storageBucket:"sistemaadmin-gestion.firebasestorage.app",messagingSenderId:"1076212390122",appId:"1:1076212390122:web:bba4cf0e04688cfd2ddf93"},yp=fc(_p),Mt=ep(yp);class Ep{constructor(){this.collectionName="suppliers",this.transactionCollection="supplier_transactions"}subscribeToSuppliers(t){const e=Ps(mn(Mt,this.collectionName),Vs("name","asc"));return gp(e,r=>{const s=r.docs.map(o=>({id:o.id,...o.data()}));t(s)})}async createSupplier(t){try{return(await sc(mn(Mt,this.collectionName),{...t,balance:0,stockDebt:{},createdAt:new Date,updatedAt:new Date})).id}catch(e){throw console.error("Error creating supplier:",e),e}}async getSupplierById(t){try{const e=Oe(Mt,this.collectionName,t),r=await nc(e);return r.exists()?{id:r.id,...r.data()}:null}catch(e){throw console.error("Error getting supplier:",e),e}}async updateSupplier(t,e){try{const r=Oe(Mt,this.collectionName,t);await pn(r,{...e,updatedAt:new Date})}catch(r){throw console.error("Error updating supplier:",r),r}}async registerMovement(t){try{const e=this._processDate(t.date),r={supplierId:t.supplierId,type:t.type,transactionMode:t.transactionMode||"money",description:t.description||"",date:e,createdAt:new Date,invoiceNumber:t.invoiceNumber||null};t.transactionMode==="stock"?(r.items=t.items||[],r.amount=0):r.amount=parseFloat(t.amount||0);const s=await sc(mn(Mt,this.transactionCollection),r),o=Oe(Mt,this.collectionName,t.supplierId);if(t.transactionMode==="stock"){const a={};t.items.forEach(l=>{const h=t.type==="invoice"?1:-1,f=parseFloat(l.quantity)*h;a[`stockDebt.${l.name}`]=or(f)}),a.updatedAt=new Date,await pn(o,a)}else{const a=parseFloat(t.amount),l=t.type==="invoice"?1:-1,h=a*l;await pn(o,{balance:or(h),updatedAt:new Date})}return s.id}catch(e){throw console.error("Error registering movement:",e),e}}async getTransactions(t){try{const e=Ps(mn(Mt,this.transactionCollection),Za("supplierId","==",t),Vs("date","desc"));return(await rc(e)).docs.map(s=>({id:s.id,...s.data(),date:s.data().date?.toDate?s.data().date.toDate():new Date(s.data().date)}))}catch(e){throw console.error("Error fetching transactions:",e),e}}async deleteTransaction(t){try{const e=Oe(Mt,this.transactionCollection,t),r=await nc(e);if(!r.exists())throw new Error("Transaction not found");const s=r.data(),o=Oe(Mt,this.collectionName,s.supplierId);if(s.transactionMode==="stock"){const a={};s.items&&Array.isArray(s.items)&&s.items.forEach(l=>{const f=(s.type==="invoice"?1:-1)*-1,m=parseFloat(l.quantity)*f;a[`stockDebt.${l.name}`]=or(m)}),await pn(o,a)}else{const a=parseFloat(s.amount),l=s.type==="invoice"?1:-1,h=a*l*-1;await pn(o,{balance:or(h)})}await pp(e)}catch(e){throw console.error("Error deleting transaction:",e),e}}async getPendingInvoices(t){try{const e=Ps(mn(Mt,this.transactionCollection),Za("supplierId","==",t),Vs("date","asc")),s=(await rc(e)).docs.map(h=>({id:h.id,...h.data(),dateObj:h.data().date?.toDate?h.data().date.toDate():new Date(h.data().date)}));if(s.length===0)return[];let o=0,a=null;return s.forEach(h=>{if(h.transactionMode==="stock")return;const f=parseFloat(h.amount||0);h.type==="invoice"?o+=f:o-=f,o<=.5&&(o=0,a=h.dateObj)}),s.filter(h=>h.type!=="invoice"||h.transactionMode==="stock"?!1:a?h.dateObj>a:!0).reverse()}catch(e){return console.error("Error calculando boletas pendientes:",e),[]}}_processDate(t){if(!t)return new Date;if(t instanceof Date)return t;if(typeof t=="string"&&t.includes("-")){const[e,r,s]=t.split("-").map(Number);return new Date(e,r-1,s,12,0,0)}return new Date(t)}}const Ap=new Ep;function Rp({suppliers:n=[],preSelectedSupplier:t=null,initialValues:e=null,onSubmit:r,onCancel:s,onDelete:o}){let a=t;const l=L("div",{className:"mf-container-wrapper"}),h=()=>{if(l.innerHTML="",!a){const y=L("h3",{className:"mf-step-title"},"Selecciona un Proveedor"),I=L("select",{className:"mf-supplier-select"},L("option",{value:""},"-- Elegir de la lista --"),...n.map(p=>L("option",{value:p.id},p.name)));I.onchange=p=>{const st=n.find(Pt=>Pt.id===p.target.value);st&&(a=st,h())},l.append(L("div",{className:"mf-step-selector"},y,I,L("p",{className:"mf-help-text"},"El formulario se adaptar a la configuracin del proveedor (Stock o Dinero).")));return}const f=a.providerType==="stock"?"stock":"money";let m=e?.type||"invoice",E=e?.amount?Math.round(e.amount*100):0,w=[];e?.items?w=[...e.items]:f==="stock"&&(w=(a.stockItems||a.defaultItems||[]).map(I=>({name:typeof I=="object"?I.name:I,quantity:0,isDefault:!0})));let C=new Date().toISOString().split("T")[0];e?.date&&(C=(e.date.seconds?new Date(e.date.seconds*1e3):new Date(e.date)).toISOString().split("T")[0]);const k=L("div",{className:"mf-supplier-header"},L("span",{className:"mf-supplier-label"},"Registrando para:"),L("strong",{},a.name)),M=L("div",{className:"mf-type-selector"}),V=()=>{M.innerHTML="",[{id:"invoice",label:f==="stock"?"Entrada":"Deuda"},{id:"payment",label:f==="stock"?"Salida":"Pago"},{id:"note",label:"Nota"}].forEach(I=>{const p=L("button",{type:"button",className:`mf-pill-btn ${m===I.id?"active":""}`},I.label);p.onclick=()=>{m=I.id,V(),q&&(q.className=`mf-money-input amount-${m}`),T&&(T.style.display=I.id==="invoice"&&f==="money"?"block":"none")},M.appendChild(p)})};let z=null,q=null;if(f==="money"){const y=I=>I===0?"":"$ "+(I/100).toLocaleString("es-AR",{minimumFractionDigits:2,maximumFractionDigits:2});q=L("input",{type:"tel",className:`mf-money-input amount-${m}`,value:y(E),placeholder:"$ 0,00",autocomplete:"off"}),q.addEventListener("input",I=>{const p=I.target.value.replace(/\D/g,"");E=p?parseInt(p,10):0,I.target.value=y(E)}),z=L("div",{className:"mf-section-money"},q)}let K=null;if(f==="stock"){const y=L("div",{className:"mf-stock-list"}),I=()=>{y.innerHTML="",w.length===0&&y.appendChild(L("div",{className:"mf-empty-msg"},"Sin tems configurados.")),w.forEach((qn,Xe)=>{const de=Wr=>{w[Xe].quantity=Math.max(0,w[Xe].quantity+Wr),I()},be=L("div",{className:"mf-stock-row"},L("div",{className:"mf-stock-name"},qn.name),L("div",{className:"mf-row-actions"},L("button",{type:"button",className:"mf-counter-btn minus",onclick:()=>de(-1)},"-"),L("span",{className:"mf-counter-val"},qn.quantity.toString()),L("button",{type:"button",className:"mf-counter-btn plus",onclick:()=>de(1)},"+"),L("button",{type:"button",className:"mf-btn-icon delete",onclick:()=>{w.splice(Xe,1),I()}},ar("trash"))));y.appendChild(be)})},p=L("input",{type:"text",className:"mf-input-subtle",placeholder:"+ Otro tem"}),st=L("button",{type:"button",className:"mf-btn-icon-add"},ar("plus")),Pt=()=>{p.value.trim()&&(w.push({name:p.value,quantity:1}),p.value="",I())};st.onclick=Pt,I(),K=L("div",{className:"mf-section-stock"},y,L("div",{className:"mf-divider-dashed"}),L("div",{className:"mf-manual-add"},p,st))}const lt=L("input",{type:"date",className:"mf-input",value:C}),dt=L("input",{type:"text",className:"mf-input",placeholder:"Descripcin / Nota",value:e?.description||""}),et=L("input",{type:"text",className:"mf-input",placeholder:"N Comprobante",value:e?.invoiceNumber||""}),T=L("div",{className:"mf-form-group"},et);(f!=="money"||m!=="invoice")&&(T.style.display="none");const g=L("button",{type:"submit",className:"mf-btn-submit"},e?"Guardar":"Registrar"),_=L("div",{className:"mf-actions"},g);if(e&&o){const y=L("button",{type:"button",className:"mf-btn-delete"},ar("trash"));y.onclick=o,_.prepend(y)}V();const v=L("form",{className:"movement-form-v3",onsubmit:y=>{if(y.preventDefault(),f==="money"&&E<=0)return alert("Ingresa un monto vlido");const I=f==="stock"?w.filter(p=>p.quantity>0):[];if(f==="stock"&&I.length===0)return alert("Ingresa cantidades");r({supplierId:a.id,type:m,transactionMode:f,date:lt.value,description:dt.value,invoiceNumber:f==="money"&&m==="invoice"?et.value:null,amount:f==="money"?E/100:0,items:I})}},k,L("div",{className:"mf-header"},L("label",{className:"mf-label"},"Transaccin"),M),L("div",{className:"mf-body"},f==="money"?z:K),L("div",{className:"mf-footer"},L("div",{className:"mf-grid-row"},lt,T),dt,_));l.append(v)};return h(),l}export{vp as B,Ip as M,Rp as a,Ap as s};
