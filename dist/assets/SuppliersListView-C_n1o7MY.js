import{e,I as u}from"./index-DHqL_ZfZ.js";import{s as w,B as A,M as S,a as M}from"./index-CQ5UfyT6.js";function T({placeholder:r="Buscar...",onSearch:a}){const s=e("input",{className:"search-field",type:"text",placeholder:r,oninput:t=>{const c=t.target.value.toLowerCase().trim();a&&a(c)}}),i=e("div",{className:"search-box"},u("search"),s);return i.clear=()=>{s.value="",a&&a("")},i}function I(r,a=""){let s=localStorage.getItem("amountsHidden")==="true";const i=e("span",{className:a}),t=()=>{s?i.textContent="*****":i.textContent=new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(r)},c=d=>{s=d.detail,t()};return window.addEventListener("toggle-amounts",c),t(),i}function k({suppliers:r=[],onViewDetails:a,onAddMovement:s}){if(r.length===0)return e("div",{className:"suppliers-grid"},e("div",{className:"empty-state",style:{textAlign:"center",padding:"40px",color:"#999"}},"No hay proveedores aún."));const i=r.map(t=>{let c,d="";if(t.providerType==="stock"){const l=t.stockDebt||{},p=Object.entries(l).filter(([b,v])=>v>0);if(p.length===0)c=e("span",{className:"text-success"},"Al día");else{const b=p.map(([v,f])=>`${f} ${v}`).join(" | ");c=e("span",{className:"text-stock"},b)}}else{const l=t.balance||0;d=l>0?"text-danger":"text-success",c=I(l,d)}const m=t.name.charAt(0).toUpperCase();return e("div",{className:"supplier-card",onclick:()=>a(t)},e("div",{className:"card-header"},e("div",{className:"supplier-avatar"},m),e("div",{className:"card-info"},e("div",{className:"card-name"},t.name),t.alias?e("div",{className:"card-alias",onclick:l=>{l.stopPropagation(),navigator.clipboard.writeText(t.alias)}},u("copy"),t.alias):null),e("button",{className:"btn-card-action",title:"Agregar",onclick:l=>{l.stopPropagation(),s(t)}},u("plus"))),e("div",{className:"card-body"},e("span",{className:"balance-label"},"Saldo"),e("div",{className:"balance-container"},c)))});return e("div",{className:"suppliers-grid"},...i)}function H(){let r=localStorage.getItem("amountsHidden")==="true";const a=e("button",{className:"btn-icon-toggle",title:r?"Mostrar montos":"Ocultar montos",onclick:()=>{r=!r,localStorage.setItem("amountsHidden",r),window.dispatchEvent(new CustomEvent("toggle-amounts",{detail:r})),s()}}),s=()=>{a.innerHTML="",a.appendChild(u(r?"eyeOff":"eye"))};return s(),a}function L({suppliers:r}){const a=r.reduce((l,p)=>l+(p.balance||0),0),s=r.filter(l=>(l.balance||0)>0).length;let i=localStorage.getItem("amountsHidden")==="true";const t=e("h2",{className:"amount"}),c=()=>{i?t.textContent="*****":t.textContent=new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(a)};window.addEventListener("toggle-amounts",l=>{i=l.detail,c()}),c();let d="status-ok",m="Al día";return a>0&&(d="status-warning",m=`Deuda con ${s} proveedores`),a>5e5&&(d="status-danger",m="Atención: Deuda elevada"),e("div",{className:`summary-card ${d}`},e("div",{className:"summary-main"},e("div",{className:"summary-info"},e("div",{style:{display:"flex",alignItems:"center",gap:"10px"}},e("span",{className:"label"},"SALDO TOTAL"),H()),t,e("div",{className:"badge"},m)),e("div",{className:"summary-visual"},u("dollar"))),e("div",{className:"summary-footer"},e("div",{className:"stat"},e("span",{},"Promedio por proveedor con deuda: "),e("strong",{},new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(s>0?a/s:0)))))}function R({navigateTo:r}){const a=e("div",{className:"view-container fade-in"});let s=[],i=null,t="";const c=e("div",{className:"summary-wrapper"}),d=e("div",{className:"table-wrapper"}),m=T({placeholder:"Buscar por nombre o alias...",onSearch:n=>{t=n,l()}}),l=()=>{const n=t?s.filter(o=>o.name.toLowerCase().includes(t)||o.alias&&o.alias.toLowerCase().includes(t)):s;d.innerHTML="",d.appendChild(k({suppliers:n,onViewDetails:o=>r("supplier-detail",{supplier:o}),onAddMovement:o=>v(o)}))},p=n=>{c.innerHTML="",c.appendChild(L({suppliers:n}))},b=()=>{const n=e("input",{className:"form-input",placeholder:"Nombre del negocio (ej: Distribuidora Central)",style:{width:"100%",padding:"10px",marginTop:"10px"}});let o=null;const y=e("div",{},e("p",{style:{color:"#666"}},"Ingresa el nombre para dar de alta al proveedor."),n),h=A({text:"Guardar Proveedor",fullWidth:!0,onClick:async()=>{const g=n.value.trim();if(!g)return alert("El nombre es obligatorio");try{await w.createSupplier({name:g}),o&&o.close()}catch(N){console.error(N),alert("Error al crear: "+N.message)}}});o=S({title:"Nuevo Proveedor",content:y,footer:h}),o.open(),setTimeout(()=>n.focus(),100)},v=(n=null)=>{let o=null;const y=M({suppliers:s,preSelectedSupplier:n,onSubmit:async g=>{try{await w.registerMovement(g),o&&o.close()}catch(N){alert("Error: "+N.message)}},onCancel:()=>o&&o.close()}),h=n?`Nuevo Movimiento - ${n.name}`:"Nuevo Movimiento";o=S({title:h,content:y}),o.open()};i=w.subscribeToSuppliers(n=>{s=n,p(n),l()}),a.onUnmount=()=>{i&&i()};const f=e("div",{className:"fab-container"}),x=e("button",{className:"fab-mini",title:"Nuevo Proveedor",type:"button"},u("truckPlus"));x.onclick=n=>{n.stopPropagation(),b()};const C=e("button",{className:"fab-btn",title:"Registrar Movimiento",type:"button"},u("filePlus"));return C.onclick=n=>{n.stopPropagation(),v(null)},f.append(x,C),a.append(e("header",{className:"view-header"},e("h1",{},"Proveedores")),c,m,d,f),a}export{R as SuppliersListView};
